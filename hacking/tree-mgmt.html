<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<link rel="top" title="Home" href="http://www.mozilla.org/">
<link rel="stylesheet" type="text/css" href="../css/print.css"  media="print">
<link rel="stylesheet" type="text/css" href="../css/base/content.css"  media="all">
<link rel="stylesheet" type="text/css" href="../css/cavendish/content.css" title="Cavendish" media="screen">
<link rel="stylesheet" type="text/css" href="../css/base/template.css"  media="screen">
<link rel="stylesheet" type="text/css" href="../css/cavendish/template.css" title="Cavendish" media="screen">
<link rel="icon" href="../images/mozilla-16.png" type="image/png">

  <title>Working with the SeaMonkey Tree</title>
<script src="../__utm.js" type="text/javascript"></script>
</head>
<body id="www-mozilla-org" class="deepLevel">
<div id="container">
<p class="important">You are currently viewing a snapshot of www.mozilla.org taken on April 21, 2008. Most of this content is
highly out of date (some pages haven't been updated since the project began in 1998) and exists for historical purposes only.  If
there are any pages on this archive site that you think should be added back to www.mozilla.org, please <a
href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=www.mozilla.org">file a bug</a>.</p>
<p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>
<div id="header">
<h1><a href="/" title="Return to home page" accesskey="1">Mozilla</a></h1>
<ul>
<li id="menu_aboutus"><a href="../about/" title="Getting the most out of your online experience">About</a></li>
<li id="menu_developers"><a href="../developer/" title="Using Mozilla's products for your own applications">Developers</a></li>
<li id="menu_store"><a href="http://store.mozilla.org/?r=mozorg1" title="Shop for Mozilla products on CD and other merchandise">Store</a></li>
<li id="menu_support"><a href="../support/" title="Installation, trouble-shooting, and the knowledge base">Support</a></li>
<li id="menu_products"><a href="../products/" title="All software Mozilla currently offers">Products</a></li>
</ul>
<form id="searchbox_002443141534113389537:ysdmevkkknw" action="http://www.google.com/cse" title="mozilla.org Search">
<div>
<label for="q" title="Search mozilla.org's sites">search mozilla:</label>
<input type="hidden" name="cx" value="002443141534113389537:ysdmevkkknw">
<input type="hidden" name="cof" value="FORID:0">
<input type="text" id="q" name="q" accesskey="s" size="30">
<input type="submit" id="submit" value="Go">
</div>
</form>
</div>
<hr class="hide">
<div id="mBody">
<div id="side">

<ul id="nav">
<li><a title="Roadmap" href="../roadmap.html"><strong> Roadmap</strong></a></li>
<li><a title="Projects" href="../projects/"><strong> Projects</strong></a></li>
<li><a title="For developers" href="../developer/"><strong> Coding</strong></a>
<ul>
<li><a title="Module Owners" href="../owners.html"> Module Owners</a></li>
<li><a title="Hacking" href="../hacking/"> Hacking</a></li>
<li><a title="Get the Source" href="http://developer.mozilla.org/en/docs/Download_Mozilla_Source_Code"> Get the Source</a></li>
<li><a title="Building Mozilla" href="http://developer.mozilla.org/en/docs/Build_Documentation"> Build It</a></li>
</ul>
</li>
<li><a title="Testing" href="../quality/"><strong> Testing</strong></a>
<ul>
<li><a title="Downloads of mozilla.org software releases" href="../download.html"> Releases</a></li>
<li><a title="Latest mozilla builds for testers" href="../developer/#builds"> Nightly Builds</a></li>
<li><a title="For testers to report bugs" href="https://bugzilla.mozilla.org/"> Report A Problem</a></li>
</ul>
</li>
<li><a title="Tools for mozilla developers" href="../tools.html"><strong> Tools</strong></a>
<ul>
<li><a title="Bug tracking system for mozilla testers." href="https://bugzilla.mozilla.org/"> Bugzilla</a></li>
<li><a title="Latest status of mozilla builds" href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=Firefox"> Tinderbox</a></li>
<li><a title="Latest checkins" href="http://bonsai.mozilla.org/cvsqueryform.cgi"> Bonsai</a></li>
<li><a title="Source cross reference" href="http://lxr.mozilla.org/seamonkey/"> LXR</a></li>
</ul>
</li>
<li><a title="Frequently Asked Questions." href="../faq.html"><strong> FAQs</strong></a></li>
</ul>

</div>
<hr class="hide">
<div id="mainContent">






<h1>Working with the SeaMonkey Tree</h1>
        <h3>Contents</h3>
 
<ul>
   <li><a href="#Base_concepts">Base concepts</a>   </li>
   <li><a href="#Example">Example of the process in action</a> </li>
          <li><a href="#Tree_state_assurance">Tree state assurance</a> </li>
   <li><a href="#Terminology">Terminology</a>   </li>
      <li><a href="#Mozillas_tools">Links to Mozilla's tools</a>     <br>
   </li>
 
</ul>
 <br>
        Consider the following to be a high level description of the process for 
        getting code into mozilla.org's SeaMonkey tree (i.e. doing work :-)). 
        We've been refining this process for several years and believe it provides 
        an efficient and safe model for software development. The model is entirely 
        driven by peer understanding/pressure. This model distributes workload 
        and exposure to process failure.<br>
 <br>
        The primary goal is to have the greatest number of engineers productive 
        at any given point in time. The primary thing to avoid in tree management 
        is a tree that doesn't compile. If the tree has reached that state, the 
        entire engineering organization cannot move forward (the most inefficient 
        state). Jane checks out the code (aka "tree") and she can't compile. She 
        either waits awhile and checks out the tree later, or spends precious 
        time tracking down the compilation error that she didn't cause.<br>
 <br>
        There are different ways to enforce these rules and different organizations 
        can instill them in varying ways. In the Mozilla project this model is 
        driven largely by implicit peer pressure . . . those that don't adhere 
        to the model are ostracized. <br>
 <br>
 <a name="Base_concepts"></a>   Base concepts that must be agreed upon (by
engineers, build team, and management  (including upper management)):<br>
 
<ul>
   <li>Breaking (run time, compile time, or link time) the tree is not ok.
 It costs lots of money (more than you can justify wasting) to have hundreds
 of engineers sitting idle waiting for a good tree to pull.</li>
          <li>Code will be backed out if it breaks the tree and the offending 
            code isn't being rectified w/ a reasonable time frame set for resolution 
            (usually less than 60 minutes).  The point is, if you can't fix your 
            problem quickly, you have a problem to figure out and your code shouldn't 
            be in the tree anyway.</li>
   <li>Someone must <b>always</b> be watching and responsible the tree state.
 This is best done using a 24 hour rotating schedule so no one person is
responsible  for it all the time. We've called this person the "sheriff,"
and the sheriff  schedule is laid out so someone's always in the driver's
seat. See <a href="http://www.mozilla.org/build/sheriff-schedule.html"> 
this link</a>   for Mozilla's sheriff schedule.</li>
  <li>Individuals who check-in code are also responsible for watching the
tree until tinderbox has cycled green. This ensures that the individuals code
didn't break something unforseen, and that the individual is around to deal
w/ it immediately.<br>
  </li>
          <li>Builds are "verified" by appropriate people frequently so the tree 
            is regularly in a known good state. Every weekday at 8am, the SeaMonkey 
            build team automatically closes the tree and produces release builds 
            which are "smoketested" (see <a href="http://www.mozilla.org/quality/smoketests/index.html">this 
            link</a> for Mozilla's smoketests) for basic functionality.  If there 
            are any bugs blocking a major portion of the tests, that is considered 
            a blocker bug and the tree will be held closed until the bug is fixed 
            and the build is respun.  It is the responsibility of the sheriff 
            and the hook (see <a href="#sheriff">below </a>for an understanding 
            of "the sheriff" and &quot;the hook&quot;) to fix the blocker bug. 
             Once all blocker bugs have been fixed and QA has builds with which 
            to do further testing, the hook is cleared, the tree is opened for 
            checkins and development continues.  If there are no blocker bugs, 
            the tree is typically open by 11am.</li>
   <li>Code is not checked in without meeting a minimum set of pre-checkin
 tests (like firing up the application and shutting it down). This set has
 to be small enough for engineers not to waste too much time verifying, yet
 large enough not to cause serious regressions. See <a href="http://www.mozilla.org/quality/precheckin-tests.html">  this link</a>
   for Mozilla's pre-checkin tests.</li>
          <li>Everyone is equal in this process. The senior engineer<u></u> has no more, 
            or less, right to drag someone out on the carpet for breaking the 
            build than the intern does. There is no "weight" to throw around. 
            Code is either good or bad, it doesn't matter who wrote it.</li>
   <li>Code can only be checked in if it's been reviewed. Again, everyone's
 equal here. The inventor of Javascript gets   backed out if he didn't go
through the appropriate review process; no joke.  See <a href="http://www.mozilla.org/projects/seamonkey/rules/code_review.html">
  this link</a>   for Mozilla's review process.</li>
   <li>Peer pressure is a real and powerful force.</li>
   <li>There are no exceptions to the process.</li>
   <li>Because there is buy in from upper management, escalation to them for
an exception gets you nowhere.</li>
          <li>The tree state needs to be known as frequently as possible. This 
            translates to build verification every 24 hours  (except for weekends 
            and holidays in the United States when, in theory, tree changes are 
            reduced anyway).</li>
          <li>Extended tree closure is a good way to do even more extensive testing. 
            Mozilla accomplishes this by closing the tree for approximately one 
            week every six weeks in preparation for releasing a milestone.</li>
 
</ul>
<br>
 
<h3><a name="Example"></a>  Example</h3>
  Here's an example of getting code into the tree.  
<h4>writing code</h4>
  I'm Joe and I've written some code that I want to check into the SeaMonkey tree. 
        I've been writing my code for a week, and I want to make sure that it 
        still works w/ the current tree (which has changed (other people have 
        checked in) since I last did a checkout). <br>
 <br>
  If I work too long locally, my local tree will become too out of sync w/
 what's in the repository, and I'll have to spend more time updating my code.
 
<h4>updating my local tree</h4>
  Before I update my tree, I visit the tinderbox URL to see if the tree is green 
        (see <a href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey&amp;hours=12&amp;nocrap=1"> 
        this link</a> for Mozilla's SeaMonkey trunk tinderbox). If it is, then 
        I can update my tree, otherwise I'll wait for green because checking out 
        a red tree assures that my local tree will break and therefore I can't 
        do any work. Once I've updated my tree, I re-build to make sure my changes 
        haven't broken anything in the recent tree. <br>
 <br>
  If something broke, I'll need to update my local tree so it's no longer
breaking things. If I checked in in this broken state, <b>everyone </b>would
break too which isn't cool.<br>
 <br>
  Nothing broke so my tree is "up-to-date".  
<h4>getting reviews</h4>
        <p>Before I can checkin I'm required to have others review my code for 
          contextual accuracy (does my code do the right thing?), and syntactical 
          correctness (is my code using style/syntax that the general project 
          is using). These are known as &quot;review&quot; and &quot;super-review&quot; 
          respectively. See <a href="code-review-faq.html">this FAQ</a> for more 
          information about mozilla.org's code review processes.)<br>
          <br>
          I call up (or email) Jane who knows this area of the code and show her 
          cvs diffs of my modifications. I called Jane because she's widely considered 
          a "module owner" (someone who knows a specific code area). She looks 
          them over using some reviewer guidelines (see <a href="http://www.mozilla.org/projects/seamonkey/rules/code_review.html"> 
          this link</a> for Mozilla's reviewer guidelines) and her own expertise. 
          She notices that I could be iterating my array more efficiently, points 
          that out to me, and I update my code, produce new diffs, and she goes 
          over the new diffs to make sure my new iterator is ok.</p>
        <p>Technically speaking, the reviewers of code should be held just as 
          accountable as the person who wrote the code. </p>
        <p>In almost all cases a super-review of my code is needed as well. (See 
          <a href="reviewers.html">this link</a> for an explanation of super-review.)<br>
          <br>
          This is one of many areas where "peer" pressure comes into play. The 
          fact that a peer is required to look at my code ensures that I'm going 
          to do the best I can to produce good, working, code. Otherwise I feel 
          embarrassed.<br>
        </p>
        <h4>running the pre-checkin tests</h4>
  Before I commit my code, I have to run a small set of tests (see <a href="http://www.mozilla.org/quality/precheckin-tests.html"> 
        this link</a> for Mozilla's pre-checkin tests) to ensure that basic (defined 
        by the project) functionality works. If I check-in code that prevents 
        a URL from being loaded for example, even though tinderbox won't break 
        (it's not a compile time error), the build is pretty much useless. Running 
        the pre-checkin tests ensures <b> some</b> level of verification before 
        I checked my stuff in.<br>
<br>
If I want to be extra careful, I can run the actual smoketests that are used
to verify a tree. If I do that, and I pass all of those tests, I'm an extra
step ahead of the game because I know my stuff _really_ didn't break anything,
and the odds of getting called in because I broke something go down even further.<br>
  
<h4>checking in code (first attempt)</h4>
  I check tinderbox again to make sure that the state of the tree is open
(no-one is allowed to checkin if the tree is closed). The tree is closed
this time because someone checked in code that caused a compiler error.<br>
 
<h4><a name="sheriff"></a>sheriff</h4>
 The "sheriff" "closed" the tree so that everyone knows not to checkin until things 
        are fixed (either the offending code is backed out of the tree, or the 
        issues is quickly resolved). The sheriff is responsible for closing the 
        tree anytime it is in an unknown or broken state. This is necessary so 
        that even more uncertainty/bustage is not checked in, resulting in an 
        even further degraded tree. You can imagine what happens if multiple people 
        check in code that doesn't compile. A nasty spiraling affect occurs that 
        can take a long time to sort out. <br>
 
<h4>checking in code (second attempt)</h4>
 I go get a cup of coffee, and when I come back, I see that the tree is open
again (the bustage was resolved), so I checkin. My checkin comments indicate
who did my code review(s), and describe, in fairly good detail, what my modifications
do.  
<h4>the <a name="hook"></a>hook</h4>
   Now that my code has been committed to the tree I am "on the hook" to make
 sure that I didn't break anything. The sheriff may call on me w/ questions
 until I am "off the hook." The hook is cleared after the build team has
smoketested  the tree (done daily in the mornings) to ensure the tree is
back to a known good state. The cycle is daily, so if I checkin code again,
I'll be on the hook again, and so on and so on.<br>
 <br>
        Being on the hook comes w/ responsibility. I'm required to watch tinderbox 
        go through a green cycle on all of its builds before I can walk away from 
        my machine. If a build fails, I have to check to see if it was me (tinderbox 
        provides mechanisms to do this "checking"). Once everything cycles green, 
        I can stop watching tinderbox, but I'm still on the hook (I may have introduced 
        run-time bustage for example, and I need to be held accountable for that).<br>
 <br>
        The "hook" is an important concept in that it is a list of people (automatically 
        deducible by tinderbox) that can be emailed/contacted regarding a particular 
        build cycle. If someone notices a runtime problem w/ a build, they can 
        email the hook to contact everyone who had checked into the tree since 
        the last build verification (the last time the hook was "cleared"). So, 
        let's say I notice that a particular dialog isn't coming up that used 
        to come up. I can email the hook asking "did anyone mess w/ code that 
        could affect dialog throwing?" Because this is a communal effort, chances 
        are someone will respond. If you were on the hook, and you didn't respond, 
        you'll be dragged out on to the carpet for not paying attention and wasting 
        other people's time (remember, this is the ultimate inefficiency). See 
        <a href="bonsai.html">this link</a> for more information on the hook and 
        how our bonsai tool can help you.<br>
 
<h4>runtime bustage</h4>
  It turns out that the code I wrote is causing runtime problems in some functional 
        area that <em>neither</em> the review process nor tinderbox caught. George 
        noticed this because he was working in this area after I checked in. George 
        contacts the sheriff indicating that a regression has been introduced. 
        The sheriff and George determine the the regression is severe enough that 
        the tree be closed; so the sheriff closes it. Because the tree is closed 
        there's a large number of people who are blocked from proceeding with 
        their checkin, and some of those people scramble to help find the offending 
        code. Generally the sheriff sends mail to the hook pointing out the regression 
        and asking for folks to determine if it was their checkin that caused 
        it. The offending code is found to be mine. My code cycled green so I 
        walked away from my machine to get some dinner. Because I'm still on the 
        hook, I'm ultimately responsible for my code, and if I'm not available 
        (in this case I didn't bring my pager or cell phone with me), and no-one 
        else wants to, or can, fix my problem, I can be backed out. Because this 
        regression was serious enough, the sheriff indicates that my code should 
        be backed out. The sheriff backs it out (the commands to do so are automatically 
        generated by tinderbox), so he can re-open the tree and unblock people.<br>
 <br>
  I come back from dinner and see that I've been backed out. I wasn't reasonably
 reachable (no-one was able to get a hold of me), so I accept that my code
 got yanked. I try my changes out in the scenario where the regression surfaced,
 notice the problem, fix it, and start the review/checkin process over again.<br>
 <br>
<h3><a name="Tree_state_assurance"></a>Tree state assurance<br>
</h3>
By now you can probably see how tree state is determined at various levels.
<br>
<br>
Developer <br>
<ul>
  <li>Developers only checkin code that has been verified to "do the right
thing" (the review process), compile, and not break basic functionality (pre-checkin
tests). This level is continual and done at the individual level, to test
an individual's code.</li>
</ul>
Verification <br>
<ul>
  <li>Every 24 hours the tree closes to <b>all</b> checkins while the builds
are "verified." This provides an even more robust test cycle guarantees the
trees state across many individual's checkins.</li>
</ul>
Extended (milestone level) tree closure<br>
<ul>
          <li>This generally occurs every six weeks, and QA hammers on these builds. This 
            provides an even <b>more</b> robust test cycle across weeks of development.<br>
  </li>
</ul>
 
<h3><a name="Terminology"></a>  Terminology</h3>
        <p>SeaMonkey<br>
        </p>
        <ul>
          <li>The browser/mail/news application suite that forms the basis of 
            the Mozilla 1.0 release. </li>
        </ul>
  <p>Tree<br>
        </p>
        <ul>
          <li>cvs's representation of a set of code is referred to as a tree. 
            Mozilla.org maintains a tree that encompasses all the code for the 
            SeaMonkey application suite. Not surprisingly, this is known as the 
            SeaMonkey tree.</li>
 
</ul>
  Broken Tree (also known as Burning Tree, Red Tree, Busted Tree, Flaming Tree 
        or &quot;In Flames&quot;)<br>
 
<ul>
          <li>A broken tree is one that doesn't compile or link. I can break my local 
            tree by introducing a compile or link time error. If I check that 
            error into cvs, anyone else checking out a tree will also get a broken 
            tree. Broken trees are bad :-).</li>
 
</ul>
    Commit or check-in<br>
 
<ul>
   <li>Committing or checking-in code writes it into the cvs repository.</li>
 
</ul>
    tinderbox <br>
 
<ul>
          <li>Software (largely a bunch of perl scripts) that continuously checks 
            out a tree and builds it. Tinderbox provides graphical representation 
            of the state of the tree by doing builds. See <a href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey">this 
            link </a>for mozilla's SeaMonkey trunk<em> </em>tinderbox. There are 
            generally three states that tinderbox can be in: red, representing<em> 
            </em>a<em> </em>broken tree; green, indicating that everything is 
            building/linking/testing fine; and orange, indicating that automated 
            tests run after the build successfully completes are failing. Tinderboxes 
            (or &quot;tinderboxen&quot;) are always maintained for the SeaMonkey 
            trunk. Additional tinderboxen may be added when a branch is under 
            active development. For example, see <a href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey-Branch">this 
            link</a> to the Mozilla 1.0 branch tinderboxen.</li>
 
</ul>
    Tree verification <br>
 
<ul>
   <li>The tree is built and verified for regressions and bugs. This is usually
 done by a combination of QA and the build team. The tree is in a closed state
 during verification so the verifiers are sure that nothing's changing out
 from underneath them. Code checked in to a closed tree gets backed out.</li>
 
</ul>
    Closed tree <br>
 
<ul>
   <li>No one is allowed to commit code to a closed tree. A tree is generally
closed while a build is being verified so the tree is not changed until we
know that the tree is in a "good" state. The tree is also closed by the sheriff
when the tree state becomes unknown.</li>
 
</ul>
    Open tree <br>
 
<ul>
          <li>The tree is open for checkins. Code for which the pre-checkin process 
            has been completed may be checked into the tree.</li>
 
</ul>
    Checkin approval <br>
 
<ul>
          <li>During periods of increased tree control (sometimes referred to 
            as "lock down" periods) only specifically approved checkins are permitted 
            into the tree. This generally happens before a milestone release. 
            At such times, a group (such as &quot;drivers@mozilla.org&quot;) or 
            an individual may be designated as the approval granting entity.</li>
 
</ul>
 Checkin review<br>
 
<ul>
   <li>Absolutely no code (no exceptions regardless of title,  skill level,
etc.) is checked into the tree without it being reviewed by someone qualified
to do a review. See <a href="http://www.mozilla.org/projects/seamonkey/rules/code_review.html">
 this link</a>  for Mozilla's review guidelines (different organizations
will build different  guidelines accordingly).</li>
 
</ul>
    Sheriff <br>
 
<ul>
          <li>A tree is never unattended and the sheriff is the attendant. A tree 
            w/ out a sheriff is a broken tree. The sheriff has the power to close 
            the tree if things go awry (the tree goes "red" for example). The 
            sheriff also has the power to have code backed out (removed) from 
            the tree. It is also understood that the sheriff can call you at 2am 
            on a Sunday morning if you were deemed to be the person that broke 
            the tree. Again, the sheriff can be a single person, or can rotate 
            shifts across members of various groups (as occurs with<em> </em>mozilla.org 
            and Netscape).</li>
 
</ul>
   The hook <br>
 
<ul>
          <li>A set of people who have checked in code to the tree since the last 
            time the hook was cleared. The SeaMonkey build is verified daily, 
            and after the build has been verified, the hook is cleared, meaning 
            that everyone that had checked in since the last verification is "off 
            the hook" for this build. The hook is responsible for getting the 
            tree back to the state it was in at the time of the previous verification.</li>
 
</ul>
  
<h3><a name="Mozillas_tools"></a>   Mozilla's tools</h3>
        SeaMonkey trunk tinderbox - <a href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey&amp;hours=12&amp;nocrap=1">http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey&amp;hours=12&amp;nocrap=1</a><br>
   LXR - <a href="http://lxr.mozilla.org/seamonkey/">http://lxr.mozilla.org/seamonkey/</a><br>
   Bonsai - <a href="http://bonsai.mozilla.org/">http://bonsai.mozilla.org/</a><br>
 <br>
 <br>
 <br>
 <br>
 

<hr class="hide">
</div>
</div>
<div id="footer">
<ul>
<li><a href="../sitemap.html">Site Map</a></li>
<li><a href="../security/">Security Updates</a></li>
<li><a href="../contact/">Contact Us</a></li>
<li><a href="../foundation/donate.html">Donate</a></li>
</ul>
<p class="copyright">
Portions of this content are &copy; 1998&#8211;2009 by individual mozilla.org
contributors; content available under a Creative Commons license | <a
href="http://www.mozilla.org/foundation/licensing/website-content.html">Details</a>.</p>
<p>
<span>Last modified August 31,  2004</span>
<span><a href="http://bonsai-www.mozilla.org/cvslog.cgi?file=mozilla-org/html/hacking/tree-mgmt.html&amp;rev=&amp;root=/www/">Document History</a></span>
</p>
</div>
</div>
</body>
</html>
