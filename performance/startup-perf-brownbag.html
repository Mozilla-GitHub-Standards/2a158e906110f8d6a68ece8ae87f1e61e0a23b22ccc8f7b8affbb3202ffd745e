<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="top" title="Home" href="http://www.mozilla.org/">
<link rel="stylesheet" type="text/css" href="../css/print.css"  media="print">
<link rel="stylesheet" type="text/css" href="../css/base/content.css"  media="all">
<link rel="stylesheet" type="text/css" href="../css/cavendish/content.css" title="Cavendish" media="screen">
<link rel="stylesheet" type="text/css" href="../css/base/template.css"  media="screen">
<link rel="stylesheet" type="text/css" href="../css/cavendish/template.css" title="Cavendish" media="screen">
<link rel="icon" href="../images/mozilla-16.png" type="image/png">

                                           
  <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
  <title>Footprint and Performance Brownbags</title>
<script src="../__utm.js" type="text/javascript"></script>
</head>
<body id="www-mozilla-org" class="deepLevel">
<div id="container">
<p class="important">You are currently viewing a snapshot of www.mozilla.org taken on April 21, 2008. Most of this content is
highly out of date (some pages haven't been updated since the project began in 1998) and exists for historical purposes only.  If
there are any pages on this archive site that you think should be added back to www.mozilla.org, please <a
href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=www.mozilla.org">file a bug</a>.</p>
<p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>
<div id="header">
<h1><a href="/" title="Return to home page" accesskey="1">Mozilla</a></h1>
<ul>
<li id="menu_aboutus"><a href="../about/" title="Getting the most out of your online experience">About</a></li>
<li id="menu_developers"><a href="../developer/" title="Using Mozilla's products for your own applications">Developers</a></li>
<li id="menu_store"><a href="http://store.mozilla.org/?r=mozorg1" title="Shop for Mozilla products on CD and other merchandise">Store</a></li>
<li id="menu_support"><a href="../support/" title="Installation, trouble-shooting, and the knowledge base">Support</a></li>
<li id="menu_products"><a href="../products/" title="All software Mozilla currently offers">Products</a></li>
</ul>
<form id="searchbox_002443141534113389537:ysdmevkkknw" action="http://www.google.com/cse" title="mozilla.org Search">
<div>
<label for="q" title="Search mozilla.org's sites">search mozilla:</label>
<input type="hidden" name="cx" value="002443141534113389537:ysdmevkkknw">
<input type="hidden" name="cof" value="FORID:0">
<input type="text" id="q" name="q" accesskey="s" size="30">
<input type="submit" id="submit" value="Go">
</div>
</form>
</div>
<hr class="hide">
<div id="mBody">
<div id="side">

<ul id="nav">
<li><a title="Roadmap" href="../roadmap.html"><strong> Roadmap</strong></a></li>
<li><a title="Projects" href="../projects/"><strong> Projects</strong></a></li>
<li><a title="For developers" href="../developer/"><strong> Coding</strong></a>
<ul>
<li><a title="Module Owners" href="../owners.html"> Module Owners</a></li>
<li><a title="Hacking" href="../hacking/"> Hacking</a></li>
<li><a title="Get the Source" href="http://developer.mozilla.org/en/docs/Download_Mozilla_Source_Code"> Get the Source</a></li>
<li><a title="Building Mozilla" href="http://developer.mozilla.org/en/docs/Build_Documentation"> Build It</a></li>
</ul>
</li>
<li><a title="Testing" href="../quality/"><strong> Testing</strong></a>
<ul>
<li><a title="Downloads of mozilla.org software releases" href="../download.html"> Releases</a></li>
<li><a title="Latest mozilla builds for testers" href="../developer/#builds"> Nightly Builds</a></li>
<li><a title="For testers to report bugs" href="https://bugzilla.mozilla.org/"> Report A Problem</a></li>
</ul>
</li>
<li><a title="Tools for mozilla developers" href="../tools.html"><strong> Tools</strong></a>
<ul>
<li><a title="Bug tracking system for mozilla testers." href="https://bugzilla.mozilla.org/"> Bugzilla</a></li>
<li><a title="Latest status of mozilla builds" href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=Firefox"> Tinderbox</a></li>
<li><a title="Latest checkins" href="http://bonsai.mozilla.org/cvsqueryform.cgi"> Bonsai</a></li>
<li><a title="Source cross reference" href="http://lxr.mozilla.org/seamonkey/"> LXR</a></li>
</ul>
</li>
<li><a title="Frequently Asked Questions." href="../faq.html"><strong> FAQs</strong></a></li>
</ul>

</div>
<hr class="hide">
<div id="mainContent">



  
       
<div align="Center">   
<h1>Performance brownbag</h1>
        9 Nov 2001<br>
        Suresh Duddi &lt;dp@netscape.com&gt;<br>
    <br>
    </div>
        
<h3><a name="Goal"></a>        Goal</h3>
           Here are the goals of that these brownbags are trying to achieve 
 in  order   of priority.<br>
       
<ol>
      <li>Reduce footprint of embeddable engine and netscape browser</li>
      <li><b>Reduce pageload time</b></li>
      <li><b>Reduce new window open time</b><br>
      </li>
      <li><b>Reduce startup time</b></li>
       
</ol>
        
<h3>What do engineers want from these brownbags ?</h3>
       
<ol>
      <li><b>Measurement Tools and Techniques</b><br>
     </li>
      <li><b>Analysis Tools and Techniques</b><br>
     </li>
      <li><b>Patterns to fixing the areas found</b></li>
       
</ol>
           This is corresponds closely to the performance/footprint improvement 
   loop   : measure -&gt; analyze -&gt; fix -&gt; measure<br>
        
<h3>Target Audience</h3>
           Brownbag should be targeted at the average engineer. Little assumptions 
     should be made about the knowledge of facilities such as c++,       
strings, xpcom etc. We should cover facilities     and provide patterns that
people can use as much as possible even if it   is  trivial.     
<h3>Measurement</h3>
   
<blockquote>(start with a New Created Profile)<br>
  <br>
Startup: <a href="measureStartup.html">
   http://www.mozilla.org/performance/measureStartup.html</a><br>
 Pageload: <a href="http://cowtools.mcom.com/page-loader/loader.pl">http://cowtools.mcom.com/page-loader/loader.pl</a><br>
 IBench Pageload: <a href="http://dogspit.mcom.com/ibench/performance_tests/perf_loadspeed.asp">
 http://dogspit.mcom.com/ibench/performance_tests/perf_loadspeed.asp</a><br>
WindowOpen: &nbsp; <tt>mozilla -chrome file:///drive:/mozilla/xpfe/test/winopen.xul</tt><br>
    </blockquote>
       
  <h3>Analysis Tools</h3>
        Remember the simple things : printfs, #if 0 code and putting timers 
 can go a     long way.             
  <ol>
          <li><a name="MOZ_TIMELINE"></a>MOZ_TIMELINE         <a href="http://www.mozilla.org/performance/measureStartup.html">
            http://www.mozilla.org/performance/measureStartup.html</a></li>
     <li>Quantify <code>[windows]</code>         <a href="http://www.mozilla.org/performance/profiling-juju.html">
         http://www.mozilla.org/performance/profiling-juju.html         </a>
            <br>
                               
      <ul>
              <li>Use optimized / MOZ_PROFILE build </li>
              <li>Increase swap to atleast 500MB</li>
              <li>Use Function level profiling</li>
              <li>Command line arguments: -P 'Default User' file:///c|/tmp/quit.html</li>
              <li>Focus subtree on main1         </li>
                               
      </ul>
          </li>
          <li>jprof <code>[linux]</code>       <a href="http://www.mozilla.org/performance/jprof.html">
   http://www.mozilla.org/performance/jprof.html</a>       </li>
          <li>Simon Fraser is working on a graphical analysis tool for mac</li>
              <li>printfs</li>
          <li>#if 0 : a very useful method in easily finding out the cost 
      associated with a particular piece of code or feature</li>
          <li><a name="mallocsites"></a>mallocsites: Number of allocations
        <a href="http://www.mozilla.org/performance/mallocsites20011031.html">
          http://www.mozilla.org/performance/mallocsites20011031.html</a></li>
          <li><a name="BloatView"></a>BloatView - Number of objects created
       <a href="http://lxr.mozilla.org/mozilla/source/xpcom/doc/MemoryTools.html">
          http://lxr.mozilla.org/mozilla/source/xpcom/doc/MemoryTools.html</a>
          <br>
                     
      <blockquote><code>set       XPCOM_MEM_BLOAT_LOG=1</code></blockquote>
       </li>
          <li><a name="strace"></a>strace <code>[linux]</code> - view all 
system  calls made by application</li>
                     
    </ol>
                   
    <h3>Current Performance Project Plan</h3>
           
    <blockquote><a class="moz-txt-link-freetext" href="http://mozilla.org/performance/Performance_Project.html">
        http://mozilla.org/performance/Performance_Project.html</a>     </blockquote>
               
      <h3>Performance Theory</h3>
       There are two approaches to fixing performance.<br>
                         
      <ul>
          <li>Eliminate the cost - most desirable</li>
          <li>Reduce the cost - better algorithms, data structures, code</li>
                         
      </ul>
    Evaluate if eliminating the cost, even conditionally, is possible before 
   rushing to reduce the cost. E.g                                  
      <blockquote>E.g.&nbsp;International code was loading charset.properties 
   file on  startup. This file contained a mapping of charsets to internal 
 normalized    form. It so happens that only a few charsets are encountered 
 by a large  %  (like 90%) of our users. The fix that Frang Tang and Juraj 
 Betak came with  was to make an internal table of those frequently used 5
 charsets and load  the file only if a charset outside of this list if encountered.
 Thus the entire cost of loading charset.properties was eliminated rather
than thinking about making the file format different so lesser bytes are
read in.</blockquote>
                            
        <h3>Checklist</h3>
                             
        <ol>
        <li>Number of files loaded - <a href="#strace">strace</a> and <a href="#MOZ_TIMELINE">
   MOZ_TIMELINE</a> (for files from jar)</li>
        <li>Any Directory enumeration : <a href="#strace">strace</a></li>
        <li>Any stat() happening : <a href="#strace">strace</a></li>
        <li>Dlls loaded : <a href="#strace">strace</a></li>
        <li>Are we eagarly building up any other resources: menus, hashtables</li>
        <li>Number of memory allocations : <a href="#mallocsites">mallocsites</a></li>
        <li>datastructure or architectural improvements</li>
        <li>Number of objects created - <a href="#BloatView">BloatView</a></li>
                             
        </ol>
                            
        <h3>Stats</h3>
    Here are some interesting stats on our startup:                     
    
        <ul>
        <li>Malloc: 22% (122,563 calls)</li>
        <li>new: 15% (102,535 calls)</li>
        <li>free: 3% (82,332 calls)</li>
        <li>delete: 2.3% (70,722 calls)</li>
                             
        </ul>
                            
        <h3>Tinderbox</h3>
                   
        <blockquote>Main tinderbox: <a href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey">
  http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey</a><br>
  Testerbox: <a href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey-Testerbox">
  http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey-Testerbox<br>
            </a></blockquote>
                                
          <h3>QA measuring startup and page-load</h3>
                       
          <blockquote>  Daily results get posted to netscape.public.mozilla.performance
 newsgroup<br>
              </blockquote>
                                   
            <hr width="100%" size="2">                                
            
            

<hr class="hide">
</div>
</div>
<div id="footer">
<ul>
<li><a href="../sitemap.html">Site Map</a></li>
<li><a href="../security/">Security Updates</a></li>
<li><a href="../contact/">Contact Us</a></li>
<li><a href="../foundation/donate.html">Donate</a></li>
</ul>
<p class="copyright">
Portions of this content are &copy; 1998&#8211;2009 by individual mozilla.org
contributors; content available under a Creative Commons license | <a
href="http://www.mozilla.org/foundation/licensing/website-content.html">Details</a>.</p>
<p>
<span>Last modified December  6,  2001</span>
<span><a href="http://bonsai-www.mozilla.org/cvslog.cgi?file=mozilla-org/html/performance/startup-perf-brownbag.html&amp;rev=&amp;root=/www/">Document History</a></span>
</p>
</div>
</div>
</body>
</html>
