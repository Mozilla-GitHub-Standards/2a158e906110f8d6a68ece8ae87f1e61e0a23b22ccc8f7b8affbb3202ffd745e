<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<link rel="top" title="Home" href="http://www.mozilla.org/">
<link rel="stylesheet" type="text/css" href="../css/print.css"  media="print">
<link rel="stylesheet" type="text/css" href="../css/base/content.css"  media="all">
<link rel="stylesheet" type="text/css" href="../css/cavendish/content.css" title="Cavendish" media="screen">
<link rel="stylesheet" type="text/css" href="../css/base/template.css"  media="screen">
<link rel="stylesheet" type="text/css" href="../css/cavendish/template.css" title="Cavendish" media="screen">
<link rel="icon" href="../images/mozilla-16.png" type="image/png">

  <meta name="generator" content=
  "HTML Tidy for Windows (vers 14 February 2006), see www.w3.org">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta http-equiv="Content-Language" content="en">
  <meta http-equiv="Content-Style-Type" content="text/css">

  <title>Building A Mozilla Distribution</title>

<script src="../__utm.js" type="text/javascript"></script>
</head>
<body id="www-mozilla-org" class="deepLevel">
<div id="container">
<p class="important">You are currently viewing a snapshot of www.mozilla.org taken on April 21, 2008. Most of this content is
highly out of date (some pages haven't been updated since the project began in 1998) and exists for historical purposes only.  If
there are any pages on this archive site that you think should be added back to www.mozilla.org, please <a
href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=www.mozilla.org">file a bug</a>.</p>
<p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>
<div id="header">
<h1><a href="/" title="Return to home page" accesskey="1">Mozilla</a></h1>
<ul>
<li id="menu_aboutus"><a href="../about/" title="Getting the most out of your online experience">About</a></li>
<li id="menu_developers"><a href="../developer/" title="Using Mozilla's products for your own applications">Developers</a></li>
<li id="menu_store"><a href="http://store.mozilla.org/?r=mozorg1" title="Shop for Mozilla products on CD and other merchandise">Store</a></li>
<li id="menu_support"><a href="../support/" title="Installation, trouble-shooting, and the knowledge base">Support</a></li>
<li id="menu_products"><a href="../products/" title="All software Mozilla currently offers">Products</a></li>
</ul>
<form id="searchbox_002443141534113389537:ysdmevkkknw" action="http://www.google.com/cse" title="mozilla.org Search">
<div>
<label for="q" title="Search mozilla.org's sites">search mozilla:</label>
<input type="hidden" name="cx" value="002443141534113389537:ysdmevkkknw">
<input type="hidden" name="cof" value="FORID:0">
<input type="text" id="q" name="q" accesskey="s" size="30">
<input type="submit" id="submit" value="Go">
</div>
</form>
</div>
<hr class="hide">
<div id="mBody">
<div id="side">

<ul id="nav">
<li><a title="Roadmap" href="../roadmap.html"><strong> Roadmap</strong></a></li>
<li><a title="Projects" href="../projects/"><strong> Projects</strong></a></li>
<li><a title="For developers" href="../developer/"><strong> Coding</strong></a>
<ul>
<li><a title="Module Owners" href="../owners.html"> Module Owners</a></li>
<li><a title="Hacking" href="../hacking/"> Hacking</a></li>
<li><a title="Get the Source" href="http://developer.mozilla.org/en/docs/Download_Mozilla_Source_Code"> Get the Source</a></li>
<li><a title="Building Mozilla" href="http://developer.mozilla.org/en/docs/Build_Documentation"> Build It</a></li>
</ul>
</li>
<li><a title="Testing" href="../quality/"><strong> Testing</strong></a>
<ul>
<li><a title="Downloads of mozilla.org software releases" href="../download.html"> Releases</a></li>
<li><a title="Latest mozilla builds for testers" href="../developer/#builds"> Nightly Builds</a></li>
<li><a title="For testers to report bugs" href="https://bugzilla.mozilla.org/"> Report A Problem</a></li>
</ul>
</li>
<li><a title="Tools for mozilla developers" href="../tools.html"><strong> Tools</strong></a>
<ul>
<li><a title="Bug tracking system for mozilla testers." href="https://bugzilla.mozilla.org/"> Bugzilla</a></li>
<li><a title="Latest status of mozilla builds" href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=Firefox"> Tinderbox</a></li>
<li><a title="Latest checkins" href="http://bonsai.mozilla.org/cvsqueryform.cgi"> Bonsai</a></li>
<li><a title="Source cross reference" href="http://lxr.mozilla.org/seamonkey/"> LXR</a></li>
</ul>
</li>
<li><a title="Frequently Asked Questions." href="../faq.html"><strong> FAQs</strong></a></li>
</ul>

</div>
<hr class="hide">
<div id="mainContent">








  <h1>Building A Mozilla Distribution</h1>

  <p>These are directions for creating your own milestone build or any other
  distribution. You might want to create your own distribution in order to
  create a build for some platform that's not normally on our ftp site or to
  enable some feature that's not supported in the standard builds.</p>

  <ol>
    <li>Download the special milestone source tarball and build from it, not
    from your normal tree. If the tarball isn't out yet, the <a href=
    "http://ftp.mozilla.org/pub/mozilla/releases/mozilla1.2b/README">README</a>
    file in the milestone directory contains instructions for pulling the
    correct source via CVS. Remember to pull from the correct <a href=
    "/releases/cvstags.html">tag</a>. For example,
      <pre class="code">
cvs co -r MOZILLA_1_0_2_RELEASE mozilla/client.mk<br>cd mozilla<br>gmake -f client.mk checkout
</pre>
    </li>

    <li>Set the build options to disable debugging symbols, create optimized
    code, set the build date (which is used in bugzilla) plus whichever other
    options you choose.</li>

    <li>Test your build to make sure it runs and make a note of the BuildID
    number in the lower right hand corner of the app. It should look something
    like <em>2001102513</em> and reflect the date and time you built the
    package.</li>

    <li>Create a README file which contains as much of the following as
    possible.

      <ul>
        <li>Your contact information, including your <a href=
        "https://bugzilla.mozilla.org/">bugzilla</a> id so if someone reports a
        problem specific to your package, the bug can be assigned to you.</li>

        <li>BuildID</li>

        <li>Library dependencies.</li>

        <li>The options you used to create the build.</li>

        <li>Anything non-standard that you enabled (or disabled) in the build
        including patches or links to patches that you applied.</li>
      </ul>
    </li>

    <li>Make the tarball available somewhere and <a href=
    "mailto:ftp-stage@mozilla.org">let us know</a> so we can move it to the ftp
    site. Its would be nice to also create an md5 checksum file for the tarball
    and even nicer if you could digitally sign the md5sum file.
      <pre class="code">
md5sum mozilla-i686-pc-linux-gnu-0.9.5.tar.gz <br>       &gt; mozilla-i686-pc-linux-gnu-0.9.5.tar.gz.md5sum
</pre>
    </li>
  </ol>

  <h2>Creating a distribution</h2>

  <p>It helps to be familiar with the <a href="index.html">build
  instructions</a> and with using the <a href=
  "http://webtools.mozilla.org/build/config.cgi">unix build configurator</a> to
  create a mozconfig file.</p>

  <ol>
    <li><strong>Download the source</strong>.<br>
    <a href="http://ftp.mozilla.org/pub/mozilla/releases/">Download</a> a
    source tarball of the latest milestone. or follow the instructions in the
    current milestone's <a href=
    "http://ftp.mozilla.org/pub/mozilla/releases/mozilla1.2b/README">README</a>
    file to pull by tag from CVS. (If you're making a distribution from code in
    your own private tree you'll probably need to <code>gmake -f
    client.mk</code> distclean first).</li>

    <li>
      <strong>Configure the build environment</strong>.<br>
      Create a file in the tree created from your tarball called <a href=
      "http://webtools.mozilla.org/build/config.cgi">mozilla/.mozconfig</a>.
      You'll want to add these options to make your distribution smaller. The
      <code>--disable-debug</code> option is pretty important otherwise your
      package will be 50mb or more. Normal packages are around 10MB. The
      <code>--enable-optimize option</code> enables the compiler option to
      build optimized binaries. Feel free to turn on other options such as
      <a href="../projects/svg">SVG</a> which aren't enabled in the official
      builds.

      <p>If you are building binaries that will be distributed to a wide
      variety of systems, or which do not have all the same shared libraries to
      link against at runtime, building mozilla's zlib and jpeg libraries for
      distribution is a good idea.</p>
      <pre class="code">
ac_add_options --disable-tests<br>ac_add_options --disable-debug<br>ac_add_options --enable-optimize<br>ac_add_options --without-system-nspr<br>ac_add_options --without-system-zlib<br>ac_add_options --without-system-jpeg<br>ac_add_options --without-system-png<br>ac_add_options --without-system-mng<br>ac_add_options --enable-crypto #comment to disable PSM/SSL support
</pre>

      <p>Set these environment variables so the build date will be set
      correctly.</p>

      <p>Unix/Mac OS X:</p>
      <pre class="code">MOZILLA_OFFICIAL=1
export MOZILLA_OFFICIAL
BUILD_OFFICIAL=1
export BUILD_OFFICIAL
</pre>

      <p>Win32:</p>
      <pre class="code">set MOZILLA_OFFICIAL=1
set BUILD_OFFICIAL=1</pre>
    </li>

    <li>
      <strong>Build the tree</strong>.<br>
      Make sure not to use your regular build command to compile a milestone
      build since you don't want to do a cvs update. If you sync the tree,
      you'll be building from the tip and no longer have a milestone build.
      <pre class="code">
gmake -f client.mk build
</pre>
    </li>

    <li>
      <strong>Add The README</strong>.<br>

      <p>Copy your README file to mozilla/dist/bin so it will be included in
      the tarball created in the next step.  For unix variants with ldd, use
      the following command to create the list of dependencies for unix
      builds:</p>
      <pre class="code">
ldd mozilla-bin components/*.so | awk '{ if (/=/ &amp;&amp; !/not found/ ) print $3 }' | sort | uniq</pre>
If using tcsh, you may need to escape the ! .
    </li>

    <li>
      <strong>Create the package</strong>.<br>

      <ul>
        <li>
          <strong>To create a tarball (or zip or dmg):</strong>

          <p>There is a make file in the packager directory that will create a
          tarball for you in a package directory. It should place your package
          in mozilla/dist.</p>

          <p>For os/2 &amp; win32 builds, the default package type is zip.<br>
          For Mac OS X, the default package type is dmg.<br>
          For all other builds, the default type is tar.gz.</p>
          <pre class="code">
gmake -C mozilla/xpinstall/packager
</pre>
        </li>

        <li>
          <strong>To create a unix installer</strong>:

          <p>To build the unix installer, change to the xpinstall builder
          directory and run the perl script. This creates the file
          <code>mozilla-$platform$-installer.exe</code> in
          <code>mozilla/installer</code>.</p>
          <pre class="code">
cd mozilla/xpinstall/packager/unix/<br>perl deliver.pl &lt;version&gt; &lt;urlpath&gt; &lt;stubname&gt; &lt;blobname&gt;<br>&lt;/blobname&gt;&lt;/stubname&gt;&lt;/urlpath&gt;&lt;/version&gt;
</pre>
        </li>

        <li>
          <strong>To create a win32 installer</strong>, you need the following:

          <ul>
            <li><strong><a href=
            "http://www.activestate.com/Products/ActivePerl/">ActiveState</a>
            or <a href="http://www.cygwin.com/">cygwin</a> Perl</strong></li>

            <li><strong><code>Msvcrt.dll</code> and
            <code>msvcirt.dll</code></strong> These files must be copied to the
            <code class="filename">%MOZ_SRC%\redist\microsoft\system</code>
            directory on your build system. Without these files, the build will
            not fail, but the package you create will have problems on rare
            Windows systems that don't already have the files installed (mostly
            Win95) as described in bug <a href=
            "https://bugzilla.mozilla.org/show_bug.cgi?id=27601">27601</a>. The
            system files can be found at: <a href=
            "http://www.freewarefiles.com/category/library.htm">http://www.freewarefiles.com/category/library.htm</a></li>
          </ul>

          <p>To build the win32 installer, change to the xpinstall builder
          directory and run the perl script. This creates the file
          <code>mozilla-win32-installer.exe</code> in
          <code>mozilla\dist\install</code>.</p>
          <pre class="code">
cd mozilla\xpinstall\wizard\windows\builder
perl build.pl
</pre>
        </li>
      </ul>
    </li>

    <li><strong>Test</strong>.<br>
    Test your package to make sure it works. Our <a href=
    "../quality/smoketests/">smoke tests</a> are designed for this
    purpose.</li>

    <li>
      <strong>Distribute</strong>.<br>
      Make the tarball available somewhere and <a href=
      "mailto:ftp-stage@mozilla.org">let us know</a> so we can move it to the
      ftp site. Let us know the BuildID as well as anything useful about your
      build environment such as the version of the OS, the name of the
      distribution, optional components you included, or whether you're using a
      non-standard compiler.

      <p><strong><em>Every package should include a</em> README
      <em>file.</em></strong></p>
    </li>
  </ol>

  <p class="author">Contact: <a href="mailto:endico@mozilla.org">Dawn
  Endico</a></p>



<hr class="hide">
</div>
</div>
<div id="footer">
<ul>
<li><a href="../sitemap.html">Site Map</a></li>
<li><a href="../security/">Security Updates</a></li>
<li><a href="../contact/">Contact Us</a></li>
<li><a href="../foundation/donate.html">Donate</a></li>
</ul>
<p class="copyright">
Portions of this content are &copy; 1998&#8211;2009 by individual mozilla.org
contributors; content available under a Creative Commons license | <a
href="http://www.mozilla.org/foundation/licensing/website-content.html">Details</a>.</p>
<p>
<span>Last modified January 20,  2007</span>
<span><a href="http://bonsai-www.mozilla.org/cvslog.cgi?file=mozilla-org/html/build/distribution.html&amp;rev=&amp;root=/www/">Document History</a></span>
</p>
</div>
</div>
</body>
</html>
