<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
			"http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<link rel="top" title="Home" href="http://www.mozilla.org/">
<link rel="stylesheet" type="text/css" href="../css/print.css"  media="print">
<link rel="stylesheet" type="text/css" href="../css/base/content.css"  media="all">
<link rel="stylesheet" type="text/css" href="../css/cavendish/content.css" title="Cavendish" media="screen">
<link rel="stylesheet" type="text/css" href="../css/base/template.css"  media="screen">
<link rel="stylesheet" type="text/css" href="../css/cavendish/template.css" title="Cavendish" media="screen">
<link rel="icon" href="../images/mozilla-16.png" type="image/png">

   <TITLE>Building Mac Mozilla</TITLE>
<style type="text/css"><!--
body {
	background: #FFFFFF;
}

p.note {
	font-style:	italic
}
--></style>
<script src="../__utm.js" type="text/javascript"></script>
</head>
<body id="www-mozilla-org" class="deepLevel">
<div id="container">
<p class="important">You are currently viewing a snapshot of www.mozilla.org taken on April 21, 2008. Most of this content is
highly out of date (some pages haven't been updated since the project began in 1998) and exists for historical purposes only.  If
there are any pages on this archive site that you think should be added back to www.mozilla.org, please <a
href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=www.mozilla.org">file a bug</a>.</p>
<p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>
<div id="header">
<h1><a href="/" title="Return to home page" accesskey="1">Mozilla</a></h1>
<ul>
<li id="menu_aboutus"><a href="../about/" title="Getting the most out of your online experience">About</a></li>
<li id="menu_developers"><a href="../developer/" title="Using Mozilla's products for your own applications">Developers</a></li>
<li id="menu_store"><a href="http://store.mozilla.org/?r=mozorg1" title="Shop for Mozilla products on CD and other merchandise">Store</a></li>
<li id="menu_support"><a href="../support/" title="Installation, trouble-shooting, and the knowledge base">Support</a></li>
<li id="menu_products"><a href="../products/" title="All software Mozilla currently offers">Products</a></li>
</ul>
<form id="searchbox_002443141534113389537:ysdmevkkknw" action="http://www.google.com/cse" title="mozilla.org Search">
<div>
<label for="q" title="Search mozilla.org's sites">search mozilla:</label>
<input type="hidden" name="cx" value="002443141534113389537:ysdmevkkknw">
<input type="hidden" name="cof" value="FORID:0">
<input type="text" id="q" name="q" accesskey="s" size="30">
<input type="submit" id="submit" value="Go">
</div>
</form>
</div>
<hr class="hide">
<div id="mBody">
<div id="side">

<ul id="nav">
<li><a title="Roadmap" href="../roadmap.html"><strong> Roadmap</strong></a></li>
<li><a title="Projects" href="../projects/"><strong> Projects</strong></a></li>
<li><a title="For developers" href="../developer/"><strong> Coding</strong></a>
<ul>
<li><a title="Module Owners" href="../owners.html"> Module Owners</a></li>
<li><a title="Hacking" href="../hacking/"> Hacking</a></li>
<li><a title="Get the Source" href="http://developer.mozilla.org/en/docs/Download_Mozilla_Source_Code"> Get the Source</a></li>
<li><a title="Building Mozilla" href="http://developer.mozilla.org/en/docs/Build_Documentation"> Build It</a></li>
</ul>
</li>
<li><a title="Testing" href="../quality/"><strong> Testing</strong></a>
<ul>
<li><a title="Downloads of mozilla.org software releases" href="../download.html"> Releases</a></li>
<li><a title="Latest mozilla builds for testers" href="../developer/#builds"> Nightly Builds</a></li>
<li><a title="For testers to report bugs" href="https://bugzilla.mozilla.org/"> Report A Problem</a></li>
</ul>
</li>
<li><a title="Tools for mozilla developers" href="../tools.html"><strong> Tools</strong></a>
<ul>
<li><a title="Bug tracking system for mozilla testers." href="https://bugzilla.mozilla.org/"> Bugzilla</a></li>
<li><a title="Latest status of mozilla builds" href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=Firefox"> Tinderbox</a></li>
<li><a title="Latest checkins" href="http://bonsai.mozilla.org/cvsqueryform.cgi"> Bonsai</a></li>
<li><a title="Source cross reference" href="http://lxr.mozilla.org/seamonkey/"> LXR</a></li>
</ul>
</li>
<li><a title="Frequently Asked Questions." href="../faq.html"><strong> FAQs</strong></a></li>
</ul>

</div>
<hr class="hide">
<div id="mainContent">


<!--This file created 6/4/02 3:10 PM by Claris Home Page version 3.0 30 Day Trial-->


<H1><CENTER><A NAME="Building_Mac_Mozilla"></A>Building Mac
Mozilla</CENTER></H1>

<P>

<HR>

</P>

<p style="border: 2px solid red; background-color: #FFFF99; padding: 5px;">
<b>Note</b>: These instructions are for building the now-obsolete
CFM build with CodeWarrior. The build instructions for the current
Mach-O build are <a href="mac.html">here</a>.
</p>

<hr>

<H3>Table of Contents</H3>

<P><!--index--></P>

<UL>
   <LI><A HREF="#Building_Mac_Mozilla">Building Mac Mozilla</A></LI>
   
   <LI><A HREF="#System_Requirements">System Requirements</A></LI>
   
   <LI><A HREF="#Tools_and_resources">Tools and resources</A></LI>
   
   <LI><A HREF="#Obtaining_the_source_code_and_building_it">Obtaining
   the source code and building it</A>
   
   <UL>
      <LI><A HREF="#About_Tinderbox">About Tinderbox</A></LI>
      
      <LI><A HREF="#Building_Mac_Mozilla_the_first_time">Building Mac
      Mozilla the first time</A></LI>
      
      <LI><A HREF="#Help_My_build_failed_Why">Help! My build failed!
      Why?</A></LI>
      
      <LI><A HREF="#OK_so_my_build_finished_What_now">OK, so my build
      finished. What now?</A></LI>
   </UL>
   </LI>
   
   <LI><A HREF="#Debugging_tips">Debugging tips</A></LI>
   
   <LI><A HREF="#Environment">Setting environment variables</A></LI>
   
   <LI>More on <A HREF="mac-build-system.html">using and customizing
   the build system</A></LI>
</UL>

<P><!--/index-->

<HR>

</P>

<P>This page aims to be the complete source of information for people
building Mozilla on the Macintosh. Please report deficiencies to
<A HREF="mailto:sfraser@netscape.com"><TT>sfraser@netscape.com</TT></A>.
Please do not email me with questions about how to do stuff, or
suggestions for improving the build process, or anything else that
does not concern information on this page itself. Such questions
should be posted to the newsgroup <A HREF="news://news.mozilla.org/netscape.public.mozilla.mac">
<TT>netscape.public.mozilla.mac</TT></A></P>

<P>For developers who need to add files and projects to the Mac build
system or change your build options, see the <A HREF="mac-build-system.html">Mac
build system page</A>.</P>

<P>

<HR>

</P>

<H3><A NAME="System_Requirements"></A>System Requirements</H3>

<P>To build and run Mozilla, you'll need a beefy Mac with at least
1Gb of disk space, and 128Mb or more of memory. For serious
development, we'd recommend a 300MHz 604 or G3 and 256Mb RAM. In
particular, linking the layout.mcp project requires 80Mb free RAM,
and in an optimized build, you will need around 100Mb of free RAM to
build JavaScript.mcp, and Editor.mcp.</P>

<P>To run Mozilla, you must have MacOS 8.5 or later installed.</P>

<P>

<HR>

</P>

<H3><A NAME="Tools_and_resources"></A>Tools and resources</H3>

<P>Here is the list of software you have to have installed to build
Mozilla on the Mac:</P>

<P>&nbsp;</P>

<P class=note><STRONG>Note</STRONG>: For those internal to Netscape,
there is a pre-prepared development environment on a local AppleShare
server. Please contact a Mac guru for details.</P>

<P ALIGN=right><TABLE BORDER=1 CELLPADDING=12>
   <TR>
      <TD ALIGN=right VALIGN=top>
         <P>CodeWarrior Pro 7.</P>
      </TD>
      <TD VALIGN=top>
         <P>Start with a clean installation of <A HREF="http://www.metrowerks.com">Metrowerks</A>
         CodeWarrior Pro 7.</P>
         
         <P>After finishing your CodeWarrior installation, change the
         memory allocation to the IDE to around 24Mb (Get Info in the
         Finder).</P>
         
         <P>Additionally, you'll find that debugging is substantially
         improved on Mac OS X if you update to Pro7.2.</P>
      </TD>
   </TR>
   <TR>
      <TD>
         <P ALIGN=right><A HREF="ftp://ftp.apple.com/developer/Development_Kits/UniversalInterfaces3.4.1.img.bin">Universal
         Headers 3.4.1</A></P>
      </TD>
      <TD>
         <P>Replace the 3.4 headers that ship with Pro7 with the
         3.4.1 headers from Apple.</P>
      </TD>
   </TR>
   <TR>
      <TD ALIGN=right VALIGN=top>
         <P><A HREF="ftp://ftp.metrowerks.com/pub/updates/CWPRO7/CodeWarrior_Plugin_SDK.zip">CodeWarrior
         Plugin SDK</A><BR>
         (Install this from the Pro 7 Reference disk)</P>
      </TD>
      <TD VALIGN=top>
         <P>We build a CW plugin, the <TT>xpidl</TT> compiler, as
         part of the build process, so you need the CodeWarrior
         Plugin SDK. Install the "(CodeWarrior Plugin SDK)" folder as
         a sibling of the Metrowerks CodeWarrior folder.</P>
         
         <P>Note that the first time you build Mozilla, you will
         probably get an error when building the first IDL project
         (xpcomIDL.mcp). If this happens, quit and restart the
         CodeWarrior IDE so that it picks up the xpidl project that
         was just built. Then restart the build.</P>
      </TD>
   </TR>
   <TR>
      <TD ALIGN=right VALIGN=top>
         <P><A HREF="ftp://ftp.scripting.com/userland/menuSharingToolkit4.1.sit.hqx" name=menusharing>Menu
         Sharing Toolkit 1.4</A><BR>
         (<A HREF="ftp://ftp.accesscom.com//pub/users/s/smfr/utils/menuSharingToolkit4.1.sit">alternative
         download site</A>)</P>
      </TD>
      <TD VALIGN=top>
         <P><A HREF="http://www.scripting.com/frontier/sdk/menuSharing.html">Menu
         Sharing</A> allows other applications to add a menu to
         Mozilla's menu bar. Download, unstuff, and put the "Menu
         Sharing Toolkit 4.1" folder in CodeWarrior's "Mac OS
         Support" folder.</P>
      </TD>
   </TR>
   <TR>
      <TD ALIGN=right VALIGN=top>
         <P><A NAME=toolserver></A>ToolServer<BR>
         (Install MPW from the Pro 7 Reference disk or<BR>
         <A HREF="http://developer.apple.com/tools/mpw-tools/">download
         from Apple</A>)</P>
      </TD>
      <TD VALIGN=top>
         <P>Sometimes, problems can occur when CodeWarrior attempts
         to start up ToolServer. If your build appears to halt when
         building the stubs target of NSStdLib.mcp, this could be the
         problem. Often, simply clicking on the desktop to deactivate
         the IDE causes ToolServer to fire up properly. If this still
         does not work, try moving ToolServer to your startup volume.
         If problems persist, check that you only have one copy of
         ToolServer installed on your machine.</P>
      </TD>
   </TR>
   <TR>
      <TD ALIGN=right VALIGN=top>
         <P><A HREF="http://www.perl.com/CPAN/ports/mac/Mac_Perl_520r4_appl.bin" name=macperl>MacPerl
         distribution</A></P>
      </TD>
      <TD VALIGN=top>
         <P>Download, decompress, and install. You can install this
         anywhere, but it is recommended that you install it next to
         your CodeWarrior folder for easy reference.</P>
         
         <P>After installation, set the memory partition size of the
         MacPerl application to around 18Mb (by doing a Get Info in
         the Finder).</P>
         
         <P><STRONG>Important</STRONG>: Now make a folder called
         'site_perl' in the same directory as the MacPerl
         application. Go to the 'Libraries' panel of the MacPerl
         preferences, and add this 'site_perl' folder as a library
         path, so that it gets searched before the others:</P>
         
         <P><IMG SRC="site_perl.gif" WIDTH=320 HEIGHT=231 ALIGN=bottom vspace=10></P>
         
         <P>You may also want to set a preference to enable
         double-click launch of the perl scripts. This preference is
         set by selecting "Preferences..." from the Edit Menu. Click
         on the "Script" button and hit the radio button "Run Scripts
         opened from Finder".</P>
      </TD>
   </TR>
   <TR>
      <TD ALIGN=right VALIGN=top>
         <P><A HREF="http://www.perl.com/CPAN-local/authors/id/CNANDOR/cpan-mac-0.50.sit.bin">cpan-mac
         distribution</A></P>
      </TD>
      <TD VALIGN=top>
         <P>This is a set of tools by Chris Nandor, and makes
         installation of new modules easier. Download, and
         decompress. If you have more than one copy of MacPerl
         installed, run the copy of MacPerl that you want to install
         on.</P>
         
         <P><STRONG>Important</STRONG>: Make sure you've added the
         <CODE>site_perl</CODE> folder to the search paths in the
         MacPerl prefs before installing the cpan module.</P>
         
         <P>Now run 'INSTALL.plx' in the cpan-mac distribution that
         you just downloaded. It will install lots of files into the
         'site_perl' folder. When it asks you if you want to install
         the droplets, click 'Yes'. You'll use one of these droplets
         to install the next two pieces.</P>
      </TD>
   </TR>
   <TR>
      <TD ALIGN=right VALIGN=top>
         <P><A HREF="http://www.perl.com/CPAN-local/modules/by-category/04_Operating_System_Interfaces/Mac/Mac-AppleEvents-Simple-0.81.tgz">Perl
         AppleEvents module</A></P>
      </TD>
      <TD VALIGN=top>
         <P>This is a Perl module that makes AppleEvent scripting
         easier. Download the file, but <EM>do not decompress
         it.</EM> To install, drag the downloaded file,
         'Mac-AppleEvents-Simple-0.81.tgz', onto the 'installme.plx'
         droplet that was installed with the cpan-mac module. When
         asked if you want to 'Convert all text and MacBinary
         files?', click 'Yes' (do so for the following modules too).
         This will install files into the site_perl directory.</P>
      </TD>
   </TR>
   <TR>
      <TD ALIGN=right VALIGN=top>
         <P><A HREF="http://www.perl.com/CPAN-local/modules/by-category/04_Operating_System_Interfaces/Mac/Mac-Apps-Launch-1.70.tar.gz">Perl
         Launch module</A></P>
      </TD>
      <TD VALIGN=top>
         <P>This is a Perl module for launching applications.
         Download the file, but <EM>do not decompress it.</EM> To
         install, drag the downloaded file,
         'Mac-Apps-Launch-1.70.tar.gz', onto the 'installme.plx'
         droplet that was installed with the cpan-mac module. This
         will install files into the site_perl directory.</P>
      </TD>
   </TR>
   <TR>
      <TD ALIGN=right VALIGN=top>
         <P><A HREF="http://www.perl.com/CPAN-local/authors/id/K/KI/KIMURA/Comprss-Zlib-1.12-bin-1-Mac.tgz">Compress:Zlib
         module</A></P>
      </TD>
      <TD VALIGN=top>
         <P>This Perl module is used for creating jar files on Mac.
         Download the file, but <EM>do not decompress it.</EM> To
         install, drag the downloaded file,
         'Comprss-Zlib-1.12-bin-1-Mac.tgz', onto the 'installme.plx'
         droplet that was installed with the cpan-mac module. This
         will install files into the site_perl directory.</P>
      </TD>
   </TR>
   <TR>
      <TD ALIGN=right VALIGN=top>
         <P><A HREF="http://www.cpan.org/authors/id/N/NE/NEDKONZ/Archive-Zip-0.11.tar.gz">Archive::Zip
         module</A></P>
      </TD>
      <TD VALIGN=top>
         <P>This Perl module is used for creating jar files on Mac.
         Download the file, but <EM>do not decompress it.</EM> To
         install, drag the downloaded file,
         'Archive-Zip-0.11.tar.gz', onto the 'installme.plx' droplet
         that was installed with the cpan-mac module. This will
         install files into the site_perl directory.</P>
      </TD>
   </TR>
   <TR>
      <TD VALIGN=top COLSPAN=2>
         <P>If you want to do a
         <A NAME="static_build_modules"></A>static build, you'll also
         need to install these modules. Note that, for some reason,
         installing these modules takes lots of memory in MacPerl.
         You should allocate 24Mb of memory to MacPerl, and quit and
         restart it after installing each module.</P>
      </TD>
   </TR>
   <TR>
      <TD ALIGN=right VALIGN=top>
         <P><A HREF="http://www.cpan.org/authors/id/T/TJ/TJMATHER/XML-RegExp-0.03.tar.gz">XML::RegExp</A></P>
      </TD>
      <TD VALIGN=top>
         <P>This Perl module provides regular expressions for XML
         tokens, and is a requirement of <CODE>XML::DOM</CODE>.
         Download the file, but <EM>do not decompress it.</EM> To
         install, drag the downloaded file, 'XML-RegExp-0.03.tar.gz',
         onto the 'installme.plx' droplet that was installed with the
         cpan-mac module. This will install files into the site_perl
         directory.</P>
      </TD>
   </TR>
   <TR>
      <TD ALIGN=right VALIGN=top>
         <P><A HREF="http://www.cpan.org/authors/id/T/TW/TWEGNER/XML-Parser-2.30-bin-Mac.tar.gz">XML::Parser</A></P>
      </TD>
      <TD VALIGN=top>
         <P>This Perl module provides XML parsing functionality
         (using Expat), and is used by <CODE>XML::DOM</CODE> to parse
         XML-format CodeWarrior project files. Download the file, but
         <EM>do not decompress it.</EM> To install, drag the
         downloaded file, 'XML-Parser-2.30-bin-Mac.tar.gz', onto the
         'installme.plx' droplet that was installed with the cpan-mac
         module. This will install files into the site_perl
         directory.</P>
      </TD>
   </TR>
   <TR>
      <TD ALIGN=right VALIGN=top>
         <P><A HREF="http://www.cpan.org/authors/id/T/TJ/TJMATHER/XML-DOM-1.31.tar.gz">XML::DOM</A></P>
      </TD>
      <TD VALIGN=top>
         <P>This Perl module allows for DOM manipulations of
         XML-format CodeWarrior projects. Download the file, but
         <EM>do not decompress it.</EM> To install, drag the
         downloaded file, 'XML-DOM-1.31.tar.gz', onto the
         'installme.plx' droplet that was installed with the cpan-mac
         module. This will install files into the site_perl
         directory.</P>
      </TD>
   </TR>
</TABLE>
</P>

<H2><A NAME="Obtaining_the_source_code_and_building_it"></A>Obtaining
the source code and building it</H2>

<P>Using the <A HREF="http://www.maccvs.org">MacCVS Pro client</A>,
create a new CVS session file, or download a ready-made session file
<A HREF="MozillaSession.sit">here</A> (all you need to set in this
file is to enter 'anonymous' as the cvs password). If you are making
a new session file, set your preferences from <TT>Edit -&gt; Session
Settings</TT>:</P>

<P><TABLE BORDER=0 BGCOLOR="#EEEEEE" CELLPADDING=5>
   <TR>
      <TH VALIGN=top COLSPAN=2 BGCOLOR="#DDDDDD">
         <P>Checkout and Update Options</P>
      </TH>
   </TR>
   <TR>
      <TD VALIGN=top>
         <P>Local Tree Directory</P>
      </TD>
      <TD VALIGN=top>
         <P>Wherever you'd like the source code to be kept. A built
         tree currently uses about 508Mb of disk space. Ensure that
         the tree is on an HFS+ volume, otherwise the amount of space
         used will be much more.</P>
      </TD>
   </TR>
   <TR>
      <TD VALIGN=top>
         <P>Merge Policy</P>
      </TD>
      <TD VALIGN=top>
         <P><TT>Auto Merge Text Files and Update Binary
         Files</TT></P>
      </TD>
   </TR>
   <TR>
      <TD VALIGN=top>
         <P>Default Module</P>
      </TD>
      <TD VALIGN=top>
         <P><TT>mozilla/build/mac/build_scripts</TT></P>
      </TD>
   </TR>
   <TR>
      <TD VALIGN=top>
         <P>Default Revision</P>
      </TD>
      <TD VALIGN=top>
         <P><TT>(LEAVE BLANK)</TT></P>
      </TD>
   </TR>
   <TR>
      <TH VALIGN=top COLSPAN=2 BGCOLOR="#DDDDDD">
         <P>Remote Host Information</P>
      </TH>
   </TR>
   <TR>
      <TD VALIGN=top>
         <P>Server Hostname</P>
      </TD>
      <TD VALIGN=top>
         <P><TT>cvs-mirror.mozilla.org</TT></P>
      </TD>
   </TR>
   <TR>
      <TD VALIGN=top>
         <P>CVS User Name</P>
      </TD>
      <TD VALIGN=top>
         <P><TT>anonymous</TT></P>
      </TD>
   </TR>
   <TR>
      <TD VALIGN=top>
         <P>CVS Password</P>
      </TD>
      <TD VALIGN=top>
         <P><TT>anonymous</TT></P>
      </TD>
   </TR>
   <TR>
      <TD VALIGN=top>
         <P>CVS Root</P>
      </TD>
      <TD VALIGN=top>
         <P><TT>/cvsroot</TT></P>
      </TD>
   </TR>
   <TR>
      <TD VALIGN=top>
         <P>Network Time Out</P>
      </TD>
      <TD VALIGN=top>
         <P><TT>10 Minutes</TT></P>
      </TD>
   </TR>
   <TR>
      <TH VALIGN=top COLSPAN=2 BGCOLOR="#DDDDDD">
         <P>Encoding and File Mappings</P>
      </TH>
   </TR>
   <TR>
      <TD VALIGN=top>
         <P>Add</P>
      </TD>
      <TD VALIGN=top>
         <P>You may want to map the .pl extension to MacPerl, so that
         you can double-click on the build scripts from the Finder.
         Click <TT>Add</TT> and enter</P>
         
         <PRE>Suffix <TT>.pl</TT>, Type <TT>TEXT</TT>, Creator <TT>McPL</TT></PRE>
         
         <P>Be sure to use Macintosh linefeeds!</P>
         
         <P>You may also wish to add mappings for MacPerl modules
         (.pm), JavaScript (.js), XUL (.xul), CSS (.css), DTD files
         (.dtd) and HTML (.html) to map them to your favorite editor
         (e.g. use <TT>R*ch</TT> for BBEdit).</P>
      </TD>
   </TR>
</TABLE>
</P>

<H3><A NAME="About_Tinderbox"></A>About Tinderbox</H3>

<P><TABLE BORDER=1 CELLPADDING=10>
   <TR>
      <TD BGCOLOR="#DDDDCC">
         <P><A HREF="http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey&hours=4&nocrap=1">Tinderbox</A>
         is your one-stop shop for build process information. Be
         aware that the tree (the source code repository) is changing
         hourly, and you'll find people checking in code day and
         night. You want to pull your source when the tree is good
         and building (when it shows green). The columns to look at
         are "Mac Debug Clbr", "Mac Opt Clbr", and "Mac Opt Depend".
         Here is what those mean:</P>
         
         <P>&nbsp;</P>
         
         <DL>
            <DT>Mac Debug Clbr</DT>
            
            <DD>The Macintosh Debug, Clobber build. This builds the
            debug targets of all projects, and is 'clobber', which
            means that it pulls a fresh source tree for each build.
            This makes it slow.</DD>
            
            <DT>Mac Opt Clbr</DT>
            
            <DD>The Macintosh Optimized, Clobber build. This builds
            the non-debug targets of all projects, and is 'clobber',
            which means that it pulls a fresh source tree for each
            build. This makes it slow.</DD>
            
            <DT>Mac Opt Dep</DT>
            
            <DD>The Macintosh Optimized, Depend build. This just
            pulls updates into an existing tree and rebuilds, which
            can be much faster.</DD>
         </DL>
      </TD>
   </TR>
</TABLE>
</P>

<H3><A NAME="Building_Mac_Mozilla_the_first_time"></A>Building Mac
Mozilla the first time</H3>

<P><STRONG>Warning:</STRONG> You will be downloading tens of
megabytes of source code. If you are using a modem connection, be
prepared for hours and hours of download time. Be aware that a built
tree takes about a gigabyte of hard disk space.</P>

<P>Before pulling the source code, always make sure the Macintosh
build column on <A HREF="http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey&hours=4&nocrap=1">
tinderbox</A> is green. Redness on tinderbox presages a pull that
will not build. If the Macintosh build is showing red, you might as
well go to a movie and try later. You should add this tinderbox link
to your bookmarks, even to your personal toolbar.</P>

<P>Now, to start the build process, there are some things you have to
do only the first time:</P>

<P>&nbsp;</P>

<OL>
   <LI>Check out the module <TT>mozilla/build/mac/build_scripts</TT>.
   If you've followed the instructions above, you can just select the
   menu<BR>
   <TT>Action | Check Out Default Module</TT>.
   
   <P>&nbsp;</P></LI>
   
   <LI>Once CVS is done checking out the build directory, go to your
   local tree directory and open it. Drill down to the
   <TT>:mozilla:build:mac:build_scripts</TT> folder, and you should
   see several build scripts waiting for you, namely
   <TT>BuildMozilla.pl</TT> and <TT>BuildMozillaDebug.pl</TT>.
   
   <P>&nbsp;</P></LI>
   
   <LI>Run either <TT>BuildMozilla.pl</TT> (for an optimized build)
   or <TT>BuildMozillaDebug.pl</TT> (for a debug build) to start the
   build process. Just drag that file onto MacPerl, or run it in
   MacPerl whatever other way you prefer. Note that a debub build
   will probably finish more reliably, due to the overly high memory
   requirements of CodeWarrior during an optimized build.
   
   <P>The first time you run the build script, it will prompt you for
   the location of the CodeWarrior application (if not already
   running), and your MacCVS Pro session file, which you set up
   above. This file will be used to check out the rest of the tree.
   These two pieces of information are stored, and you won't be asked
   for them again.</P>
   
   <P>Because various minor errors occur when checking out the tree
   (for example, there are some files with names that are too long
   for the Mac filesystem), MacPerl will probably report that the
   checkout failed. This error is benign; you can ignore it.</P>
   
   <P>Once the checkout is complete, the script will continue and
   start the build process. It will build all the projects and create
   a Macintosh application directory in
   <TT>:mozilla:dist:viewer_debug:</TT> within your source tree. In
   that folder, you'll find a couple of applications: Mozilla, which
   is what will become the final browser, and viewer, which is a
   small app that is used for testing the layout engine.</P>
   
   <P>For more details on how to control the build, see the <A HREF="mac-build-system.html">Mac
   build system page</A>.</P></LI>
</OL>

<P>

<HR>

</P>

<H3><A NAME="Help_My_build_failed_Why"></A>Help! My build failed!
Why?</H3>

<P>Common reasons for build failure:</P>

<OL>
   <LI><I>MacPerl fails to run any of the scripts</I>
   
   <P>This is probably because the perl scripts were checked out with
   Unix linebreaks. Go into the MacCVS Pro session settings, and make
   sure that .pl and .pm files are using Macintosh linebreaks. Then
   trash mozilla/build/mac, and pull the scripts again.</P></LI>
   
   <LI><I>I get errors from MacPerl when I try to run the
   scripts!</I>
   
   <P>This is probably because there is something wrong with your
   installation of MacPerl, or the additions that are required.
   Ensure that you followed the installation instructions above,
   especially the part about adding "site_perl" to your MacPerl
   folder path preferences.</P></LI>
   
   <LI><I>When the scripts pull a tree, MacPerl tells me that the
   checkout failed!</I>
   
   <P>This is actually normal, or at least fairly common. There are
   files in the tree with names that are too long for the Mac
   filesystem (luckily, none that Mac needs!), and these and other
   minor CVS errors can confuse the checkout process.</P>
   
   <P>If you have changes in your tree, and you get CVS conflicts
   when updating, then you'll certainly see checkout errors. In that
   case, look at the messages window in MacCVS for conflict warnings,
   and deal with the conflicts.</P></LI>
   
   <LI><I>This is my first time building, and my build fails at
   XPCOMIDL.mcp with a message about xpidl not being found</I>
   
   <P>We build the xpidl plugins as part of the build, but the IDE
   does not pick these up without quitting and restarting. We tried
   to script this quit and restart, but it made MacPerl unhappy. So
   the first time you build, you'll have to quit and restart the IDE
   by hand, then restart the build.</P></LI>
   
   <LI><I>When the build gets to NSStdLib.mcp, it stalls.</I>
   
   <P>What's happening here is that we're building the Stubs target
   of NSStdLib.mcp, which uses the RunTSScript CodeWarrior plugin to
   fire up ToolServer, which builds a stubs library (using the
   MakeStub tool) from the .exp file of that project. (Got it?) So a
   number of things can go wrong here:</P>
   
   <UL>
      <LI>You didn't copy the 'RunTSScript' CW tool from
      mozilla:build:mac to your CodeWarrior Plugins folder.</LI>
      
      <LI>ToolServer is not happy. Make sure that you can run it
      standalone (or via CodeWarrior's ToolServer menu), and that you
      don't have multiple copies on your machine. Also ensure that
      you are running the right version for your OS (you should have
      ToolServer 3.5 for Mac OS 9).</LI>
      
      <LI>You're suffering from some weirdness with events, that
      causes things to stall until you switch the IDE to the
      background. Often just clicking around will get things moving
      again.</LI>
   </UL>
   
   <P>&nbsp;</P></LI>
   
   <LI><I>The build halts because some code does not compile! How the
   heck can this ever work?</I>
   
   <P>You probably updated your tree at a bad time. Don't forget to
   check <A HREF="http://tinderbox.mozilla.org/showbuilds.cgi?tree=SeaMonkey&nocrap=1">Tinderbox</A>
   before you update!</P></LI>
   
   <LI><I>layout.mcp fails to link, with some random error.</I>
   
   <P>You probably don't have enough free memory available. Quit
   other programs, and try again.</P></LI>
   
   <LI><I>JavaScript.mcp or Editor.mcp fails to compile, with an
   <A NAME="out_of_memory"></A>out of memory error.</I>
   
   <P>Building some of the files in these projects in optimized mode
   takes huge amounts of memory; we seem to hit some pathological
   case in the CW optimizer. You can either try to free up enough
   memory (on a 128Mb machine, restart the machine, load CodeWarrior
   and nothing else, and you should be able to just about build the
   project). Allocating more RAM to CodeWarrior will not help (it
   uses temporary memory). Alternatively, you can <A HREF="mac-build-system.html#Doing_a_lowmem_build">modify
   your build prefs</A> to use a lower optimization level in the
   optimized build.</P></LI>
</OL>

<P>

<HR>

</P>

<H3><A NAME="OK_so_my_build_finished_What_now"></A>OK, so my build
finished. What now?</H3>

<P>Congratulations!</P>

<P>Now, to run the Mozilla browser, look in mozilla:dist:viewer_debug
(or just :viewer if you built optimized). You should find the app,
'MozillaDebug', and a .xSYM file. To run, or start debugging, run
this app or load the .xSYM file in CodeWarrior.</P>

<P>You'll also notice that this app is only around 200K in size.
That's because most of the code lives in shared libraries, which go
into the Essential Files folder (these are libs that are loaded
automatically by CFM), and the Components folder (these libs are
XPCOM modules, and are loaded by the app at runtime). So when you are
debugging, you'll have to grovel around in these folders for the
appropriate .xSYM files.</P>

<P>

<HR>

</P>

<H3><A NAME="Debugging_tips"></A>Debugging tips</H3>

<P>So you've hit an assertion, or found a crash. How to debug it?
It's often easiest to run Mozilla without the debugger first, so you
drop into MacsBug on an assertion or crash. You can then get a stack,
and log this to a file (<TT>log my_crash,sc,log</TT>).</P>

<P>If you're in the Metrowerks debugger and halt for some reason, it
can be a little harder to find out where you are. The debugger should
show fragment names in the stack pain (try using the older, stand
alone debugger MWDebug 1.7.4, which is a little better at debugging
across shared libraries). Locate the .xSYM file that corresponds to
the fragment name, and load it.</P>

<P>Another problem that we often run into is that the MW debugger
can't show the contents of interface pointers (<CODE>nsIFoo</CODE>),
which has been submitted as a bug to Metrowerks. To work around this,
you'll have to step into some code that uses the concrete class
behind the interface; it may be necessary to add a dummy call to the
code to be able to do this.</P>

<P>

<HR>

</P>

<H3><A NAME=Environment></A>Setting environment variables</H3>

<P>Classic Mac OS has no concept of environment variables, but there
are several developer features in Mozilla that relies on environment
variables, so we have a couple of ways to set these up for
Mozilla.</P>

<H4>Startup file</H4>

<P>If you do a Mozilla bulid, you'll have a file called 'NSPR
Logging' in the same directory as the application. It contains some
lines like:</P>

<PRE>
ENV:NSPR_LOG_MODULES=nsComponentManager:5
ENV:NSPR_LOG_FILE=xpcom.log
</PRE>

<P>If you start Mozilla by dragging this file onto it, Mozilla will
pick up those environment variables. You can edit this file, or make
another file; just edit the 'ENV' lines. This technique is useful if
you want Mozilla to use those environment variables only for some
runs where you need them.</P>

<H4>ENVIRONMENT file</H4>

<P>If you make a file called 'ENVIRONMENT' (case does not matter) and
put it in the same folder as Mozilla, Mozilla will look in this file
when it runs, and pick up environment variables within it. The file
contents should look like:</P>

<PRE>
NSPR_LOG_MODULES=nsComponentManager:5
NSPR_LOG_FILE=xpcom.log
</PRE>

<P>

<HR>

</P>

<H3>More information</H3>

<P>For more information about the Mac build system, see the <A HREF="mac-build-system.html">Mac
build system page</A>. If you are interested in contributing, and
need information, please post on the <A HREF="news://news.mozilla.org/netscape.public.mozilla.mac">
<TT>netscape.public.mozilla.mac</TT></A> newsgroup.</P>

<P>

<HR>

<A HREF="mailto:sfraser@netscape.com">Simon Fraser</A></P>



<hr class="hide">
</div>
</div>
<div id="footer">
<ul>
<li><a href="../sitemap.html">Site Map</a></li>
<li><a href="../security/">Security Updates</a></li>
<li><a href="../contact/">Contact Us</a></li>
<li><a href="../foundation/donate.html">Donate</a></li>
</ul>
<p class="copyright">
Portions of this content are &copy; 1998&#8211;2009 by individual mozilla.org
contributors; content available under a Creative Commons license | <a
href="http://www.mozilla.org/foundation/licensing/website-content.html">Details</a>.</p>
<p>
<span>Last modified March 14,  2003</span>
<span><a href="http://bonsai-www.mozilla.org/cvslog.cgi?file=mozilla-org/html/build/mac_cfm.html&amp;rev=&amp;root=/www/">Document History</a></span>
</p>
</div>
</div>
</body>
</html>
