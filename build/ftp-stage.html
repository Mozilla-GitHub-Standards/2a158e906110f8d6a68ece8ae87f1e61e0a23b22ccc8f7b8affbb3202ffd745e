<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
                      "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<link rel="top" title="Home" href="http://www.mozilla.org/">
<link rel="stylesheet" type="text/css" href="../css/print.css"  media="print">
<link rel="stylesheet" type="text/css" href="../css/base/content.css"  media="all">
<link rel="stylesheet" type="text/css" href="../css/cavendish/content.css" title="Cavendish" media="screen">
<link rel="stylesheet" type="text/css" href="../css/base/template.css"  media="screen">
<link rel="stylesheet" type="text/css" href="../css/cavendish/template.css" title="Cavendish" media="screen">
<link rel="icon" href="../images/mozilla-16.png" type="image/png">

<TITLE>How To Add Files To ftp.mozilla.org (Draft)</TITLE>
<script src="../__utm.js" type="text/javascript"></script>
</head>
<body id="www-mozilla-org" class="deepLevel">
<div id="container">
<p class="important">You are currently viewing a snapshot of www.mozilla.org taken on April 21, 2008. Most of this content is
highly out of date (some pages haven't been updated since the project began in 1998) and exists for historical purposes only.  If
there are any pages on this archive site that you think should be added back to www.mozilla.org, please <a
href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=www.mozilla.org">file a bug</a>.</p>
<p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>
<div id="header">
<h1><a href="/" title="Return to home page" accesskey="1">Mozilla</a></h1>
<ul>
<li id="menu_aboutus"><a href="../about/" title="Getting the most out of your online experience">About</a></li>
<li id="menu_developers"><a href="../developer/" title="Using Mozilla's products for your own applications">Developers</a></li>
<li id="menu_store"><a href="http://store.mozilla.org/?r=mozorg1" title="Shop for Mozilla products on CD and other merchandise">Store</a></li>
<li id="menu_support"><a href="../support/" title="Installation, trouble-shooting, and the knowledge base">Support</a></li>
<li id="menu_products"><a href="../products/" title="All software Mozilla currently offers">Products</a></li>
</ul>
<form id="searchbox_002443141534113389537:ysdmevkkknw" action="http://www.google.com/cse" title="mozilla.org Search">
<div>
<label for="q" title="Search mozilla.org's sites">search mozilla:</label>
<input type="hidden" name="cx" value="002443141534113389537:ysdmevkkknw">
<input type="hidden" name="cof" value="FORID:0">
<input type="text" id="q" name="q" accesskey="s" size="30">
<input type="submit" id="submit" value="Go">
</div>
</form>
</div>
<hr class="hide">
<div id="mBody">
<div id="side">

<ul id="nav">
<li><a title="Roadmap" href="../roadmap.html"><strong> Roadmap</strong></a></li>
<li><a title="Projects" href="../projects/"><strong> Projects</strong></a></li>
<li><a title="For developers" href="../developer/"><strong> Coding</strong></a>
<ul>
<li><a title="Module Owners" href="../owners.html"> Module Owners</a></li>
<li><a title="Hacking" href="../hacking/"> Hacking</a></li>
<li><a title="Get the Source" href="http://developer.mozilla.org/en/docs/Download_Mozilla_Source_Code"> Get the Source</a></li>
<li><a title="Building Mozilla" href="http://developer.mozilla.org/en/docs/Build_Documentation"> Build It</a></li>
</ul>
</li>
<li><a title="Testing" href="../quality/"><strong> Testing</strong></a>
<ul>
<li><a title="Downloads of mozilla.org software releases" href="../download.html"> Releases</a></li>
<li><a title="Latest mozilla builds for testers" href="../developer/#builds"> Nightly Builds</a></li>
<li><a title="For testers to report bugs" href="https://bugzilla.mozilla.org/"> Report A Problem</a></li>
</ul>
</li>
<li><a title="Tools for mozilla developers" href="../tools.html"><strong> Tools</strong></a>
<ul>
<li><a title="Bug tracking system for mozilla testers." href="https://bugzilla.mozilla.org/"> Bugzilla</a></li>
<li><a title="Latest status of mozilla builds" href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=Firefox"> Tinderbox</a></li>
<li><a title="Latest checkins" href="http://bonsai.mozilla.org/cvsqueryform.cgi"> Bonsai</a></li>
<li><a title="Source cross reference" href="http://lxr.mozilla.org/seamonkey/"> LXR</a></li>
</ul>
</li>
<li><a title="Frequently Asked Questions." href="../faq.html"><strong> FAQs</strong></a></li>
</ul>

</div>
<hr class="hide">
<div id="mainContent">




<H1>How To Add Files To ftp.mozilla.org</H1>

<p>
To get a file added to ftp.mozilla.org contact 
<A HREF="mailto:ftp-stage@mozilla.org">ftp-stage@mozilla.org</A>
to get someone to add your file for you. If you're a regular contributor,
you can ask to get access to add the files yourself. This document
describes how to get an account, the rules for using it, and some
instructions on getting started. 
</p>

<p>
You don't put files on the ftp server directly. Instead, you'll get
a unix shell account on a staging server named stage.mozilla.org. 
You'll place your files on the staging server and they are automatically 
copied over to the main ftp server periodically. Log in to the 
staging server using ssh and copy files to the machine using either 
scp or sftp (secure ftp). After a time, nightly builds (and possibly
other files) are deleted due to space constraints.
</p>

<H2>Terms Of Service</H2>

To get an account you'll need to sign our contributor form and 
agree to our terms.

<UL>
<LI>
Only use your account on stage.mozilla.org for maintaining the ftp site.
Don't use the account to send or receive email. Don't use the machine to 
store files. If we're running low on disk space, stuff in your home
directory may get deleted.
</LI>

<LI>
Don't upload stuff copyrighted by other people without their permission. 
</LI>

<LI>
On Windows, be sure to run a virus scanner.  Files uploaded to the 
staging server are checked nightly for viruses.  If a virus is found 
on a file you uploaded it will be removed and your account will be 
disabled until you are sure your machine is virus-free.
</LI>
</UL>

<H2>What You'll Need</H2>
<p>
To get started you'll need an installation of ssh including scp or sftp. 
Our server runs OpenSSH 2.x and can handle ssh 1 or ssh 2 clients.
If you don't already have it, get a free copy of the ssh client from 
<A HREF="http://openssh.com/">openssh.com</A> or use some other ssh
implementation.  Most of the directions here are for openssh so if you
use something else the commands may vary.
</p>

<p>
On Windows, its easiest to use OpenSSH from the Cygwin package.
You probably already have this since Cygwin is required to build
Mozilla. You can get Cygwin from 
<A HREF="http://www.cygwin.com/">cygwin.com</A>.

On mac, try 
<A HREF="http://www.macssh.com/">MacSSH</A>
NiftyTelnet
<A HREF="http://www.lysator.liu.se/~jonasw/freeware/niftyssh/">NiftyTelnet 1.1 SSH</A>.

For documentation on SSH, the OpenSSH group recommends the O'Reilly 
<A HREF="http://www.snailbook.com/">snail book</A>.
</p>

<p>
It helps a lot to have an understanding of basic unix commands in order
to copy, rename and move files around although I'll try and document the
important commands here.  If you're more comfortable with with using
ftp, try getting an implementation of ssh2 which contains sftp. This
is contained in the latest version of openssh. I'm not aware of any
mac clients that have sftp. On windows, only daily snapshot builds
of cygwin since March 1 contain it although you can probably find
non-free clients with sftp.  On Linux, be sure not to confuse
'secure ftp' with 'simple ftp' which is also known as 'sftp'.
</p>



<H2>How To Get An Account</H2>
<UL>
<LI>
contribute stuff so consistantly that people on the stage@mozilla.org
alias get sick of adding your files.
</LI>

<LI>
Fill out a contributor form, fax it, mail it.
</LI>

<LI>
Open a bug requesting an account and note in it that you
have faxed your form. 
</LI>

<LI>
Create an ssh key if you don't have one already and attach your
public key to the bug.  

With OpenSSH, if you're using an ssh2 client type <CODE>ssh-keygen -d </CODE>.
If that didn't work, then just type <CODE>ssh-keygen</CODE>.
<P>
With MacSSH:
<UL>
<LI>
Go to Favorites &gt; Edit Favorites...
<LI>
Pick your host
<LI>
Click on Change
<LI>
In the SSH2 tab, click on Initialize SSH
This creates "identity" and "identity.pub" in the same directory with your 
  MacSSH application
<LI>
 <i>identity</i> is your private key and <i>identity.pub</i> is the public key.
<LI>
If you need to upload one, click the "Export public key" format to get 
it in the format most of the ssh servers want in your home directory.
</UL>
</LI>
</UL>

<H2>How It Works</H2>

<UL>
<LI>
The staging area is in /home/ftp/pub of stage.mozilla.org.
</LI>

<LI>
The ftp server syncs with the staging area every 10 minutes.
These updates only add or replace files. 
</LI>

<LI>
File deletions only occur once per day at 2:30am PST. If you accidently
delete files, you should be able retrieve the file from the main ftp site.
</LI>

<LI>
Since updates happen so often you may want to upload files to your
home directory and then move the files to the staging area once everything
has uploaded. If you don't, its possible that your partially uploaded
file could be copied to the ftp server. 
</LI>

<LI>
When creating directories in the mozilla nightly or releases directories,
be sure group ownership is set to 'mozilla' and that the directory is group 
writable so others can add files that directory as well.
</LI>

<LI>
When adding a milestone build to a directory in mozilla/releases,
add your name as a contributor to the bottom the the README file.
</LI>

</UL>

<H2>Getting Started</H2>

These basic commands will get you started:
<BLOCKQUOTE>
<PRE>
umask 002
ssh -l &lt;yourloginid&gt; stage.mozilla.org &lt;unix-command&gt;
scp -p &lt;localfile&gt; &lt;yourloginid&gt;@stage.mozilla.org:/home/ftp/pub/&lt;path&gt;
</PRE>
</BLOCKQUOTE>


<UL>
<LI>
Set the umask on your local machine so the file will be readable by others
when you copy them to the staging server.
<PRE>
umask 002
</PRE>
</LI>

<LI>
Copy a file to the latest directory.
<PRE>
scp mozilla-win32.exe \
  beauzeau@stage.mozilla.org:/home/ftp/pub/mozilla/latest
</PRE>
</LI>

<LI>
Create a new directory.
<PRE>
ssh -l beauzeau stage.mozilla.org \
  mkdir /pub/mozilla/nightly/2001-03-18-22-Mtrunk
</PRE>
</LI>

<LI>
Copy a directory and its contents to the staging area. Preserve the 
mode and time stamps of original files.
<PRE>
scp -rp 2001-04-01-09 beauzeau@stage.mozilla.org:/home/ftp/pub/mozilla/nightly
</PRE>
</LI>

<LI>
Execute a command on the staging server which fixes directory permissions 
so others can add files to the directory as well.
<PRE>
ssh -l beauzeau stage.mozilla.org chmod 775 \
  /home/ftp/pub/mozilla/nightly/2001-04-01-09 \; \
  chgrp mozilla /home/ftp/pub/mozilla/nightly/2001-04-01-09
</PRE>
You may need to pass the -R option to the chmod and chgrp commands so that
they also fix the permissions on all the files and subdirectories in the
directory. Use the ls -l command to verify the group and permissions are
correct.
<PRE>
ssh -l beauzeau stage.mozilla.org ls -l \
  /home/ftp/pub/mozilla/nightly/2001-04-01-09
</PRE>
</LI>
</UL>

<H2>Scripting</H2>
<P>
If you use a script to generate files or data, you've problably
noticed that you can add <code>ssh</code> and <code>scp</code>
commands to your script but that when those commands are executed
the script stops, waiting for you to type in your passphrase. Not
very automated, is it?  To work around this problem, use the utility
<code>ssh-agent</code> to store your keys. With this daemon running
in the background, subsequent invocations of <code>ssh</code> and
<code>scp</code> won't require you to type in the password. Following,
are some example scripts and an explanation of what they do.
</P>
<OL>
<LI>
Start <code>ssh-agent</code>. Redirect the output to a file for 
later use by scripts. Set permissions on the file so others may not access it.
The output of <code>ssh-agent</code> is commands to set the
SSH_AUTH_SOCK and SSH_AGENT_PID environment variables. When these are
set, in your shell or in your script, subsequent invocations of 
<code>ssh-add</code>, <code>ssh</code> and <code>scp</code> will use
that ssh-agent for handling credentials and you won't have to keep
retyping your passphrase.
</LI>

<LI>
Set the environment variables output by ssh-agent when you started it.
Run <code>ssh-add</code> and type your passphrase when it prompts you.
</LI>

<LI>
In your script, set the ssh-agent variables you set in step one.
Now, when you use <code>ssh</code> or <code>scp</code> you shouldn't
need to type a passphrase.
</LI>

<LI>
When you're done, be sure to kill your ssh-agent with <code>
ssh-agent -k</code>. 
</LI>

</OL>

<BLOCKQUOTE>
<PRE>
------- script to start ssh-agent and enter password -------------
#!/bin/sh

ssh-agent -s &gt ~/.ssh/agentvars  # use -s for use in bourne shell scripts
#ssh-agent -c &gt ~/.ssh/agentvars # use -c for use in C shell scripts
chmod 700 ~/.ssh
chmod 600 ~/.ssh/agentvars
source ~/.ssh/agentvars
ssh-add
------------------------------------------------------------------
</PRE>
</BLOCKQUOTE>

<BLOCKQUOTE>
<PRE>
-------- example script that uses scp without password -----------
#!/bin/sh

user=beauzeau
source ~/.ssh/agentvars
# add the above two lines to your own script. replace
# 'beauzeau' with your own user account on stage.mozilla.org

date &gt; blah.date
umask 002
scp blah.date $user@stage.mozilla.org:/home/$user
echo done!
ssh-agent -k
echo agent killed!
------------------------------------------------------------------
</PRE>
</BLOCKQUOTE>

<H2>Troubleshooting</H2>
<UL>
<LI>
Our ssh server runs OpenSSH 2.x. To connect to it with an
OpenSSH 2.x client, you'll need to use a DSA key. The keygen
command creates an RSA key by default. You need to run
<code>ssh-keygen -d</code> to create a DSA key.
</LI>

<LI>
If you use SSH Secure Shell for Win32 from SSH Communications Security 
(<A HREF="http://www.ssh.com/">www.ssh.com</A>) you'll need to convert
your private key over to the openssh format before adding it to your 
authorized keys file using
<PRE>
ssh-keygen -X -f authorized_keys2.orig &gt; authorized_keys2
</PRE>
</LI>
<LI>
The machine you connect from must have both forward and reverse
DNS entries and your network's DNS server must be operating 
or your connection will be refused.
</LI>
</UL>

<P>
Many thanks to 
<A HREF="http://sourceforge.net/">Source Forge</A>, for hosting
our staging server, stage.mozilla.org. 
</P> 

<p>
Contact: FTP Admin 
&lt;<A HREF="mailto:ftp-stage@mozilla.org">ftp-stage@mozilla.org</A>&gt;
</p>




<hr class="hide">
</div>
</div>
<div id="footer">
<ul>
<li><a href="../sitemap.html">Site Map</a></li>
<li><a href="../security/">Security Updates</a></li>
<li><a href="../contact/">Contact Us</a></li>
<li><a href="../foundation/donate.html">Donate</a></li>
</ul>
<p class="copyright">
Portions of this content are &copy; 1998&#8211;2009 by individual mozilla.org
contributors; content available under a Creative Commons license | <a
href="http://www.mozilla.org/foundation/licensing/website-content.html">Details</a>.</p>
<p>
<span>Last modified May 26,  2006</span>
<span><a href="http://bonsai-www.mozilla.org/cvslog.cgi?file=mozilla-org/html/build/ftp-stage.html&amp;rev=&amp;root=/www/">Document History</a></span>
</p>
</div>
</div>
</body>
</html>
