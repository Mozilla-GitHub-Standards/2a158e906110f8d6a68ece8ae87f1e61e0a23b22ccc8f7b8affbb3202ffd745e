<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
<link rel="top" title="Home" href="http://www.mozilla.org/">
<link rel="stylesheet" type="text/css" href="../../css/print.css"  media="print">
<link rel="stylesheet" type="text/css" href="../../css/base/content.css"  media="all">
<link rel="stylesheet" type="text/css" href="../../css/cavendish/content.css" title="Cavendish" media="screen">
<link rel="stylesheet" type="text/css" href="../../css/base/template.css"  media="screen">
<link rel="stylesheet" type="text/css" href="../../css/cavendish/template.css" title="Cavendish" media="screen">
<link rel="icon" href="../../images/mozilla-16.png" type="image/png">

   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.74 [en] (WinNT; U) [Netscape]">
   <title>Stream Converter Interface</title>
<!-- created by rhp -->
<script src="../../__utm.js" type="text/javascript"></script>
</head>
<body id="www-mozilla-org" class="deepLevel">
<div id="container">
<p class="important">You are currently viewing a snapshot of www.mozilla.org taken on April 21, 2008. Most of this content is
highly out of date (some pages haven't been updated since the project began in 1998) and exists for historical purposes only.  If
there are any pages on this archive site that you think should be added back to www.mozilla.org, please <a
href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=www.mozilla.org">file a bug</a>.</p>
<p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>
<div id="header">
<h1><a href="/" title="Return to home page" accesskey="1">Mozilla</a></h1>
<ul>
<li id="menu_aboutus"><a href="../../about/" title="Getting the most out of your online experience">About</a></li>
<li id="menu_developers"><a href="../../developer/" title="Using Mozilla's products for your own applications">Developers</a></li>
<li id="menu_store"><a href="http://store.mozilla.org/?r=mozorg1" title="Shop for Mozilla products on CD and other merchandise">Store</a></li>
<li id="menu_support"><a href="../../support/" title="Installation, trouble-shooting, and the knowledge base">Support</a></li>
<li id="menu_products"><a href="../../products/" title="All software Mozilla currently offers">Products</a></li>
</ul>
<form id="searchbox_002443141534113389537:ysdmevkkknw" action="http://www.google.com/cse" title="mozilla.org Search">
<div>
<label for="q" title="Search mozilla.org's sites">search mozilla:</label>
<input type="hidden" name="cx" value="002443141534113389537:ysdmevkkknw">
<input type="hidden" name="cof" value="FORID:0">
<input type="text" id="q" name="q" accesskey="s" size="30">
<input type="submit" id="submit" value="Go">
</div>
</form>
</div>
<hr class="hide">
<div id="mBody">
<div id="side">

<ul id="nav">
<li><a title="Roadmap" href="../../roadmap.html"><strong> Roadmap</strong></a></li>
<li><a title="Projects" href="../../projects/"><strong> Projects</strong></a></li>
<li><a title="For developers" href="../../developer/"><strong> Coding</strong></a>
<ul>
<li><a title="Module Owners" href="../../owners.html"> Module Owners</a></li>
<li><a title="Hacking" href="../../hacking/"> Hacking</a></li>
<li><a title="Get the Source" href="http://developer.mozilla.org/en/docs/Download_Mozilla_Source_Code"> Get the Source</a></li>
<li><a title="Building Mozilla" href="http://developer.mozilla.org/en/docs/Build_Documentation"> Build It</a></li>
</ul>
</li>
<li><a title="Testing" href="../../quality/"><strong> Testing</strong></a>
<ul>
<li><a title="Downloads of mozilla.org software releases" href="../../download.html"> Releases</a></li>
<li><a title="Latest mozilla builds for testers" href="../../developer/#builds"> Nightly Builds</a></li>
<li><a title="For testers to report bugs" href="https://bugzilla.mozilla.org/"> Report A Problem</a></li>
</ul>
</li>
<li><a title="Tools for mozilla developers" href="../../tools.html"><strong> Tools</strong></a>
<ul>
<li><a title="Bug tracking system for mozilla testers." href="https://bugzilla.mozilla.org/"> Bugzilla</a></li>
<li><a title="Latest status of mozilla builds" href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=Firefox"> Tinderbox</a></li>
<li><a title="Latest checkins" href="http://bonsai.mozilla.org/cvsqueryform.cgi"> Bonsai</a></li>
<li><a title="Source cross reference" href="http://lxr.mozilla.org/seamonkey/"> LXR</a></li>
</ul>
</li>
<li><a title="Frequently Asked Questions." href="../../faq.html"><strong> FAQs</strong></a></li>
</ul>

</div>
<hr class="hide">
<div id="mainContent">




<b><font size=+2><a href="stream-converter-interface.html"></a></font></b>&nbsp;
<table BORDER COLS=1 WIDTH="100%" BGCOLOR="#FF6666" >
<tr>
<td>
<center><b><font size=+2><a href="stream-converter-interface.html">Old
- replaced by </a><a href="http://lxr.mozilla.org/mozilla/source/netwerk/streamconv/public/nsIStreamConverter.idl">nsIStreamConverter.idl</a></font></b></center>
</td>
</tr>
</table>
<b><font color="#000000"><font size=+2></font></font></b>
<center>
<p><b><font color="#000000"><font size=+2>Stream Converter Interface</font></font></b>
<br><b><font color="#000000"><font size=+2>(nsIStreamConverter)</font></font></b>
<br><b><font color="#000000">by Richard H. Pizzarro &lt;<a href="mailto:rhp@netscape.com">rhp@netscape.com</a>></font></b></center>
<b><font color="#000000"><font size=+1>Contents</font></font></b>
<ul>
<li>
<a href="#OVER">Overview</a></li>

<li>
<a href="#CALLFLOW">Example Call Flow</a></li>

<li>
<a href="#API">API</a></li>

<ul>&nbsp;</ul>
</ul>
<a NAME="OVER"></a><b><font color="#000000"><font size=+1>Overview</font></font></b>
<br><font color="#000000">An general purpose interface needs to be defined
to allow the integration of stream converters to the Gecko architecture
(in particular, netlib). A prime example of a stream converter is the libmime
component that currently resides in the Communicator client. libmime is
responsible for conversion of "message/RFC822" streams to various formats
(such as HTML for display). Currently, libmime is a statically linked library
that exposes a C API for use by libnet, but this should take the form of
an XP-COM interface that would allow for external modules to be added,
updated, etc. as development proceeds.</font>
<ul>&nbsp;</ul>
<a NAME="CALLFLOW"></a><b><font color="#000000"><font size=+1>Example Call
Flow</font></font></b>
<br><font color="#000000">Before we get into the details of any API, we
should discuss the general call flow of what we are trying to accomplish
with this stream converter interface. In our example, we will use the IMAP
Protocol handler and the operation will be rendering an MHTML message retrieved
from an IMAP server.</font>
<br>&nbsp;
<ul>
<li>
<font color="#000000">The user clicks on a message listed in the Messenger
FE. This message resides on an IMAP server so a URL to retrieve the server
will be fired by the FE</font></li>

<li>
<font color="#000000">The netlib/IMAP protocol handler starts the process
of downloading the message from the IMAP server</font></li>

<li>
<font color="#000000">The MIME type for the message is identified to be
"message/rfc822". Since the user wishes to display this message in an HTML
display window, the protocol handler needs to identify and initialize a
stream converter than can convert an "message/rfc822" stream to HTML.</font></li>

<li>
<font color="#000000">The IMAP protocol handler would query the Stream
Converter Manager which had a table of all the available stream converter
factories and the format conversions that they support. (Note: this discovery
process and the Stream Converter Manager is not explained in this document).</font></li>

<li>
<font color="#000000">The IMAP Protocol Handler would create and instance
of the RFC822-HTML converter</font></li>

<li>
<font color="#000000">The IMAP Protocol Handler would set the following
on the converter:</font></li>

<ul>
<li>
<font color="#000000">Output stream for the RFC822-HTML converter. This
is the stream where converted output will be written to after processing
by the stream converter.</font></li>

<li>
<font color="#000000">The output listener on the RFC822-HTML converter.
Some explanation is necessary on why we should set the output listener.
Consider the following case:</font></li>

<br>&nbsp;
<ul>&nbsp;
<table>
<tr>
<td BGCOLOR="#FFCC99">
<center><b><font face="Arial,Helvetica">IMAP PROTOCOL HANDLER</font></b>
<br><i><font face="Arial,Helvetica">feeds RFC822 data to the stream converter</font></i></center>
</td>

<td BGCOLOR="#FFFFCC">
<center><b><font face="Arial,Helvetica">RFC822 to HTML STREAM CONVERTER</font></b>
<br><i><font face="Arial,Helvetica">processes RFC822 data and returns an
HTML stream</font></i></center>
</td>
</tr>

<tr>
<td BGCOLOR="#99FF99">
<center><b><font face="Arial,Helvetica">HTML RENDERING ENGINE</font></b>
<br><i><font face="Arial,Helvetica">displays the HTML stream&nbsp;</font></i></center>
</td>

<td></td>
</tr>
</table>
</ul>
<font color="#000000">In this situation, it would be nice to have the flexibility
for both of the following options:</font>
<ul>
<li>
<font color="#000000">Have the converted HTML stream be passed back to
the IMAP Protocol handler and from there, it will be fed into the HTML
rendering engine</font></li>

<li>
<font color="#000000">Have the stream converter directly feed the data
into the HTML rendering engine without any processing required by the IMAP
protocol handler</font></li>
</ul>
<font color="#000000">For option #2, we will need the stream converter
to notify the output listener via the OnDataAvailable() method. In order
to do this, the RFC822-HTML converter will need to know the output listener
for processed data.</font></ul>

<li>
<font color="#000000">After creating the RFC822-HTML converter, the OnStartBinding()
method will be called to notify the stream converter that the data flow
is starting</font></li>

<li>
<font color="#000000">The RFC822-HTML->OnDataAvailable() method will be
called to notify the stream converter of new data available for conversion.</font></li>

<li>
<font color="#000000">The RFC822-HTML converter will process the data and
write the output to the previously set output stream</font></li>

<li>
<font color="#000000">IF the IMAP Protocol handler set the output listener
on the converter, the RFC822-HTML converter will be responsible for calling
the OnDataAvailable() method on these listeners. If not, the converter
will return</font></li>

<li>
<font color="#000000">The IMAP Protocol Handler would continue receiving
data from the network socket and notifying the stream converter until the
end of the stream is reached.</font></li>

<li>
<font color="#000000">When the stream is completed (or interrupted) the
IMAP Protocol Handler will call the StopBinding() method for the stream
converter and the this will complete the operation</font></li>

<br>&nbsp;</ul>
<a NAME="API"></a><b><font color="#000000"><font size=+1>API</font></font></b>
<br>Now that we have an understanding of the general call flow for a stream
converter, we should start discussing the XP-COM interface for these modules.
First, we will define a general <b><font face="Arial,Helvetica">nsIStreamConverter</font></b>
interface that will be subclassed with unique ClassID's for all of the
various stream converters. For example, <b><font face="Arial,Helvetica">nsIStreamConverter
</font></b>is
the general class definition for a stream converter, but
<b><font face="Arial,Helvetica">nsIRFC822toHTMLStreamConverter</font></b>
which supports the <b><font face="Arial,Helvetica">nsIStreamConverter</font></b>
interface would be the specific RFC822 to HTML stream converter. (Note:
A registry of converters and the formats they support would need to be
set on a machine and managed by the Stream Converter Manager for use at
runtime)
<p>With all of this in mind, lets look at a definition of the general class
and a specific RFC822 to HTML stream converter.
<br>&nbsp;
<br>&nbsp;
<table COLS=1 WIDTH="100%" BGCOLOR="#FFCC99" >
<tr>
<td>
<center><b><font face="Arial,Helvetica">nsIStreamConverter.h</font></b></center>
</td>
</tr>
</table>

<p><tt>#ifndef nsIStreamConverter_h_</tt>
<br><tt>#define nsIStreamConverter_h_</tt>
<p><tt>#include "nsIStreamListener.h"</tt>
<br><tt>#include "nsIOutputStream.h"</tt>
<p><tt>// {C9CDF8E5-95FA-11d2-8807-00805F5A1FB8}</tt>
<br><tt>#define NS_ISTREAM_CONVERTER_IID \</tt>
<br><tt>&nbsp;&nbsp; { 0xc9cdf8e5, 0x95fa, 0x11d2,&nbsp;&nbsp;&nbsp; \</tt>
<br><tt>&nbsp;&nbsp; { 0x88, 0x7, 0x0, 0x80, 0x5f, 0x5a, 0x1f, 0xb8 } };</tt>
<p><tt>class nsIStreamConverter : public nsIStreamListener {</tt>
<br><tt>public:</tt>
<br><tt>&nbsp;&nbsp;&nbsp; //</tt>
<br><tt>&nbsp;&nbsp;&nbsp; // This is the output stream where the stream
converter will write processed data after</tt>
<br><tt>&nbsp;&nbsp;&nbsp; // conversion.</tt>
<br><tt>&nbsp;&nbsp;&nbsp; //</tt>
<br><tt>&nbsp;&nbsp;&nbsp; NS_IMETHOD SetOutputStream(nsIOutputStream *outStream)
= 0;</tt>
<p><tt>&nbsp;&nbsp;&nbsp; //</tt>
<br><tt>&nbsp;&nbsp;&nbsp; // The output listener can be set to allow for
the flexibility of having the stream converter</tt>
<br><tt>&nbsp;&nbsp;&nbsp; // directly notify the listener of the output
stream for any processed/converter data. If</tt>
<br><tt>&nbsp;&nbsp;&nbsp; // this output listener is not set, the data
will be written into the output stream but it is</tt>
<br><tt>&nbsp;&nbsp;&nbsp; // the responsibility of the client of the stream
converter to handle the resulting data.</tt>
<br><tt>&nbsp;&nbsp;&nbsp; //</tt>
<br><tt>&nbsp;&nbsp;&nbsp; NS_IMETHOD SetOutputListener(nsIStreamListener
*outListner) = 0;</tt>
<br><tt>};</tt>
<p><tt>#endif /* nsIStreamConverter_h_ */</tt>
<br>&nbsp;
<br>&nbsp;
<table COLS=1 WIDTH="100%" BGCOLOR="#FFCC99" >
<tr>
<td>
<center><b><font face="Arial,Helvetica">nsRFC822toHTMLStreamConverter.h</font></b></center>
</td>
</tr>
</table>

<p><tt>#ifndef nsRFC822toHTMLStreamConverter_h_</tt>
<br><tt>#define nsRFC822toHTMLStreamConverter_h_</tt>
<p><tt>#include "nsIStreamConverter.h"</tt>
<p><tt>//</tt>
<br><tt>// A specific stream converter will be specified for each format-in/format-out</tt>
<br><tt>// pairing.</tt>
<br><tt>//</tt>
<p><tt>// {22DB1685-AA68-11d2-8809-00805F5A1FB8}</tt>
<br><tt>#define NS_RFC822_HTML_STREAM_CONVERTER_CID \</tt>
<br><tt>&nbsp; { 0x22db1685, 0xaa68, 0x11d2, \</tt>
<br><tt>&nbsp; { 0x88, 0x9, 0x0, 0x80, 0x5f, 0x5a, 0x1f, 0xb8 } };</tt>
<p><tt>class nsRFC822toHTMLStreamConverter : public nsIStreamConverter
{</tt>
<br><tt>public:</tt>
<br><tt>&nbsp;&nbsp;&nbsp; void *tagData;</tt>
<br><tt>};</tt>
<p><tt>#endif /* nsRFC822toHTMLStreamConverter_h_ */</tt>
<br>&nbsp;



<hr class="hide">
</div>
</div>
<div id="footer">
<ul>
<li><a href="../../sitemap.html">Site Map</a></li>
<li><a href="../../security/">Security Updates</a></li>
<li><a href="../../contact/">Contact Us</a></li>
<li><a href="../../foundation/donate.html">Donate</a></li>
</ul>
<p class="copyright">
Portions of this content are &copy; 1998&#8211;2009 by individual mozilla.org
contributors; content available under a Creative Commons license | <a
href="http://www.mozilla.org/foundation/licensing/website-content.html">Details</a>.</p>
<p>
<span>Last modified February  6,  2001</span>
<span><a href="http://bonsai-www.mozilla.org/cvslog.cgi?file=mozilla-org/html/mailnews/arch/stream-converter-interface.html&amp;rev=&amp;root=/www/">Document History</a></span>
</p>
</div>
</div>
</body>
</html>
