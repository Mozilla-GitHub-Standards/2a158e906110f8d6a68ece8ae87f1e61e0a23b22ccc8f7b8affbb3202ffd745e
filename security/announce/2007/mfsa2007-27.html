<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<link rel="top" title="Home" href="http://www.mozilla.org/">
<link rel="stylesheet" type="text/css" href="../../../css/print.css"  media="print">
<link rel="stylesheet" type="text/css" href="../../../css/base/content.css"  media="all">
<link rel="stylesheet" type="text/css" href="../../../css/cavendish/content.css" title="Cavendish" media="screen">
<link rel="stylesheet" type="text/css" href="../../../css/base/template.css"  media="screen">
<link rel="stylesheet" type="text/css" href="../../../css/cavendish/template.css" title="Cavendish" media="screen">
<link rel="icon" href="../../../images/mozilla-16.png" type="image/png">


<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Style-Type" content="text/css">
    <title>MFSA 2007-27: Unescaped URIs passed to external programs</title>

  <link rel="contents" href="../../../projects/security/known-vulnerabilities.html" title="Known Vulnerabilities in Mozilla Products">
  <link rel="up" href="../../../projects/security/known-vulnerabilities.html" title="Known Vulnerabilities in Mozilla Products">

    <style type="text/css">
       .label {width: 8em; font-weight: bold; float: left;}
    </style>
  <script src="../../../__utm.js" type="text/javascript"></script>
</head>
<body id="www-mozilla-org" class="deepLevel">
<div id="container">
<p class="important">You are currently viewing a snapshot of www.mozilla.org taken on April 21, 2008. Most of this content is
highly out of date (some pages haven't been updated since the project began in 1998) and exists for historical purposes only.  If
there are any pages on this archive site that you think should be added back to www.mozilla.org, please <a
href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=www.mozilla.org">file a bug</a>.</p>
<p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>
<div id="header">
<h1><a href="/" title="Return to home page" accesskey="1">Mozilla</a></h1>
<ul>
<li id="menu_aboutus"><a href="../../../about/" title="Getting the most out of your online experience">About</a></li>
<li id="menu_developers"><a href="../../../developer/" title="Using Mozilla's products for your own applications">Developers</a></li>
<li id="menu_store"><a href="http://store.mozilla.org/?r=mozorg1" title="Shop for Mozilla products on CD and other merchandise">Store</a></li>
<li id="menu_support"><a href="../../../support/" title="Installation, trouble-shooting, and the knowledge base">Support</a></li>
<li id="menu_products"><a href="../../../products/" title="All software Mozilla currently offers">Products</a></li>
</ul>
<form id="searchbox_002443141534113389537:ysdmevkkknw" action="http://www.google.com/cse" title="mozilla.org Search">
<div>
<label for="q" title="Search mozilla.org's sites">search mozilla:</label>
<input type="hidden" name="cx" value="002443141534113389537:ysdmevkkknw">
<input type="hidden" name="cof" value="FORID:0">
<input type="text" id="q" name="q" accesskey="s" size="30">
<input type="submit" id="submit" value="Go">
</div>
</form>
</div>
<hr class="hide">
<div id="mBody">
<div id="side">

<ul id="nav">
<li><a title="Roadmap" href="../../../roadmap.html"><strong> Roadmap</strong></a></li>
<li><a title="Projects" href="../../../projects/"><strong> Projects</strong></a></li>
<li><a title="For developers" href="../../../developer/"><strong> Coding</strong></a>
<ul>
<li><a title="Module Owners" href="../../../owners.html"> Module Owners</a></li>
<li><a title="Hacking" href="../../../hacking/"> Hacking</a></li>
<li><a title="Get the Source" href="http://developer.mozilla.org/en/docs/Download_Mozilla_Source_Code"> Get the Source</a></li>
<li><a title="Building Mozilla" href="http://developer.mozilla.org/en/docs/Build_Documentation"> Build It</a></li>
</ul>
</li>
<li><a title="Testing" href="../../../quality/"><strong> Testing</strong></a>
<ul>
<li><a title="Downloads of mozilla.org software releases" href="../../../download.html"> Releases</a></li>
<li><a title="Latest mozilla builds for testers" href="../../../developer/#builds"> Nightly Builds</a></li>
<li><a title="For testers to report bugs" href="https://bugzilla.mozilla.org/"> Report A Problem</a></li>
</ul>
</li>
<li><a title="Tools for mozilla developers" href="../../../tools.html"><strong> Tools</strong></a>
<ul>
<li><a title="Bug tracking system for mozilla testers." href="https://bugzilla.mozilla.org/"> Bugzilla</a></li>
<li><a title="Latest status of mozilla builds" href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=Firefox"> Tinderbox</a></li>
<li><a title="Latest checkins" href="http://bonsai.mozilla.org/cvsqueryform.cgi"> Bonsai</a></li>
<li><a title="Source cross reference" href="http://lxr.mozilla.org/seamonkey/"> LXR</a></li>
</ul>
</li>
<li><a title="Frequently Asked Questions." href="../../../faq.html"><strong> FAQs</strong></a></li>
</ul>

</div>
<hr class="hide">
<div id="mainContent">






<p class="crumbs"><em>You are here:</em> <a href="../../../projects/security/known-vulnerabilities.html#firefox2.0.0.6">Known Vulnerabilities in Mozilla Products (Firefox 2.0.0.6)</a> &gt; <strong><abbr title="Mozilla Foundation Security Advisory">MFSA</abbr> 2007-27</strong></p>

<h1>Mozilla Foundation Security Advisory 2007-27</h1>

<p><span class="label">Title:</span>      Unescaped URIs passed to external programs<br>
<span class="label">Impact:</span>     Critical<br>
<span class="label">Announced:</span>  July 30, 2007<br>
<span class="label">Reporter:</span>   Jesper Johansson<br>
<span class="label">Products:</span>   Firefox, Thunderbird, SeaMonkey<br>
<br>
<span class="label">Fixed in:</span>   Firefox 2.0.0.6<br>
<span class="label">&nbsp;</span>      Thunderbird 2.0.0.6<br>
<span class="label">&nbsp;</span>      Thunderbird 1.5.0.13<br>
<span class="label">&nbsp;</span>      SeaMonkey 1.1.4</p>

<h3>Description</h3>

<p><strong>Jesper Johansson</strong> pointed out that Mozilla did not
percent-encode spaces and double-quotes in URIs handed off to external
programs for handling, which can cause the receiving program to
mistakenly interpret a single URI as multiple arguments. The danger
depends on the arguments supported by the specific receiving program,
though at the very least we know Firefox (and Thunderbird) 2.0.0.4 and
older could be used to run arbitrary script (see
<a href="mfsa2007-23.html">MFSA 2007-23</a>). The vast majority of programs
do not have dangerous arguments, though many could still be made to do
something unexpected.</p>

<p>A similar issue with URIs passed to external handlers was reported by
<strong>Billy Rios</strong> and <strong>Nate McFeters</strong>. When running
Firefox on Windows XP with IE7 installed, URIs for certain
common protocols (such as <code>mailto:</code>) that contain a %00 do not
launch the protocol handler registered for that scheme but instead launch
a file handling program based on the file extension at the end of the URI.
Coupled with the issue reported by Jesper Johansson this appears to allow
execution of any program installed at a known location and limited argument
passing that might be enough to exploit a system.
Further investigation by <strong>Secunia</strong> showed that a % not
followed by a valid two-digit hexadecimal number also triggered the problem
for the affected protocols. The Firefox and Thunderbird 2.0.0.6 releases
contain fixes that prevent the original demonstrations of this variant, but
it is still possible to launch a filetype handler based on extension rather
than the registered protocol handler. A way to exploit a common handler with
a single unexpected URI as an argument may yet be found. Since this handling
is a property of the Windows Shell API this variant appears to affect other
internet-enabled applications that pass these URIs to the Windows Shell.</p>

<h3>Workaround</h3>

<p>By default Firefox will ask before launching external protocol handlers,
and these prompts should be denied from sites that are not trustworthy,
especially if the requested URL contains spaces and double-quote (") characters.
An exception is made for mail-related protocols in Firefox, they do not prompt
by default. If the default mail handler is Thunderbird 2.0.0.5 or later there
will not be a problem, but if another program or older version of Thunderbird
is the default handler then mail URIs can be made to prompt as well. (Similarly,
in Thunderbird browser protocols like <code>http:</code> and <code>ftp:</code>
do not prompt but instead launch the default browser.) To make mail-related
links prompt in Firefox before launching external programs:</p>

<ul>
<li>Enter <kbd>about:config</kbd> in the location bar</li>
<li>Enter <kbd>warn-external</kbd> in the <samp>Filter:</samp> box</li>
<li>Double-click to set the mailto, news, nntp, and snews lines to <samp>true</samp></li>
</ul>

<h3>References</h3>

<ul>
<li><a class="ex-ref" href="http://msinfluentials.com/blogs/jesper/archive/2007/07/20/hey-mozilla-quotes-are-not-legal-in-a-url.aspx">
Jesper's Blog</a></li>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=389106">
https://bugzilla.mozilla.org/show_bug.cgi?id=389106</a></li>
<li><a class="ex-ref" href="http://nvd.nist.gov/nvd.cfm?cvename=CVE-2007-3845">CVE-2007-3845</a></li>
<li>Secunia Advisory <a class="ex-ref" href="http://secunia.com/advisories/26201/">SA26201</a></li>
<li><abbr title="United States Computer Emergency Readiness Team">US-CERT</abbr> Vulnerability Notes <a class="ex-ref" href="http://www.kb.cert.org/vuls/id/783400">VU#783400</a>
and <a class="ex-ref" href="http://www.kb.cert.org/vuls/id/403150">VU##403150</a></li>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=389580">
https://bugzilla.mozilla.org/show_bug.cgi?id=389580</a></li>
</ul>



<hr class="hide">
</div>
</div>
<div id="footer">
<ul>
<li><a href="../../../sitemap.html">Site Map</a></li>
<li><a href="../../../security/">Security Updates</a></li>
<li><a href="../../../contact/">Contact Us</a></li>
<li><a href="../../../foundation/donate.html">Donate</a></li>
</ul>
<p class="copyright">
Portions of this content are &copy; 1998&#8211;2009 by individual mozilla.org
contributors; content available under a Creative Commons license | <a
href="http://www.mozilla.org/foundation/licensing/website-content.html">Details</a>.</p>
<p>
<span>Last modified September 20,  2007</span>
<span><a href="http://bonsai-www.mozilla.org/cvslog.cgi?file=mozilla-org/html/security/announce/2007/mfsa2007-27.html&amp;rev=&amp;root=/www/">Document History</a></span>
</p>
</div>
</div>
</body>
</html>
