<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<link rel="top" title="Home" href="http://www.mozilla.org/">
<link rel="stylesheet" type="text/css" href="../../css/print.css"  media="print">
<link rel="stylesheet" type="text/css" href="../../css/base/content.css"  media="all">
<link rel="stylesheet" type="text/css" href="../../css/cavendish/content.css" title="Cavendish" media="screen">
<link rel="stylesheet" type="text/css" href="../../css/base/template.css"  media="screen">
<link rel="stylesheet" type="text/css" href="../../css/cavendish/template.css" title="Cavendish" media="screen">
<link rel="icon" href="../../images/mozilla-16.png" type="image/png">


<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Style-Type" content="text/css">

 <title>Editor API Logging</title>

<link rel="up" href="./" title="Editor project page">

<script src="../../__utm.js" type="text/javascript"></script>
</head>
<body id="www-mozilla-org" class="deepLevel">
<div id="container">
<p class="important">You are currently viewing a snapshot of www.mozilla.org taken on April 21, 2008. Most of this content is
highly out of date (some pages haven't been updated since the project began in 1998) and exists for historical purposes only.  If
there are any pages on this archive site that you think should be added back to www.mozilla.org, please <a
href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=www.mozilla.org">file a bug</a>.</p>
<p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>
<div id="header">
<h1><a href="/" title="Return to home page" accesskey="1">Mozilla</a></h1>
<ul>
<li id="menu_aboutus"><a href="../../about/" title="Getting the most out of your online experience">About</a></li>
<li id="menu_developers"><a href="../../developer/" title="Using Mozilla's products for your own applications">Developers</a></li>
<li id="menu_store"><a href="http://store.mozilla.org/?r=mozorg1" title="Shop for Mozilla products on CD and other merchandise">Store</a></li>
<li id="menu_support"><a href="../../support/" title="Installation, trouble-shooting, and the knowledge base">Support</a></li>
<li id="menu_products"><a href="../../products/" title="All software Mozilla currently offers">Products</a></li>
</ul>
<form id="searchbox_002443141534113389537:ysdmevkkknw" action="http://www.google.com/cse" title="mozilla.org Search">
<div>
<label for="q" title="Search mozilla.org's sites">search mozilla:</label>
<input type="hidden" name="cx" value="002443141534113389537:ysdmevkkknw">
<input type="hidden" name="cof" value="FORID:0">
<input type="text" id="q" name="q" accesskey="s" size="30">
<input type="submit" id="submit" value="Go">
</div>
</form>
</div>
<hr class="hide">
<div id="mBody">
<div id="side">

<ul id="nav">
<li><a title="Roadmap" href="../../roadmap.html"><strong> Roadmap</strong></a></li>
<li><a title="Projects" href="../../projects/"><strong> Projects</strong></a></li>
<li><a title="For developers" href="../../developer/"><strong> Coding</strong></a>
<ul>
<li><a title="Module Owners" href="../../owners.html"> Module Owners</a></li>
<li><a title="Hacking" href="../../hacking/"> Hacking</a></li>
<li><a title="Get the Source" href="http://developer.mozilla.org/en/docs/Download_Mozilla_Source_Code"> Get the Source</a></li>
<li><a title="Building Mozilla" href="http://developer.mozilla.org/en/docs/Build_Documentation"> Build It</a></li>
</ul>
</li>
<li><a title="Testing" href="../../quality/"><strong> Testing</strong></a>
<ul>
<li><a title="Downloads of mozilla.org software releases" href="../../download.html"> Releases</a></li>
<li><a title="Latest mozilla builds for testers" href="../../developer/#builds"> Nightly Builds</a></li>
<li><a title="For testers to report bugs" href="https://bugzilla.mozilla.org/"> Report A Problem</a></li>
</ul>
</li>
<li><a title="Tools for mozilla developers" href="../../tools.html"><strong> Tools</strong></a>
<ul>
<li><a title="Bug tracking system for mozilla testers." href="https://bugzilla.mozilla.org/"> Bugzilla</a></li>
<li><a title="Latest status of mozilla builds" href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=Firefox"> Tinderbox</a></li>
<li><a title="Latest checkins" href="http://bonsai.mozilla.org/cvsqueryform.cgi"> Bonsai</a></li>
<li><a title="Source cross reference" href="http://lxr.mozilla.org/seamonkey/"> LXR</a></li>
</ul>
</li>
<li><a title="Frequently Asked Questions." href="../../faq.html"><strong> FAQs</strong></a></li>
</ul>

</div>
<hr class="hide">
<div id="mainContent">





<p class="crumbs"><em>You are here:</em> <a href="./">Editor project page</a> &gt; <strong>Editor API Logging</strong></p>

 <h1>The Editor API Logging Mechanism</h1>
 <address class="author"><a href="mailto:kin@netscape.com">Kin Blas</a> (Netscape Communications
 Corporation)</address>
 <p class="note">Follow-up and discussion on
  <a href="news://news.mozilla.org/netscape.public.mozilla.editor">netscape.public.mozilla.editor</a>
 <p>The Editor API Logging Mechanism allows a user to record and playback all the edits
  made to a document.  This feature can be used by QA to create Editor test
  scripts, and scripts that can be used by engineers to recreate bugs.</p>
 <h2>Recording and Playback</h2>
 <p>To begin recording, select &quot;Start Log&quot; from the
  Debug menu:</p>
 <div class="figure"><img src="images/StartLog.gif" width="655" height="296" alt=""></div>
 <p>This will create a <code class="filename">journal.js</code> file in the same directory as the apprunner
  executable which will contain a description of all the edits made to the
  current document.</p>
 <p>To stop recording, select "Stop Log" from the
  Debug menu:</p>
 <div class="figure"><img src="images/StopLog.gif" width="656" height="297" alt=""></div>
 <p>To playback the edits you just made, simply restore the document
  back to the state it was when you started recording, via undo, or just reload
  the entire document, then select &quot;Run Log&quot; from the Debug menu:</p>
 <div class="figure"><img src="images/RunLog.gif" width="656" height="298" alt="[RunLog]"></div>
 <p>It's important to note that the log information contained in the
  <code class="filename">journal.js</code> file is tied to the document used and the state it was in just
  before you enabled recording. If you try to replay the edits on a different
  file, or on the document while it is in any other state, unpredictable results
  may happen.</p>
 <h2>Implementation Details</h2>
 <p>If you take a look at the contents of the journal.js file, you will see that
  it is just JavaScript. Playback involves loading this file and calling eval()
  so that the statements in the journal.js file get executed in the editor's
  JavaScript context and have access to the editor's public methods.</p>
 <p>The actual logging mechanism involves two parts:</p>
 <ul>
  <li>Calls to <code>nsJSEditorLog</code> from the various <code>nsIEditor</code>, <code>nsITextEditor</code>, and
 <code>nsIHTMLEditor</code> methods that modify the document.</li>
  <li>An <code>nsITransactionListener</code> that listens to the editor's transaction
  manager.</li>
 </ul>
 <p>The <a href="http://lxr.mozilla.org/mozilla/source/editor/base/nsJSEditorLog.h"><code>nsJSEditorLog</code></a> class
  implements the <a href="http://lxr.mozilla.org/mozilla/source/editor/public/nsIHTMLEditor.h"><code>nsIHTMLEditor</code></a> interface
  because it contained the union of all methods from <code>nsIEditor</code>, <code>nsITextEditor</code>,
  and <code>nsIHTMLEditor</code> that could modify the document. Implementing <code>nsJSEditorLog</code>

  with the <code>nsIHTMLEditor</code> interface also forces all developers who change these
  editor interfaces, to update the nsJSEditorLog implementation whenever a
  method is added, or it's signature changed.</p>
 <p>As stated above, calls
  to <code>nsJSEditorLog</code> methods were added to the implementations for <code>nsIEditor</code>,
  nsITextEditor and <code>nsIHTMLEditor</code>. This involved adding code like the following
  to each method that modifies the content tree:</p>
 <pre class="code">NS_IMETHODIMP
InsertText(const nsString&amp; aStringToInsert)
{
#ifdef ENABLE_JS_EDITOR_LOG
  if (mJSEditorLog)
    mJSEditorLog-&gt;InsertText(aStringToInsert);
#endif // ENABLE_JS_EDITOR_LOG

  ...

}</pre>
 <p>If you look at the <a href="http://lxr.mozilla.org/mozilla/source/editor/base/nsJSEditorLog.cpp">implementation</a> for
  nsJSEditorLog, you will see that each of it's methods write out the JavaScript
  that recreates the call to the method.</p>
 <p>The <a href="http://lxr.mozilla.org/mozilla/source/editor/base/nsJSTxnLog.h">nsJSTxnLog</a> class
  implements the <a href="http://lxr.mozilla.org/mozilla/source/editor/txmgr/public/nsITransactionListener.h">nsITransactionListener</a>  interface.
  When logging is started, we add nsJSTxnLog as a listener to the editor's
  transaction manager so that it gets notified whenever a transaction is executed,
  undone, or redone. nsJSTxnLog's main purpose is to write out JavaScript
  comments that describe the transaction being executed. Since one editor
  method call can result in several transactions being executed, these comments
  can aid engineers in seeing what transactions are being executed, and identifying
  which transaction is causing a specific problem.</p>
 <p>Just for kicks,
  here's a link to the <a href="journal.js">journal.js</a> file generated
  during the creation of this document. To run it, Shift-Click on the link,
  then save it in the directory containing the apprunner executable. Start
  up the editor, then select Debug-&gt;Run Log from the menus.</p>


<hr class="hide">
</div>
</div>
<div id="footer">
<ul>
<li><a href="../../sitemap.html">Site Map</a></li>
<li><a href="../../security/">Security Updates</a></li>
<li><a href="../../contact/">Contact Us</a></li>
<li><a href="../../foundation/donate.html">Donate</a></li>
</ul>
<p class="copyright">
Portions of this content are &copy; 1998&#8211;2009 by individual mozilla.org
contributors; content available under a Creative Commons license | <a
href="http://www.mozilla.org/foundation/licensing/website-content.html">Details</a>.</p>
<p>
<span>Last modified November  8,  2006</span>
<span><a href="http://bonsai-www.mozilla.org/cvslog.cgi?file=mozilla-org/html/editor/logging/api-logging.html&amp;rev=&amp;root=/www/">Document History</a></span>
</p>
</div>
</div>
</body>
</html>
