<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<link rel="top" title="Home" href="http://www.mozilla.org/">
<link rel="stylesheet" type="text/css" href="../../../../css/print.css"  media="print">
<link rel="stylesheet" type="text/css" href="../../../../css/base/content.css"  media="all">
<link rel="stylesheet" type="text/css" href="../../../../css/cavendish/content.css" title="Cavendish" media="screen">
<link rel="stylesheet" type="text/css" href="../../../../css/base/template.css"  media="screen">
<link rel="stylesheet" type="text/css" href="../../../../css/cavendish/template.css" title="Cavendish" media="screen">
<link rel="icon" href="../../../../images/mozilla-16.png" type="image/png">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>tmTransactionService.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<script src="../../../../__utm.js" type="text/javascript"></script>
</head>
<body id="www-mozilla-org" class="deepLevel">
<div id="container">
<p class="important">You are currently viewing a snapshot of www.mozilla.org taken on April 21, 2008. Most of this content is
highly out of date (some pages haven't been updated since the project began in 1998) and exists for historical purposes only.  If
there are any pages on this archive site that you think should be added back to www.mozilla.org, please <a
href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=www.mozilla.org">file a bug</a>.</p>
<p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>
<div id="header">
<h1><a href="/" title="Return to home page" accesskey="1">Mozilla</a></h1>
<ul>
<li id="menu_aboutus"><a href="../../../../about/" title="Getting the most out of your online experience">About</a></li>
<li id="menu_developers"><a href="../../../../developer/" title="Using Mozilla's products for your own applications">Developers</a></li>
<li id="menu_store"><a href="http://store.mozilla.org/?r=mozorg1" title="Shop for Mozilla products on CD and other merchandise">Store</a></li>
<li id="menu_support"><a href="../../../../support/" title="Installation, trouble-shooting, and the knowledge base">Support</a></li>
<li id="menu_products"><a href="../../../../products/" title="All software Mozilla currently offers">Products</a></li>
</ul>
<form id="searchbox_002443141534113389537:ysdmevkkknw" action="http://www.google.com/cse" title="mozilla.org Search">
<div>
<label for="q" title="Search mozilla.org's sites">search mozilla:</label>
<input type="hidden" name="cx" value="002443141534113389537:ysdmevkkknw">
<input type="hidden" name="cof" value="FORID:0">
<input type="text" id="q" name="q" accesskey="s" size="30">
<input type="submit" id="submit" value="Go">
</div>
</form>
</div>
<hr class="hide">
<div id="mBody">
<div id="side">

<ul id="nav">
<li><a title="Roadmap" href="../../../../roadmap.html"><strong> Roadmap</strong></a></li>
<li><a title="Projects" href="../../../../projects/"><strong> Projects</strong></a></li>
<li><a title="For developers" href="../../../../developer/"><strong> Coding</strong></a>
<ul>
<li><a title="Module Owners" href="../../../../owners.html"> Module Owners</a></li>
<li><a title="Hacking" href="../../../../hacking/"> Hacking</a></li>
<li><a title="Get the Source" href="http://developer.mozilla.org/en/docs/Download_Mozilla_Source_Code"> Get the Source</a></li>
<li><a title="Building Mozilla" href="http://developer.mozilla.org/en/docs/Build_Documentation"> Build It</a></li>
</ul>
</li>
<li><a title="Testing" href="../../../../quality/"><strong> Testing</strong></a>
<ul>
<li><a title="Downloads of mozilla.org software releases" href="../../../../download.html"> Releases</a></li>
<li><a title="Latest mozilla builds for testers" href="../../../../developer/#builds"> Nightly Builds</a></li>
<li><a title="For testers to report bugs" href="https://bugzilla.mozilla.org/"> Report A Problem</a></li>
</ul>
</li>
<li><a title="Tools for mozilla developers" href="../../../../tools.html"><strong> Tools</strong></a>
<ul>
<li><a title="Bug tracking system for mozilla testers." href="https://bugzilla.mozilla.org/"> Bugzilla</a></li>
<li><a title="Latest status of mozilla builds" href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=Firefox"> Tinderbox</a></li>
<li><a title="Latest checkins" href="http://bonsai.mozilla.org/cvsqueryform.cgi"> Bonsai</a></li>
<li><a title="Source cross reference" href="http://lxr.mozilla.org/seamonkey/"> LXR</a></li>
</ul>
</li>
<li><a title="Frequently Asked Questions." href="../../../../faq.html"><strong> FAQs</strong></a></li>
</ul>

</div>
<hr class="hide">
<div id="mainContent">


<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>tmTransactionService.h</h1><div class="fragment"><pre>00001 <span class="comment">/* ***** BEGIN LICENSE BLOCK *****</span>
00002 <span class="comment"> * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * The contents of this file are subject to the Mozilla Public License Version</span>
00005 <span class="comment"> * 1.1 (the "License"); you may not use this file except in compliance with</span>
00006 <span class="comment"> * the License. You may obtain a copy of the License at</span>
00007 <span class="comment"> * http://www.mozilla.org/MPL/</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> * Software distributed under the License is distributed on an "AS IS" basis,</span>
00010 <span class="comment"> * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
00011 <span class="comment"> * for the specific language governing rights and limitations under the</span>
00012 <span class="comment"> * License.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> * The Original Code is Mozilla Transaction Manager.</span>
00015 <span class="comment"> *</span>
00016 <span class="comment"> * The Initial Developer of the Original Code is</span>
00017 <span class="comment"> * Netscape Communications Corp.</span>
00018 <span class="comment"> * Portions created by the Initial Developer are Copyright (C) 2003</span>
00019 <span class="comment"> * the Initial Developer. All Rights Reserved.</span>
00020 <span class="comment"> *</span>
00021 <span class="comment"> * Contributor(s):</span>
00022 <span class="comment"> *   John Gaunt &lt;jgaunt@netscape.com&gt;</span>
00023 <span class="comment"> *</span>
00024 <span class="comment"> * Alternatively, the contents of this file may be used under the terms of</span>
00025 <span class="comment"> * either the GNU General Public License Version 2 or later (the "GPL"), or</span>
00026 <span class="comment"> * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),</span>
00027 <span class="comment"> * in which case the provisions of the GPL or the LGPL are applicable instead</span>
00028 <span class="comment"> * of those above. If you wish to allow use of your version of this file only</span>
00029 <span class="comment"> * under the terms of either the GPL or the LGPL, and not to allow others to</span>
00030 <span class="comment"> * use your version of this file under the terms of the MPL, indicate your</span>
00031 <span class="comment"> * decision by deleting the provisions above and replace them with the notice</span>
00032 <span class="comment"> * and other provisions required by the GPL or the LGPL. If you do not delete</span>
00033 <span class="comment"> * the provisions above, a recipient may use your version of this file under</span>
00034 <span class="comment"> * the terms of any one of the MPL, the GPL or the LGPL.</span>
00035 <span class="comment"> *</span>
00036 <span class="comment"> * ***** END LICENSE BLOCK ***** */</span>
00037 
00038 <span class="preprocessor">#ifndef _tmTransactionService_H_</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#define _tmTransactionService_H_</span>
00040 <span class="preprocessor"></span>
00041 <span class="preprocessor">#include "ipcIService.h"</span>
00042 <span class="preprocessor">#include "nsString.h"</span>
00043 <span class="preprocessor">#include "nsVoidArray.h"</span>
00044 <span class="preprocessor">#include "plhash.h"</span>
00045 <span class="preprocessor">#include "tmITransactionService.h"</span>
00046 <span class="preprocessor">#include "tmTransaction.h"</span>
00047 <span class="preprocessor">#include "tmVector.h"</span>
00048 
00049 <span class="comment">// from tmTransactionManager.h</span>
00050 <span class="comment">//</span>
00051 <span class="comment">// XXX documentation needs work</span>
00053 <span class="comment">//  Overview of TransactionManager IPC Module</span>
00054 <span class="comment">//</span>
00055 <span class="comment">// Classes:</span>
00056 <span class="comment">//    tmIPCModule - From the tmTransactionManager's point of view, this</span>
00057 <span class="comment">//        is a proxy for the IPC daemon itself. The reverse is true</span>
00058 <span class="comment">//        from the daemon's point of view. This is an interface for the</span>
00059 <span class="comment">//        Transaction system to work with the IPC daemon as its transport</span>
00060 <span class="comment">//        layer.</span>
00061 <span class="comment">//    tmTransactionManager (TM) - Manages the different queues. Maintains</span>
00062 <span class="comment">//        the queues neccessary for different clients. Receives messages</span>
00063 <span class="comment">//        from the tmIPCModule and passes message to the IPC daemon through</span>
00064 <span class="comment">//        the tmIPCModule.</span>
00065 <span class="comment">//    tmQueue - this class manages the transactions for the different areas</span>
00066 <span class="comment">//        of the profiles being shared. Broken down by functional area there</span>
00067 <span class="comment">//        will be  a queue for prefs, cookies etc, but not for profileA and </span>
00068 <span class="comment">//        profileB, and not for pref_delete, pref_create, pref_change etc...</span>
00069 <span class="comment">//    tmTransaction - the actual transaction being shared with the different</span>
00070 <span class="comment">//        tmClients. It contains the type of transaction, which will equate with</span>
00071 <span class="comment">//        a type of queue in existance, the owner of the transaction (an IPC daemon ID)</span>
00072 <span class="comment">//        and the actual text message to be shared. </span>
00073 <span class="comment">//</span>
00075 <span class="comment"></span>
00077 <span class="comment">//</span>
00078 <span class="comment">// from tmqueue.cpp</span>
00079 <span class="comment">// Docs - note that the status of the TM_ATTACH_REPLY is only for checking</span>
00080 <span class="comment">//            for TM_ERROR_FAILURE. Other numbers have no importance</span>
00081 <span class="comment">// success of the status means the NS_ERROR_GET_CODE(status) will </span>
00082 <span class="comment">//     yield the index of the listener.</span>
00083 <span class="comment">//</span>
00084 <span class="comment">// move to documentation page - from tmqueue.h</span>
00085 <span class="comment">//</span>
00086 <span class="comment">// a queue is specific to profile</span>
00087 <span class="comment">//</span>
00088 <span class="comment">// UUID going out from the module is a handler in the client </span>
00089 <span class="comment">//          (will go to the XPCOM service impling that UUID)</span>
00090 <span class="comment">//   -- does it make sense to have different UUIDs for cookies/prefs/etc</span>
00091 <span class="comment">//</span>
00092 
00093 
00094 <span class="keyword">struct </span>queue_mapping;
00095 
00096 <span class="comment">// This must match EXACTLY the ID in tmICPModule.h</span>
00097 <span class="comment">// UUID used to identify the Transaction Module in both daemon and client</span>
00098 <span class="preprocessor">#define TRANSACTION_MODULE_ID                         \</span>
00099 <span class="preprocessor">{ </span><span class="comment">/* c3dfbcd5-f51d-420b-abf4-3bae445b96a9 */</span>          \
00100     0xc3dfbcd5,                                       \
00101     0xf51d,                                           \
00102     0x420b,                                           \
00103     {0xab, 0xf4, 0x3b, 0xae, 0x44, 0x5b, 0x96, 0xa9}  \
00104 }
00105 
00106 <span class="keyword">static</span> <span class="keyword">const</span> nsID kTransModuleID = TRANSACTION_MODULE_ID;
00107 
00108 
<a name="l00118"></a><a class="code" href="classtmTransactionService.html">00118</a> <span class="keyword">class </span><a class="code" href="classtmTransactionService.html">tmTransactionService</a> : <span class="keyword">public</span> tmITransactionService,
00119                              <span class="keyword">public</span> ipcIMessageObserver
00120 {
00121 
00122 <span class="keyword">public</span>:
00123 
00125   <span class="comment">// Constructor &amp; Destructor</span>
00126 
00130   <span class="keyword">virtual</span> <a class="code" href="classtmTransactionService.html#a0">~tmTransactionService</a>();
00131 
00132 
00133 
00135   <span class="comment">// Interface Declarations</span>
00136 
00137   NS_DECL_ISUPPORTS
00138 
00139   <span class="comment">// ipcIMessageObserver</span>
00140 
00151   NS_IMETHOD <a class="code" href="classtmTransactionService.html#a1">OnMessageAvailable</a>(<span class="keyword">const</span> nsID &amp; aTarget, 
00152                                 <span class="keyword">const</span> PRUint8 *aData, 
00153                                 PRUint32 aDataLength);
00154 
00155   <span class="comment">// tmITransactionService</span>
00156 
00166   NS_IMETHOD <a class="code" href="classtmTransactionService.html#a2">Init</a>(<span class="keyword">const</span> nsACString &amp; aProfileName);
00167 
00179   NS_IMETHOD <a class="code" href="classtmTransactionService.html#a3">Attach</a>(<span class="keyword">const</span> nsACString &amp; aQueueName, 
00180                     tmITransactionObserver *aObserver);
00181 
00194   NS_IMETHOD <a class="code" href="classtmTransactionService.html#a4">Detach</a>(<span class="keyword">const</span> nsACString &amp; aQueueName);
00195 
00208   NS_IMETHOD <a class="code" href="classtmTransactionService.html#a5">Flush</a>(<span class="keyword">const</span> nsACString &amp; aQueueName);
00209 
00222   NS_IMETHOD <a class="code" href="classtmTransactionService.html#a6">PostTransaction</a>(<span class="keyword">const</span> nsACString &amp; aQueueName, 
00223                              <span class="keyword">const</span> PRUint8 *aData, 
00224                              PRUint32 aDataLen);
00225 
00226 <span class="keyword">protected</span>:
00227 
00229   <span class="comment">// Protected Member Functions</span>
00230 
00235   <span class="keywordtype">void</span> <a class="code" href="classtmTransactionService.html#b0">SendMessage</a>(<a class="code" href="classtmTransaction.html">tmTransaction</a> *aTrans);
00236 
00237   <span class="comment">// handlers for reply messages from TransactionManager</span>
00238 
00247   nsresult <a class="code" href="classtmTransactionService.html#b1">OnAttachReply</a>(<a class="code" href="classtmTransaction.html">tmTransaction</a> *aTrans);
00248 
00255   nsresult <a class="code" href="classtmTransactionService.html#b2">OnDetachReply</a>(<a class="code" href="classtmTransaction.html">tmTransaction</a> *aTrans);
00256 
00262   nsresult <a class="code" href="classtmTransactionService.html#b3">OnFlushReply</a>(<a class="code" href="classtmTransaction.html">tmTransaction</a> *aTrans);
00263 
00269   nsresult <a class="code" href="classtmTransactionService.html#b4">OnPost</a>(<a class="code" href="classtmTransaction.html">tmTransaction</a> *aTrans);
00270 
00271   <span class="comment">// other helper functions</span>
00272 
00281   nsresult <a class="code" href="classtmTransactionService.html#b5">DispatchStoredMessages</a>(queue_mapping *aQMapping);
00282 
00283   <span class="comment">// helper methods for accessing the void arrays</span>
00284 
00289   PRUint32 <a class="code" href="classtmTransactionService.html#b6">GetQueueID</a>(<span class="keyword">const</span> nsACString &amp; aQueueName);
00290 
00296   <span class="keywordtype">char</span>* <a class="code" href="classtmTransactionService.html#b7">GetJoinedQueueName</a>(PRUint32 aQueueID);
00297 
00302   queue_mapping* <a class="code" href="classtmTransactionService.html#b8">GetQueueMap</a>(PRUint32 aQueueID);
00303 
00305   <span class="comment">// Protected Member Variables</span>
00306 
00307   nsCString mProfileName;             <span class="comment">// what profile are we dealing with</span>
00308   PLHashTable *mObservers;            <span class="comment">// maps qName -&gt; tmITransactionObserver</span>
00309 
00310   <a class="code" href="classtmVector.html">tmVector</a> mQueueMaps;
00311   <a class="code" href="classtmVector.html">tmVector</a> mWaitingMessages;
00312 
00313 <span class="keyword">private</span>:
00314 
00315 };
00316 
00317 <span class="preprocessor">#endif</span>
</pre></div><hr><address style="align: right;"><small>Generated on Mon Feb 24 10:22:50 2003 for transaction manager by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc3 </small></address>



<hr class="hide">
</div>
</div>
<div id="footer">
<ul>
<li><a href="../../../../sitemap.html">Site Map</a></li>
<li><a href="../../../../security/">Security Updates</a></li>
<li><a href="../../../../contact/">Contact Us</a></li>
<li><a href="../../../../foundation/donate.html">Donate</a></li>
</ul>
<p class="copyright">
Portions of this content are &copy; 1998&#8211;2009 by individual mozilla.org
contributors; content available under a Creative Commons license | <a
href="http://www.mozilla.org/foundation/licensing/website-content.html">Details</a>.</p>
<p>
<span>Last modified February 24,  2003</span>
<span><a href="http://bonsai-www.mozilla.org/cvslog.cgi?file=mozilla-org/html/projects/embedding/profileSharing/api/tmTransactionService_8h-source.html&amp;rev=&amp;root=/www/">Document History</a></span>
</p>
</div>
</div>
</body>
</html>
