<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="top" title="Home" href="http://www.mozilla.org/">
<link rel="stylesheet" type="text/css" href="../../../css/print.css"  media="print">
<link rel="stylesheet" type="text/css" href="../../../css/base/content.css"  media="all">
<link rel="stylesheet" type="text/css" href="../../../css/cavendish/content.css" title="Cavendish" media="screen">
<link rel="stylesheet" type="text/css" href="../../../css/base/template.css"  media="screen">
<link rel="stylesheet" type="text/css" href="../../../css/cavendish/template.css" title="Cavendish" media="screen">
<link rel="icon" href="../../../images/mozilla-16.png" type="image/png">

  <title>Shared Profile Tech Spec</title>
                                                
  <meta http-equiv="content-type"
 content="text/html; charset=ISO-8859-1">
<script src="../../../__utm.js" type="text/javascript"></script>
</head>
<body id="www-mozilla-org" class="deepLevel">
<div id="container">
<p class="important">You are currently viewing a snapshot of www.mozilla.org taken on April 21, 2008. Most of this content is
highly out of date (some pages haven't been updated since the project began in 1998) and exists for historical purposes only.  If
there are any pages on this archive site that you think should be added back to www.mozilla.org, please <a
href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=www.mozilla.org">file a bug</a>.</p>
<p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>
<div id="header">
<h1><a href="/" title="Return to home page" accesskey="1">Mozilla</a></h1>
<ul>
<li id="menu_aboutus"><a href="../../../about/" title="Getting the most out of your online experience">About</a></li>
<li id="menu_developers"><a href="../../../developer/" title="Using Mozilla's products for your own applications">Developers</a></li>
<li id="menu_store"><a href="http://store.mozilla.org/?r=mozorg1" title="Shop for Mozilla products on CD and other merchandise">Store</a></li>
<li id="menu_support"><a href="../../../support/" title="Installation, trouble-shooting, and the knowledge base">Support</a></li>
<li id="menu_products"><a href="../../../products/" title="All software Mozilla currently offers">Products</a></li>
</ul>
<form id="searchbox_002443141534113389537:ysdmevkkknw" action="http://www.google.com/cse" title="mozilla.org Search">
<div>
<label for="q" title="Search mozilla.org's sites">search mozilla:</label>
<input type="hidden" name="cx" value="002443141534113389537:ysdmevkkknw">
<input type="hidden" name="cof" value="FORID:0">
<input type="text" id="q" name="q" accesskey="s" size="30">
<input type="submit" id="submit" value="Go">
</div>
</form>
</div>
<hr class="hide">
<div id="mBody">
<div id="side">

<ul id="nav">
<li><a title="Roadmap" href="../../../roadmap.html"><strong> Roadmap</strong></a></li>
<li><a title="Projects" href="../../../projects/"><strong> Projects</strong></a></li>
<li><a title="For developers" href="../../../developer/"><strong> Coding</strong></a>
<ul>
<li><a title="Module Owners" href="../../../owners.html"> Module Owners</a></li>
<li><a title="Hacking" href="../../../hacking/"> Hacking</a></li>
<li><a title="Get the Source" href="http://developer.mozilla.org/en/docs/Download_Mozilla_Source_Code"> Get the Source</a></li>
<li><a title="Building Mozilla" href="http://developer.mozilla.org/en/docs/Build_Documentation"> Build It</a></li>
</ul>
</li>
<li><a title="Testing" href="../../../quality/"><strong> Testing</strong></a>
<ul>
<li><a title="Downloads of mozilla.org software releases" href="../../../download.html"> Releases</a></li>
<li><a title="Latest mozilla builds for testers" href="../../../developer/#builds"> Nightly Builds</a></li>
<li><a title="For testers to report bugs" href="https://bugzilla.mozilla.org/"> Report A Problem</a></li>
</ul>
</li>
<li><a title="Tools for mozilla developers" href="../../../tools.html"><strong> Tools</strong></a>
<ul>
<li><a title="Bug tracking system for mozilla testers." href="https://bugzilla.mozilla.org/"> Bugzilla</a></li>
<li><a title="Latest status of mozilla builds" href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=Firefox"> Tinderbox</a></li>
<li><a title="Latest checkins" href="http://bonsai.mozilla.org/cvsqueryform.cgi"> Bonsai</a></li>
<li><a title="Source cross reference" href="http://lxr.mozilla.org/seamonkey/"> LXR</a></li>
</ul>
</li>
<li><a title="Frequently Asked Questions." href="../../../faq.html"><strong> FAQs</strong></a></li>
</ul>

</div>
<hr class="hide">
<div id="mainContent">



  
             
<h1 align="center">Technology Specification for Shared Profile Data</h1>
     
<div align="center"><small><i>author: <a
 href="mailto:jgaunt@netscape.com">jgaunt</a> date:  Sept 19, 2002</i></small><br>
   </div>
     
<h4>Summary</h4>
 
<blockquote>  Outline the requirements for profile sharing, define some terms 
for this  conversation and outline the approach being taken in general terms. 
For more  discussion of what areas are impacted by profile sharing see this 
  <a href="../shared_profiles.html">profile sharing document</a>. For more 
technical  documents dealing with implementation specifics for the different 
components  head to the <a href="./index.html">profile sharing tech doc homepage</a>.<br>
 </blockquote>
             
<h4>Definitions - for this discussion</h4>
             
<ul>
         <li>user - in the terms of multiple login machines this equates
to  the  concept of an Operating System user, defined by the login to the
system.<br>
        </li>
        <li>process - a gecko based program that access the profile of a
user</li>
         <li>server - a process separate from the gecko process, launched 
by  a  gecko process to manage communication between gecko processes</li>
         <li>client - equivalent to "process" above</li>
         <li>profile - a single user may have multiple profiles on a system.
  This  refers to one of those profiles. The profile stores user specific
data  for  an installation of gecko</li>
         <li>shared - data in a user's profile that can be viewed and changed 
  by more than one process</li>
         <li>non shared&nbsp;- data in a user's profile that a specific process 
 declares  it does not want to share with other processes<br>
         </li>
             
</ul>
             
<h4>Requirements</h4>
   
<blockquote><i>For a single user profile, allow multiple gecko based processes 
              to share profile data at runtime.</i><br>
  </blockquote>
             
<ul>
         <li>Allow multiple processes on a single computer access to a single 
  user's  profile data at runtime, dynamically</li>
         <li>Do not lose any changes to the profile data -- zero corruption!</li>
         <li>When a process starts up make sure it has the most current set 
 of  shared profile information available at the moment it starts up</li>
         <li>Allow processes to not use the shared profile system at all
and   be  able to run in a non shared profile environment without incurring
any   overhead  ( or at least minimal )</li>
         <li>Co-ordinate with all the subsystems using profile data to avoid
  breaking  of features ( i.e.. locking of prefs, time-out of cookies...
)</li>
         <li>No corruption of profile data EVEN in the face of process/manager
   hangs or crashes (some kind of backup system?)<br>
         </li>
             
</ul>
             
<h4>Design</h4>
             
<ul>
         <li>The overriding goal of this design is to impact the existing 
systems as little as possible. This functionality should "bolt-on" to the 
side of the existing profile implementations. This approach should keep to
a minimum code bloat in builds that do not have a shared profile environment
(i.e. WinCE). There will be some general profile work that will need to happen,
but the individual components ( i.e. cookeis, prefs, cache, etc... ) should
not need to be <i>overhauled</i> to make use of this system.&nbsp;</li>
    <li>50k foot view - profiles will be split into shared and non shared 
spaces. Individual processes will have a non shared directory for data they 
do not want to share with other processes and they will be able to access 
a shared folder (most likely the root profile folder where everything is currently
stored) to get access to any shared data. When making changes to shared data
a process will notify the Transaction Manager (TM) of the change and the
manager will broadcast a message to any interested processes. Upon receiving 
a message from the TM a process will modify its internal state to correspond
with the known state of the shared data.</li>
  <li>Seperate locations for storing shared and  non-shared data</li>
  <ul>
    <li>For programs that need some non-shared  space,    give   them   an
 individual    folder within the users profile  directory    ( {USER_DIR}/{salted
      name}/[phoenix|mozilla|netscape|chimera|etc]      ). This directory
will almost always be needed as there will be chrome files etc that won't
be shared</li>
    <li>in the base level of the user's profile  directory      (  {USER_DIR}/{salted
      name}/ ) keep the data that will  be shared &nbsp;- shared pref files,
cookies etc...</li>
  </ul>
  <li>The seperate TM process will be launched on startup of the first gecko
based process and subsequent gecko processes will register with the existing
TM.<br>
  </li>
  <li>The TM will be run out of process and communicate  via an IPC mechanism.
It will coordinate the messaging aspect of profile   sharing, namely it will
receive from a process a message describing a change    to the profile data.
That message will then be relayed to all processes  who  have registered
as a listener for the profile subsystem that is being  modified.  Only a
system interested in the specific change will be notified  of that change.
Processes registered to listen for preference changes will  not get messages
about  cookie changes.</li>
                       
  <ul>
                                 
  </ul>
       <li>The IPC mechanism will be as cross platform as possible. It is 
understood   that we don't currently have a completely cross platform way
of doing IPC, so platform   specific implementations may be necessary. If
it is possible to formulate   an API (ala NSPR) that does cross platform
IPC such an API will be created.</li>
                
</ul>
<h4>Use Cases</h4>
<ul>
  <li>Startup - on startup a process will have to check for the existence
of a TM. If it does not exist, and the particular platform allows sharing
of profile data (might be application specific too) the TM will be started
and the process will register with the TM as a process that has the capability
of being interested in shared data. The process won't actually register as
a listener of shared data until the actual modules that use the shared data
are started up. Hopefully this will keep race conditions and startup ordering
issues to a minimum.</li>
  <li>Shutdown - at shutdown a process will need to remove itself from any
shared data listener list in the TM that is has been added to. The process
will need to make sure it's data is up to date first, and then write that
data out to disk. After all of this it will need to check if any other gecko
processes are registered with the TM, and if not, then it will shut down
the TM (perhaps in the case of the quickstart feature we need to handle something
special here - quickstart could throw some funky variations on the shutdown/startup
patterns)</li>
  <li>Writing data to disk - We write profile data to disk periodically through
the runtime of the application. Sometimes they are timer based, sometimes
UI driven. The key with shared profiles is to make sure whatever gets written
to disk is the most up to date information available. So before each write,
a process needs to check the TM for transactions in the queue that haven't
been processed.<br>
  </li>
</ul>
<br>
   <br>
  <br>
 <br>



<hr class="hide">
</div>
</div>
<div id="footer">
<ul>
<li><a href="../../../sitemap.html">Site Map</a></li>
<li><a href="../../../security/">Security Updates</a></li>
<li><a href="../../../contact/">Contact Us</a></li>
<li><a href="../../../foundation/donate.html">Donate</a></li>
</ul>
<p class="copyright">
Portions of this content are &copy; 1998&#8211;2009 by individual mozilla.org
contributors; content available under a Creative Commons license | <a
href="http://www.mozilla.org/foundation/licensing/website-content.html">Details</a>.</p>
<p>
<span>Last modified September 26,  2002</span>
<span><a href="http://bonsai-www.mozilla.org/cvslog.cgi?file=mozilla-org/html/projects/embedding/profileSharing/shared-profile-tech-spec.html&amp;rev=&amp;root=/www/">Document History</a></span>
</p>
</div>
</div>
</body>
</html>
