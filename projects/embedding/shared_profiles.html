<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="top" title="Home" href="http://www.mozilla.org/">
<link rel="stylesheet" type="text/css" href="../../css/print.css"  media="print">
<link rel="stylesheet" type="text/css" href="../../css/base/content.css"  media="all">
<link rel="stylesheet" type="text/css" href="../../css/cavendish/content.css" title="Cavendish" media="screen">
<link rel="stylesheet" type="text/css" href="../../css/base/template.css"  media="screen">
<link rel="stylesheet" type="text/css" href="../../css/cavendish/template.css" title="Cavendish" media="screen">
<link rel="icon" href="../../images/mozilla-16.png" type="image/png">

       
  <meta http-equiv="content-type"
 content="text/html; charset=ISO-8859-1">
       
  <meta name="author" content="Chak Nanga">
  <title>Issues with Mozilla Shared Profiles</title>
<script src="../../__utm.js" type="text/javascript"></script>
</head>
<body id="www-mozilla-org" class="deepLevel">
<div id="container">
<p class="important">You are currently viewing a snapshot of www.mozilla.org taken on April 21, 2008. Most of this content is
highly out of date (some pages haven't been updated since the project began in 1998) and exists for historical purposes only.  If
there are any pages on this archive site that you think should be added back to www.mozilla.org, please <a
href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=www.mozilla.org">file a bug</a>.</p>
<p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>
<div id="header">
<h1><a href="/" title="Return to home page" accesskey="1">Mozilla</a></h1>
<ul>
<li id="menu_aboutus"><a href="../../about/" title="Getting the most out of your online experience">About</a></li>
<li id="menu_developers"><a href="../../developer/" title="Using Mozilla's products for your own applications">Developers</a></li>
<li id="menu_store"><a href="http://store.mozilla.org/?r=mozorg1" title="Shop for Mozilla products on CD and other merchandise">Store</a></li>
<li id="menu_support"><a href="../../support/" title="Installation, trouble-shooting, and the knowledge base">Support</a></li>
<li id="menu_products"><a href="../../products/" title="All software Mozilla currently offers">Products</a></li>
</ul>
<form id="searchbox_002443141534113389537:ysdmevkkknw" action="http://www.google.com/cse" title="mozilla.org Search">
<div>
<label for="q" title="Search mozilla.org's sites">search mozilla:</label>
<input type="hidden" name="cx" value="002443141534113389537:ysdmevkkknw">
<input type="hidden" name="cof" value="FORID:0">
<input type="text" id="q" name="q" accesskey="s" size="30">
<input type="submit" id="submit" value="Go">
</div>
</form>
</div>
<hr class="hide">
<div id="mBody">
<div id="side">

<ul id="nav">
<li><a title="Roadmap" href="../../roadmap.html"><strong> Roadmap</strong></a></li>
<li><a title="Projects" href="../../projects/"><strong> Projects</strong></a></li>
<li><a title="For developers" href="../../developer/"><strong> Coding</strong></a>
<ul>
<li><a title="Module Owners" href="../../owners.html"> Module Owners</a></li>
<li><a title="Hacking" href="../../hacking/"> Hacking</a></li>
<li><a title="Get the Source" href="http://developer.mozilla.org/en/docs/Download_Mozilla_Source_Code"> Get the Source</a></li>
<li><a title="Building Mozilla" href="http://developer.mozilla.org/en/docs/Build_Documentation"> Build It</a></li>
</ul>
</li>
<li><a title="Testing" href="../../quality/"><strong> Testing</strong></a>
<ul>
<li><a title="Downloads of mozilla.org software releases" href="../../download.html"> Releases</a></li>
<li><a title="Latest mozilla builds for testers" href="../../developer/#builds"> Nightly Builds</a></li>
<li><a title="For testers to report bugs" href="https://bugzilla.mozilla.org/"> Report A Problem</a></li>
</ul>
</li>
<li><a title="Tools for mozilla developers" href="../../tools.html"><strong> Tools</strong></a>
<ul>
<li><a title="Bug tracking system for mozilla testers." href="https://bugzilla.mozilla.org/"> Bugzilla</a></li>
<li><a title="Latest status of mozilla builds" href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=Firefox"> Tinderbox</a></li>
<li><a title="Latest checkins" href="http://bonsai.mozilla.org/cvsqueryform.cgi"> Bonsai</a></li>
<li><a title="Source cross reference" href="http://lxr.mozilla.org/seamonkey/"> LXR</a></li>
</ul>
</li>
<li><a title="Frequently Asked Questions." href="../../faq.html"><strong> FAQs</strong></a></li>
</ul>

</div>
<hr class="hide">
<div id="mainContent">



  
   
<div align="center"><big>Issues with Sharing User Profiles in Mozilla</big><br>
  <br>
  </div>
 This page introduces the topic of profile sharing and goes through the different 
components affected by moving to a shared profile environment. Work has begun
on the design for a mechanism to share prefs between multiple mozilla/gecko
based processes. For design and implementation notes please visit the <a
 href="./profileSharing/">Profile Sharing Tech Documents Home Page</a><br>
 <br>
 There's been much discussion on profile sharing (or lack there of) in <a
 href="http://bugzilla.mozilla.org/show_bug.cgi?id=76431">http://bugzilla.mozilla.org/show_bug.cgi?id=76431</a>
 and the general consensus is that it's a bad idea to share profiles between:<br>
  &nbsp;&nbsp; * Multiple instances of the same application <br>
  &nbsp;&nbsp; * Instances of different applications at the same time.<br>
  <br>
  Mozilla does not currently have a scheme in place to arbitrate safe access
 to a profile between different applications. So, the general issue with
sharing  the same Mozilla profile between different instances of Mozilla
based applications  simultaneously is the serious and likely possibility
of file corruption.<br>
  <br>
  <u><big>Modules affected by multiple instances/apps sharing the same profile:</big></u><br>
  Bookmarks<br>
  Cache<br>
  Mail/News<br>
  Preferences<br>
  History<br>
  Certificates<br>
  Cookies<br>
  Plugins<br>
  Password Mgr/Form Prefill<br>
  <br>
  Even though all of the modules mentioned above will be affected in some 
way in a shared profile environment, the following modules will be of particular
 interest to users embedding Mozilla:<br>
  <br>
  Cookies<br>
  Cache<br>
  Certificates<br>
  Plugins<br>
  Preferences<br>
  Password Manager<br>
  <br>
  <big><u>Cookies</u></big><br>
  Currently the Cookies module writes to disk frequently since it does not
 want to lose a cookie due to application crash. It currently writes to disk&nbsp;
every timea cookie is set.<br>
  Even though cookies are written out to the file, the browser only reads 
in the file once (at the beginning of the session) so if one app changes it
other apps will not know that.<br>
  <br>
  The primary issue here is that of sharing in-memory session cookies between
 multiple application instances.<br>
  <br>
  If this were to become a requirement for shared profiles then we need to
 devise a complex IPC scheme to communicate session cookie information to
all currently running instances of Mozilla which are sharing a profile.<br>
  <br>
  <u><big>Cache</big></u><br>
  The primary issue here is that of cache corruption since multiple instances
 will be trying to update the cache folder simultaneously.<br>
  <br>
  Major rewrite (and re-architecture) of the Cache module will be required 
to share the same Cache directory in a profile between different instances
 of a Mozilla based application. There are major file sync issues involved
 here and in the event of a rewrite (if really needed) there's a serious
chance  of cache performance degradation.<br>
  <br>
  Recommendation : Do not share the same cache directory between different
 instances.<br>
  <br>
  A solution to work around this is that each application create its own 
cache dir per profile via a preference setting. This could be done with the 
current code base.<br>
  <br>
  <u><big>Certificates</big></u><br>
  The certificate database is an old Berkeley binary database, that gets
updated  as the application runs. The version of Berkeley DB we're using
does not support concurrent access from multiple applications. The application
keeps handles to the open files, and makes assumptions about the current
state of the database.<br>
  <br>
  Multiple applications accessing that database would lead to corruption
immediately.<br>
  <br>
  The security team is looking into supporting concurrency for some of their
 clients (servers have been wanting this for a long time), but it will require
 using a newer version of the Berkeley DB. These new versions are controlled
 by Sleepy Cat for commercial releases. We cannot open source the DB, so
it  is unlikely &nbsp;that Mozilla will be able to use this work.<br>
  Note: the above paragraph doesn't seem right to me. SleepyCat claims to 
be open source and allows shipping as part of any application for which the 
source code is available.  See <a
 href="http://www.sleepycat.com/licensing.html">their license page</a>. Well? 
 That seems like it's compatible with our releases, doesn't it? -- <a
 href="mailto:scc@mozilla.org">scc</a><br>
  <br>
  <u><big>Plugins</big></u><br>
  The issue here is that some plugins such as Flash that require stream-as-file
 wouldn't work. These type of plugins utilize the cache, if present. If the
 disk cache is not present, the plugin code will fallback to storing the
downloaded  data to a temporary folder.&nbsp; We'd need to verify that this
temporary  folder uses the appropriate system call to generate a unique file.<br>
  <br>
  That being said, if we go with the recommended "cache" solution, this issue
 becomes somewhat moot, since there would be a disk cache for each application.
 <br>
  <br>
  Also, we encounter issues such as notification of a newly installed plugin
 in one instance to all other currently running instances. <br>
  <br>
  We encounter a similar notification issue with the notification of new
XPCOM  component installation across application instances as well. <br>
  <br>
  <u><big>Preferences</big></u><br>
  Currently preferences get written out at application shutdown. So, the
last  &nbsp;instance which shuts down wins.<br>
  The likelihood of preference corruption only occurs when preferences are
 modified by individual simultaneously running instances. We do not have
an  issue in the scenario of "master application" used to set preferences
while  other "companion" applications merely read the preference settings.<br>
  <br>
  <u><big>Password Manager</big></u><br>
  Currently the Password Manager module writes to disk frequently since it
 does not want to lose a password due to application crash i.e. it currently
 does an immediate write to disk. But, it reads it only at the beginning
of  the session, <br>
  so, if one app changes some values other apps will not know about it.<br>
  <br>
  <br>
  <u><big>A proposed solution to the "Shared Profile" issue</big></u><br>
  Many ideas were floated around on ways to solve this issue. Most of them
 involved some sort of an XP IPC mechanism to notify/arbitrate access to
shared  resources in a profile between multiple running instances of applications.
 The complexity and the amount of work involved with this approach did not
 make this route an ideal one to pursue.<br>
  <br>
  A notion of a "subprofile" was discussed which would allow each running 
instance to have its own prefs, cookies, cache settings - all under the same 
profile. Upon startup each&nbsp; process would create a separate dir for prefs,
cache etc. under the same profile. Each process would also be able to access
any "master profile" data, say a "global" preference setting, if needed.
We can also extend the observer mechanism currently in place to have another
profile <br>
  observer which watches changes to the master profile dir and notifies the
 other interested parties (i.e. application instances) so they can act appropriately.<br>
  <br>
  Irrespective of the route we take, we would need to add support for monitoring/communicating
 file changes across processes in an XP way. It's unclear what this would
exactly mean, but whatever it ends up meaning it would most likely be reused
for many of the profile elements. <br>
  <br>
  <br>
 <br>



<hr class="hide">
</div>
</div>
<div id="footer">
<ul>
<li><a href="../../sitemap.html">Site Map</a></li>
<li><a href="../../security/">Security Updates</a></li>
<li><a href="../../contact/">Contact Us</a></li>
<li><a href="../../foundation/donate.html">Donate</a></li>
</ul>
<p class="copyright">
Portions of this content are &copy; 1998&#8211;2009 by individual mozilla.org
contributors; content available under a Creative Commons license | <a
href="http://www.mozilla.org/foundation/licensing/website-content.html">Details</a>.</p>
<p>
<span>Last modified October  2,  2002</span>
<span><a href="http://bonsai-www.mozilla.org/cvslog.cgi?file=mozilla-org/html/projects/embedding/shared_profiles.html&amp;rev=&amp;root=/www/">Document History</a></span>
</p>
</div>
</div>
</body>
</html>
