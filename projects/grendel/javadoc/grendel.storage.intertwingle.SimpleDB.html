
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<link rel="top" title="Home" href="http://www.mozilla.org/">
<link rel="stylesheet" type="text/css" href="../../../css/print.css"  media="print">
<link rel="stylesheet" type="text/css" href="../../../css/base/content.css"  media="all">
<link rel="stylesheet" type="text/css" href="../../../css/cavendish/content.css" title="Cavendish" media="screen">
<link rel="stylesheet" type="text/css" href="../../../css/base/template.css"  media="screen">
<link rel="stylesheet" type="text/css" href="../../../css/cavendish/template.css" title="Cavendish" media="screen">
<link rel="icon" href="../../../images/mozilla-16.png" type="image/png">

<TITLE>
  Class grendel.storage.intertwingle.SimpleDB
</TITLE>
<script src="../../../__utm.js" type="text/javascript"></script>
</head>
<body id="www-mozilla-org" class="deepLevel">
<div id="container">
<p class="important">You are currently viewing a snapshot of www.mozilla.org taken on April 21, 2008. Most of this content is
highly out of date (some pages haven't been updated since the project began in 1998) and exists for historical purposes only.  If
there are any pages on this archive site that you think should be added back to www.mozilla.org, please <a
href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=www.mozilla.org">file a bug</a>.</p>
<p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>
<div id="header">
<h1><a href="/" title="Return to home page" accesskey="1">Mozilla</a></h1>
<ul>
<li id="menu_aboutus"><a href="../../../about/" title="Getting the most out of your online experience">About</a></li>
<li id="menu_developers"><a href="../../../developer/" title="Using Mozilla's products for your own applications">Developers</a></li>
<li id="menu_store"><a href="http://store.mozilla.org/?r=mozorg1" title="Shop for Mozilla products on CD and other merchandise">Store</a></li>
<li id="menu_support"><a href="../../../support/" title="Installation, trouble-shooting, and the knowledge base">Support</a></li>
<li id="menu_products"><a href="../../../products/" title="All software Mozilla currently offers">Products</a></li>
</ul>
<form id="searchbox_002443141534113389537:ysdmevkkknw" action="http://www.google.com/cse" title="mozilla.org Search">
<div>
<label for="q" title="Search mozilla.org's sites">search mozilla:</label>
<input type="hidden" name="cx" value="002443141534113389537:ysdmevkkknw">
<input type="hidden" name="cof" value="FORID:0">
<input type="text" id="q" name="q" accesskey="s" size="30">
<input type="submit" id="submit" value="Go">
</div>
</form>
</div>
<hr class="hide">
<div id="mBody">
<div id="side">

<ul id="nav">
<li><a title="Roadmap" href="../../../roadmap.html"><strong> Roadmap</strong></a></li>
<li><a title="Projects" href="../../../projects/"><strong> Projects</strong></a></li>
<li><a title="For developers" href="../../../developer/"><strong> Coding</strong></a>
<ul>
<li><a title="Module Owners" href="../../../owners.html"> Module Owners</a></li>
<li><a title="Hacking" href="../../../hacking/"> Hacking</a></li>
<li><a title="Get the Source" href="http://developer.mozilla.org/en/docs/Download_Mozilla_Source_Code"> Get the Source</a></li>
<li><a title="Building Mozilla" href="http://developer.mozilla.org/en/docs/Build_Documentation"> Build It</a></li>
</ul>
</li>
<li><a title="Testing" href="../../../quality/"><strong> Testing</strong></a>
<ul>
<li><a title="Downloads of mozilla.org software releases" href="../../../download.html"> Releases</a></li>
<li><a title="Latest mozilla builds for testers" href="../../../developer/#builds"> Nightly Builds</a></li>
<li><a title="For testers to report bugs" href="https://bugzilla.mozilla.org/"> Report A Problem</a></li>
</ul>
</li>
<li><a title="Tools for mozilla developers" href="../../../tools.html"><strong> Tools</strong></a>
<ul>
<li><a title="Bug tracking system for mozilla testers." href="https://bugzilla.mozilla.org/"> Bugzilla</a></li>
<li><a title="Latest status of mozilla builds" href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=Firefox"> Tinderbox</a></li>
<li><a title="Latest checkins" href="http://bonsai.mozilla.org/cvsqueryform.cgi"> Bonsai</a></li>
<li><a title="Source cross reference" href="http://lxr.mozilla.org/seamonkey/"> LXR</a></li>
</ul>
</li>
<li><a title="Frequently Asked Questions." href="../../../faq.html"><strong> FAQs</strong></a></li>
</ul>

</div>
<hr class="hide">
<div id="mainContent">
<!-- Automatically generated with polardoc Version 1.0.4 on Tue Sep 08 11:22:09 PDT 1998 -->
<!-- grendel.storage.intertwingle.SimpleDB | Do not remove or edit this line! -->



<A NAME="_Top_"></A>
<PRE>
<A HREF="Packages.html">All Packages</A>  <A HREF="Package-grendel.storage.intertwingle.html">This Package</A>  <A HREF="Tree.html">Class Hierarchy</A>  <A HREF="Search.html">Class Search</A>  <A HREF="AllNames.html">Index</A>
</PRE>
<HR SIZE=1 ALIGN=left WIDTH="98%">
<H1>
     Class grendel.storage.intertwingle.SimpleDB
</H1>
<PRE>
<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.Object.html#_Top_">java.lang.Object</A>
   |
   +----<A HREF="grendel.storage.intertwingle.BaseDB.html#_Top_">grendel.storage.intertwingle.BaseDB</A>
           |
           +----grendel.storage.intertwingle.SimpleDB
</PRE>
<DL>
<P>
Simplistic implementation of a RDF-ish database.  This is basically a
  massive hashtable hack.  Almost certainly we shouldn't ship this, but it
  ought to be good enough to play with for a while.

  <p>

  Here's how it works:

  <p>

  There are five files.  One is the "store", and it stores the data.  All
  data is accessed via a hash table, so each entry in the store contains
  one or two pointers to other entries with the same hash.  ("two" is in
  the case where there are two hash tables into the same data.)
  <p>
  The other four files are head pointers into the hashtable, for various
  hashes.
  <p>
  Random strings are stored in the store.  They get hashed using
  String.hashCode(), the hash value is masked off to HASHMASK, and the
  first pointer to the hashtable appear in the "strhead" file.  Each
  entry consists of a pointer to the next string with the same hashcode, and
  then a refcount, and then the UTF version of the string itself.
  <p>
  Assertions are stored in the store.  Each assertion is three strings:
  name, slot, and value.  The strings are first put into the store, and
  then the assertion is recorded by writing down the location of the
  strings.  Each assertion is hashed twice: once by combining the name and
  slot, and once by combining the value and slot.  So, each assertion records
  the next value for both hash tables, followed by the three string
  locations.  So, each assertion costs 20 bytes on disk, not counting the
  string storage.  The "head[]" files are the first pointers for each
  hashtable.
  <p>
  Finally, a free list of unused chunks in the store are kept.  The
  "freehead" file points to the first free entry of a given size; each
  free entry points to the next free entry of the same size.
<P>
</DL>
<HR SIZE=1 ALIGN=left WIDTH="98%">
<A NAME="_Summary_"></A>
<PRE>
public final class  <STRONG>SimpleDB</STRONG>
     extends grendel.storage.intertwingle.<A HREF="grendel.storage.intertwingle.BaseDB.html#_Top_">BaseDB</A>
{
          // Fields 8
     private static final int <A HREF="#HASHMASK">HASHMASK</A>;
     private static final int <A HREF="#MAXALLOC">MAXALLOC</A>;
     private static final int <A HREF="#MINALLOC">MINALLOC</A>;
     private RandomAccessFile <A HREF="#freehead">freehead</A>;
     private RandomAccessFile[] <A HREF="#head">head</A>;
     private RandomAccessFile <A HREF="#store">store</A>;
     private File <A HREF="#storename">storename</A>;
     private RandomAccessFile <A HREF="#strhead">strhead</A>;

          // Constructors 1
     public <A HREF="#SimpleDB(java.io.File)">SimpleDB</A>(File) throws IOException;

          // Methods 11
     private int <A HREF="#LookupString(java.lang.String, boolean)">LookupString</A>(String, boolean) throws IOException;
     private void <A HREF="#addStringRef(int)">addStringRef</A>(int) throws IOException;
     private int <A HREF="#alloc(int)">alloc</A>(int) throws IOException;
     public synchronized void <A HREF="#assert(java.lang.String, java.lang.String, java.lang.String)">assert</A>(String, String, String) throws IOException;
     public synchronized void <A HREF="#dump(java.io.PrintStream)">dump</A>(PrintStream) throws IOException;
     private void <A HREF="#dumpString(int)">dumpString</A>(int) throws IOException;
     public synchronized Enumeration <A HREF="#findAll(java.lang.String, java.lang.String, boolean)">findAll</A>(String, String, boolean) throws IOException;
     public synchronized String <A HREF="#findFirst(java.lang.String, java.lang.String, boolean)">findFirst</A>(String, String, boolean) throws IOException;
     private void <A HREF="#free(int, int)">free</A>(int, int) throws IOException;
     private void <A HREF="#removeStringRef(int)">removeStringRef</A>(int) throws IOException;
     public synchronized void <A HREF="#unassert(java.lang.String, java.lang.String, java.lang.String)">unassert</A>(String, String, String) throws IOException;

          // Inner Classes 1
     class <A HREF="grendel.storage.intertwingle.SimpleDB.AllEnumerator.html#_Top_">AllEnumerator</A>
}
</PRE>
<P>
<HR SIZE=1 ALIGN=left WIDTH="98%">
<CENTER><BR><H2>Fields</H2></CENTER>
<BR><H3> <A NAME="storename"><FONT COLOR="#FF00FF">&#149;</FONT> storename</A></H3>
<PRE>
   private <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.File.html#_Top_">File</A> storename
</PRE>
<BLOCKQUOTE>
<BR>
<P> </BLOCKQUOTE>

<BR><H3> <A NAME="store"><FONT COLOR="#FF00FF">&#149;</FONT> store</A></H3>
<PRE>
   private <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.RandomAccessFile.html#_Top_">RandomAccessFile</A> store
</PRE>
<BLOCKQUOTE>
<BR>
<P> </BLOCKQUOTE>

<BR><H3> <A NAME="head"><FONT COLOR="#FF00FF">&#149;</FONT> head</A></H3>
<PRE>
   private <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.RandomAccessFile.html#_Top_">RandomAccessFile</A>[] head
</PRE>
<BLOCKQUOTE>
<BR>
<P> </BLOCKQUOTE>

<BR><H3> <A NAME="strhead"><FONT COLOR="#FF00FF">&#149;</FONT> strhead</A></H3>
<PRE>
   private <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.RandomAccessFile.html#_Top_">RandomAccessFile</A> strhead
</PRE>
<BLOCKQUOTE>
<BR>
<P> </BLOCKQUOTE>

<BR><H3> <A NAME="freehead"><FONT COLOR="#FF00FF">&#149;</FONT> freehead</A></H3>
<PRE>
   private <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.RandomAccessFile.html#_Top_">RandomAccessFile</A> freehead
</PRE>
<BLOCKQUOTE>
<BR>
<P> </BLOCKQUOTE>

<BR><H3> <A NAME="MINALLOC"><FONT COLOR="#0000FF">&#149;</FONT> MINALLOC</A></H3>
<PRE>
   private static final int MINALLOC
</PRE>
<BLOCKQUOTE>
<BR>
<P> </BLOCKQUOTE>

<BR><H3> <A NAME="MAXALLOC"><FONT COLOR="#0000FF">&#149;</FONT> MAXALLOC</A></H3>
<PRE>
   private static final int MAXALLOC
</PRE>
<BLOCKQUOTE>
<BR>
<P> </BLOCKQUOTE>

<BR><H3> <A NAME="HASHMASK"><FONT COLOR="#0000FF">&#149;</FONT> HASHMASK</A></H3>
<PRE>
   private static final int HASHMASK
</PRE>
<BLOCKQUOTE>
<BR>
<P> </BLOCKQUOTE>

<P>
<HR SIZE=1 ALIGN=left WIDTH="98%">

<CENTER><BR><H2>Constructors</H2></CENTER>
<BR><H3><A NAME="SimpleDB"><FONT COLOR="#FFCC00">&#149;</FONT></A>
<A NAME="SimpleDB(java.io.File)">SimpleDB</A> </H3>
<PRE>
   public SimpleDB(<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.File.html#_Top_">File</A> f)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
</BLOCKQUOTE> <BR>

<HR SIZE=1 ALIGN=left WIDTH="98%">

<CENTER><BR><H2>Methods</H2></CENTER>
<BR><H3><A NAME="alloc"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="alloc(int)">alloc</A> </H3>
<PRE>
   private int alloc(int length)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="free"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="free(int, int)">free</A> </H3>
<PRE>
   private void free(int ptr, 
                     int length)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="LookupString"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="LookupString(java.lang.String, boolean)">LookupString</A> </H3>
<PRE>
   private int LookupString(<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> str, 
                            boolean create)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="addStringRef"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="addStringRef(int)">addStringRef</A> </H3>
<PRE>
   private void addStringRef(int loc)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="removeStringRef"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="removeStringRef(int)">removeStringRef</A> </H3>
<PRE>
   private void removeStringRef(int loc)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="assert"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="assert(java.lang.String, java.lang.String, java.lang.String)">assert</A> </H3>
<PRE>
   public synchronized void assert(<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> name, 
                                   <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> slot, 
                                   <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> value)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="unassert"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="unassert(java.lang.String, java.lang.String, java.lang.String)">unassert</A> </H3>
<PRE>
   public synchronized void unassert(<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> name, 
                                     <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> slot, 
                                     <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> value)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="findFirst"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="findFirst(java.lang.String, java.lang.String, boolean)">findFirst</A> </H3>
<PRE>
   public synchronized <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> findFirst(<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> name, 
                                        <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> slot, 
                                        boolean reverse)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="findAll"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="findAll(java.lang.String, java.lang.String, boolean)">findAll</A> </H3>
<PRE>
   public synchronized <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.util.Enumeration.html#_Top_">Enumeration</A> findAll(<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> name, 
                                           <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.lang.String.html#_Top_">String</A> slot, 
                                           boolean reverse)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="dumpString"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="dumpString(int)">dumpString</A> </H3>
<PRE>
   private void dumpString(int loc)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<BR><H3><A NAME="dump"><FONT COLOR="#FF0000">&#149;</FONT></A>
<A NAME="dump(java.io.PrintStream)">dump</A> </H3>
<PRE>
   public synchronized void dump(<A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.PrintStream.html#_Top_">PrintStream</A> out)  throws <A HREF="http://java.sun.com/products/jdk/1.1/docs/api/java.io.IOException.html#_Top_">IOException</A></PRE>
<BLOCKQUOTE>
<DL>
</DL>
</BLOCKQUOTE> <BR>

<HR SIZE=1 ALIGN=left WIDTH="98%">

<PRE>
<A HREF="Packages.html">All Packages</A>  <A HREF="Package-grendel.storage.intertwingle.html">This Package</A>  <A HREF="Tree.html">Class Hierarchy</A>  <A HREF="Search.html">Class Search</A>  <A HREF="AllNames.html">Index</A>
</PRE>
<FONT SIZE=-1>
<I>Freshly brewed Java API Documentation automatically generated with <A HREF="http://www.ualberta.ca/~tgee/polardoc">polardoc</A> Version 1.0.4
<BR>
</I></FONT>



<hr class="hide">
</div>
</div>
<div id="footer">
<ul>
<li><a href="../../../sitemap.html">Site Map</a></li>
<li><a href="../../../security/">Security Updates</a></li>
<li><a href="../../../contact/">Contact Us</a></li>
<li><a href="../../../foundation/donate.html">Donate</a></li>
</ul>
<p class="copyright">
Portions of this content are &copy; 1998&#8211;2009 by individual mozilla.org
contributors; content available under a Creative Commons license | <a
href="http://www.mozilla.org/foundation/licensing/website-content.html">Details</a>.</p>
<p>
<span>Last modified December 25,  1998</span>
<span><a href="http://bonsai-www.mozilla.org/cvslog.cgi?file=mozilla-org/html/projects/grendel/javadoc/grendel.storage.intertwingle.SimpleDB.html&amp;rev=&amp;root=/www/">Document History</a></span>
</p>
</div>
</div>
</body>
</html>
