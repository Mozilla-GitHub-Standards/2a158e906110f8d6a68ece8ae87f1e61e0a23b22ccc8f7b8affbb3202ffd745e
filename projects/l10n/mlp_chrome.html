<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
<link rel="top" title="Home" href="http://www.mozilla.org/">
<link rel="stylesheet" type="text/css" href="../../css/print.css"  media="print">
<link rel="stylesheet" type="text/css" href="../../css/base/content.css"  media="all">
<link rel="stylesheet" type="text/css" href="../../css/cavendish/content.css" title="Cavendish" media="screen">
<link rel="stylesheet" type="text/css" href="../../css/base/template.css"  media="screen">
<link rel="stylesheet" type="text/css" href="../../css/cavendish/template.css" title="Cavendish" media="screen">
<link rel="icon" href="../../images/mozilla-16.png" type="image/png">

   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Author" content="Andrea Salmaso, Tao Chen">
   <meta name="GENERATOR" content="Mozilla">
   <title>Mozilla localization technical details</title>

<script language="javascript" type="text/javascript">
 function MozVersion()
 {
 if (navigator.userAgent.indexOf("Gecko") == -1)
  message = "Can't determine the Mozilla version string"
 else
  {
   message = "Mozilla version '";
   message += navigator.userAgent.match(/rv:([^;)]+)/)[1];
   message += "'"
   if (message.indexOf("''") != -1)
     message = "Can't determine the Mozilla version string";
  }
 alert (message);
 }
//-->
</script>


<script src="../../__utm.js" type="text/javascript"></script>
</head>
<body id="www-mozilla-org" class="deepLevel">
<div id="container">
<p class="important">You are currently viewing a snapshot of www.mozilla.org taken on April 21, 2008. Most of this content is
highly out of date (some pages haven't been updated since the project began in 1998) and exists for historical purposes only.  If
there are any pages on this archive site that you think should be added back to www.mozilla.org, please <a
href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=www.mozilla.org">file a bug</a>.</p>
<p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>
<div id="header">
<h1><a href="/" title="Return to home page" accesskey="1">Mozilla</a></h1>
<ul>
<li id="menu_aboutus"><a href="../../about/" title="Getting the most out of your online experience">About</a></li>
<li id="menu_developers"><a href="../../developer/" title="Using Mozilla's products for your own applications">Developers</a></li>
<li id="menu_store"><a href="http://store.mozilla.org/?r=mozorg1" title="Shop for Mozilla products on CD and other merchandise">Store</a></li>
<li id="menu_support"><a href="../../support/" title="Installation, trouble-shooting, and the knowledge base">Support</a></li>
<li id="menu_products"><a href="../../products/" title="All software Mozilla currently offers">Products</a></li>
</ul>
<form id="searchbox_002443141534113389537:ysdmevkkknw" action="http://www.google.com/cse" title="mozilla.org Search">
<div>
<label for="q" title="Search mozilla.org's sites">search mozilla:</label>
<input type="hidden" name="cx" value="002443141534113389537:ysdmevkkknw">
<input type="hidden" name="cof" value="FORID:0">
<input type="text" id="q" name="q" accesskey="s" size="30">
<input type="submit" id="submit" value="Go">
</div>
</form>
</div>
<hr class="hide">
<div id="mBody">
<div id="side">

<ul id="nav">
<li><a title="Roadmap" href="../../roadmap.html"><strong> Roadmap</strong></a></li>
<li><a title="Projects" href="../../projects/"><strong> Projects</strong></a></li>
<li><a title="For developers" href="../../developer/"><strong> Coding</strong></a>
<ul>
<li><a title="Module Owners" href="../../owners.html"> Module Owners</a></li>
<li><a title="Hacking" href="../../hacking/"> Hacking</a></li>
<li><a title="Get the Source" href="http://developer.mozilla.org/en/docs/Download_Mozilla_Source_Code"> Get the Source</a></li>
<li><a title="Building Mozilla" href="http://developer.mozilla.org/en/docs/Build_Documentation"> Build It</a></li>
</ul>
</li>
<li><a title="Testing" href="../../quality/"><strong> Testing</strong></a>
<ul>
<li><a title="Downloads of mozilla.org software releases" href="../../download.html"> Releases</a></li>
<li><a title="Latest mozilla builds for testers" href="../../developer/#builds"> Nightly Builds</a></li>
<li><a title="For testers to report bugs" href="https://bugzilla.mozilla.org/"> Report A Problem</a></li>
</ul>
</li>
<li><a title="Tools for mozilla developers" href="../../tools.html"><strong> Tools</strong></a>
<ul>
<li><a title="Bug tracking system for mozilla testers." href="https://bugzilla.mozilla.org/"> Bugzilla</a></li>
<li><a title="Latest status of mozilla builds" href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=Firefox"> Tinderbox</a></li>
<li><a title="Latest checkins" href="http://bonsai.mozilla.org/cvsqueryform.cgi"> Bonsai</a></li>
<li><a title="Source cross reference" href="http://lxr.mozilla.org/seamonkey/"> LXR</a></li>
</ul>
</li>
<li><a title="Frequently Asked Questions." href="../../faq.html"><strong> FAQs</strong></a></li>
</ul>

</div>
<hr class="hide">
<div id="mainContent">






<p>&nbsp;</p>
<table border="0" width="100%">
  <tr><td>
    <center><h1>Mozilla Language Pack internal structure</h1></center>
  </td></tr>
  <tr><td>
    <center><a href="news://news.mozilla.org/mozilla.dev.l10n">newsgroup discussion</a> /
    <a href="mailto:dev-l10n-request@lists.mozilla.org?subject=subscribe">mailing list</a><br>
    <a href="mailto:MLP Staff &lt;mlp-staff&#64;mozilla.org&gt;">Mozilla Localization Project Staff</a></center>
  </td></tr>
</table>
<br>
<abbr title="Mozilla Localization Project"><b>MLP</b></abbr>
 [<a href="./">Localization Project home</a>]
 | [<a href="mlp_docs.html">Localization docs</a>]
 | [Language pack tech]<br>
<br>

<table border=0 cellspacing=0 cellpadding=0 cols=1 width="100%" bgcolor="#FFFFCC" >
<tr><td><h3>Introduction</h3></td></tr>
</table>
<p>Mozilla can automatically install additional components using
 <a href="http://www.mozilla.org/projects/xpinstall/" title="Cross Platform Installer">XPI</a>
 packages.</p>
<p>The typical scenario sees a language pack for Mozilla constituted by
 one XPI archive. This is a PKZip compatible archive, containing the
 resources for a new language, targeted for a particular Mozilla
 <a href="javascript:MozVersion()">release</a> user interface, plus an
 installer script. In this way the user can add more installed languages
 in a click.<p>
<p>Mozilla enable each user, and each user profile, to dynamically select
 the preferred language for the application UI, among the installed ones.</p>


<table border=0 cellspacing=0 cellpadding=0 cols=1 width="100%" bgcolor="#FFFFCC" >
<tr><td><h3>Contents</h3></td></tr>
</table>
<ul type="circle">
<li><a href="#resources">Mozilla Localizable resources</a></li>
<li><a href="#text">Localizable text files</a></li>
<li><a href="#chrome">Introduction to the Mozilla Chrome</a></li>
<li><a href="#registering">How to register the localizable resources</a></il>
 <ul><li><a href="#reg_struct">Structure of one registrable package</a></li>
   <li><a href="#reg_pack">Creating a new locale package</a></li>
   <li><a href="#reg_reg">Having the package registered</a></li></ul>
<li><a href="#XPI">Creating a simple XPI language pack</a></li>
 <ul><li><a href="#XPI_jars">Packing the resources in JAR files</a></li>
   <li><a href="#XPI_script">Preparing the installation script</a></li>
   <li><a href="#XPI_pack">Putting everything in the XPI package</a></li></ul>
</ul>

<table border=0 cellspacing=0 cellpadding=0 cols=1 width="100%" bgcolor="#FFFFCC" >
<tr><td><h3><a name="resources"></a>Mozilla Localizable resources</h3></td></tr>
</table>
<p>The Mozilla user interface is composed of several XML pages the layout
 engine renders at runtime. This imply the user interface resources are
 constituted by only text files and graphic stored in conventional web
 formats. The localizable resources, being a part of the user interface,
 don't except to this rule.</p>
<p>What you need to keep in mind is not all the text editors are good enough
 to edit any text file. The keyword here is text <b>encoding</b>. The
 encoding is the way an application converts letters and symbols into
 an electronic documents. Not all the plain text documents have the same
 encoding. Even the same program (like Windows Notepad) ran on different
 machines (e.g. on a Slovak one and a Chinese one) can store the same
 symbols in different ways; or can't access / accept every kind of script
 or symbol. You'll need <a href="mlp_tools.html#texteditors">tools</a>
 able to "encode" your strings text in the encodings Mozilla understood.</p>
<p>The user interface files are parsed very likely to web documents.
 They although differs having access to functionalities for security reasons
 web documents need to be forbidden. The UI resources need then to be
 installed and <a href="#registering">registered</a>. All the user interface
 material works referring to each file through a peculiar
 <a href="#chrome">"chrome"</a> protocol, in a similar way web pages point
 to other documents using the HTTP protocol.</p>
<p>For convenience the various UI files, composing the Mozilla applications
 suite, are contained in a small number of zip compressed files with the
 <i>.jar</i> extension (even if they have quite a little to share with
 Java ARchives) under the binaries <i>chrome/</i> folder. These archives
 are usually arranged in a way the localizable material, if present, is
 grouped under a <i>locale/</i> folder.</p>
<p>Additional localizable resources, placed outside the <i>chrome/</i>
 folder, include the user profile defaults and other optional resources
 like <a href="http://mycroft.mozdev.org">search plugins</a>,
 <a href="http://spellchecker.mozdev.org/">spell checker</a> dictionaries,
 and the such. This material doesn't require a registration.</p>
<p>Let's see in the typical scenario: the English - United States (en-US)
 locale resources, bundled with Mozilla. These are the files usually a
 localizer have to work on, to get his language version of Mozilla.</p>

<blockquote><dl>
<dt>chrome/ <b>en-US.jar</b> !locale/en-US/<i>component</i>/*<br>
 each component registered under:
 <tt><i>chrome://component/locale/*</i></tt></dt>
<dd>The <tt>en-US.jar</tt> archive contains the bulk of the registered
   localizable material used in all the Mozilla applications user
   interface (divided by components).
   <br><br></dd>

<dt>chrome/ <b>en-mac.jar</b> !locale/en-US/<i>component</i>/*<br>
 or <b>en-win.jar</b>, or <b>en-unix.jar</b>; each component registered under:
 <tt><i>chrome://component/locale/*</i></tt></dt>
<dd>Contains just the platform dependent user interface part of Mozilla.
   All these files contains exactly the same components. So only one
   of the three files components are effectively registered.<br><br></dd>

<dt>chrome/ <b>US.jar</b> !locale/US/<i>component</i>/*<br>
 each component registered under:
 <tt><i>chrome://component/locale/*</i></tt></dt>
<dd>Contains so called <a href="mlp_regional.html">regional contents</a>.
   These are the regional specific pointers to external resources used
   throughout the user interface. This material uses a
   <a href="#XPI_jars">different locale code</a> from the one used for
   the rest of the localizable resources. Hence they can be selected
   indipendently.
   <br><br></dd>

<dt>defaults/profile/US/*</dt>
<dd>Profile templates. These files contain the user profile templates
   for several files such: bookmarks, default window geometry, MIME types
   binding, default Sidebar panels, default search plugins.
   These files are a part of the <a href="mlp_regional.html">regional
   contents</a>, but are used only on the creation of a new user profile.
   The folder name has to match the locale code used by the regional
   material.
   <br><br></dd>

<dt>searchplugins/*, components/myspell/*, ...</dt>
<dd>Additional stuff. These optional files ranges from
   <a href="http://mycroft.mozdev.org/">Mycroft</a> search plugins, to
   <a href="http://spellchecker.mozdev.org">spell checker</a> dictionaries,
   to any other localizable or locale specific component might appropriate
   distribute to fully adapt the application towards the user habits.
   <br><br></dd>

</dl></blockquote>


<a name="text"></a>
<table border=0 cellspacing=0 cellpadding=0 cols=1 width="100%" bgcolor="#FFFFCC" >
<tr><td><h3>Localizable text files</h3></td></tr>
</table>
<p>As stated above, not all the text editors are good enough for editing
 Mozilla text resources. Since the application has been designed from
 the beginning with international audience in mind, conventional 8 bit
 encodings many popular text editors still use, soon revealed being
 not enough for Mozilla purposes.<p>
<p>Mainly localizable resources are made up of:
 <ul><li>DTD files = XML definition tables. Encoding: <b>UTF-8</b></li>
     <li>properties files = Java/JS properties definitions. Encoding:
       <b>Escaped Unicode</b> (\uXXXX)</li></ul></p>
<p>To properly hand edit these files you'll need a
 <a href="mlp_tools.html#texteditors">text editor</a> capable to
 support these encodings. In this way Mozilla can use the full set of the
 symbols defined by the <a href="http://www.unicode.org">Unicode
 consortium</a>.</p>
<p><a href="mlp_tools.html#leveraging">Tools</a> like Mozilla Translator
 can handle all these details transparently for the user.</p>
<p>Both <i>dtd</i> and <i>properties</i> text files contains a collection
 of named strings. The former must comply to the XML documents rules,
 the latter to JavaScript conventions. This dictates the way comments,
 quotes, and allowed characters can be used.</p>
<p>The table below list the general rules to keep in mind if you're
 going to directly edit these files:</p>

<table border="0"><tr><td>

<table align="left" width="43%" border="1">
<thead>
 <tr><th>&nbsp;&nbsp;&nbsp;<b>dtd</b></th></tr>
</thead>
<tbody>
 <tr><td>String format:<br><font color="maroon">&lt;!ENTITY string_name "Text Text"></font></td></tr>
 <tr>
  <td align="center">
   <table align="left" border="0">
    <thead><tr><th>Not allowed:</th></tr></thead>
    <tbody>
    <tr><td>&amp;</td></tr>
    <tr><td>&lt;</td></tr>
    <tr><td>"</td></tr>
    <tr><td>&#037;</td></tr>
    <tbody>
   </table>
   <table border="0">
    <thead><tr><th>Use instead:</th></tr></thead>
    <tbody>
    <tr><td>&amp;amp;</td></tr>
    <tr><td>&amp;lt;</td></tr>
    <tr><td>&amp;quot;</td></tr>
    <tr><td>&amp;#037;</td></tr>
    <tbody>
   </table>
  </td>
 </tr>
 <tr>
  <td>
   <table width="100%" border="0">
    <thead><tr><th colspan="2">Other useful predefined entities:</th></tr></thead>
    <tbody>
    <tr><td width="50%">&gt;</td><td width="50%">&amp;gt;</td></tr>
    <tr><td>&apos;</td><td>&amp;apos;</td></tr>
    <tr><td colspan="2">Any other Unicode char through &amp;decimalnumber;</td></tr>
    <tbody>
   </table>
  </td>
 </tr>
 <tr>
  <td>Single or multi line comments: <font color="maroon">&nbsp;&lt;!-- Text Text Text --></font></td>
 </tr>
</tbody>
</table>

<table width="55%" border="1">
<thead>
 <tr><th>&nbsp;&nbsp;&nbsp;<b>properties</b></th></tr>
</thead>
<tbody>
 <tr><td>String format:<br><font color="maroon">string_name = Text Text</font></td></tr>
 <tr>
  <td align="center">
   <table align="left" border="0">
    <thead><tr><th>Not allowed:</th></tr></thead>
    <tbody>
    <tr><td>New line (ends string)</td></tr>
    <tr><td>Backslash "\"</td></tr>
    <tr><td>Double or single quotes " '</td></tr>
    <tbody>
   </table>
   <table border="0">
    <thead><tr><th>Use instead:</th></tr></thead>
    <tbody>
    <tr><td><tt>\n</tt> As newline<br></td></tr>
    <tr><td><tt>\\</tt> As backslash</td></tr>
    <tr><td><tt>\"</tt> and <tt>\'</tt></td></tr>
    <tbody>
   </table>
  </td>
 </tr>
 <tr>
  <td>
   <table width="100%" border="0">
    <thead><tr><th colspan="2">Other useful escaped chars:</th></tr></thead>
    <tbody>
    <tr><td width="50%">\b</td><td width="50%">Backspace</td></tr>
    <tr><td>\f</td><td>Form feed</td></tr>
    <tr><td>\r</td><td>Carriage return</td></tr>
    <tr><td>\t</td><td>Tab</td></tr>
    <tr><td colspan="2"><p>Any other Unicode char through \uXXXX,
      where XXXX is a four hexadecimal digit Unicode number</p>
      <p>A trailing backslash "\" as last char in the line
         continue the string in the following document line.</p>
      </td></tr>
    <tbody>
   </table>
  </td>
 </tr>
 <tr>
  <td>Whole line comments (from the first character): <font color="maroon">#&nbsp;Text&nbsp;Text</font><br>
      End of the line comments: <font color="maroon">//&nbsp;Text&nbsp;Text</font><br>
      Multi line comments: <font color="maroon">/* Text Text Text */</font></td>
 </tr>
</tbody>
</table>

</td></tr></table>
<p></p>

<a name="chrome"></a>
<table border=0 cellspacing=0 cellpadding=0 cols=1 width="100%" bgcolor="#FFFFCC" >
<tr><td><h3>Introduction to the Mozilla Chrome</h3></td></tr>
</table>
<p>The ultimate goal is create and have your new language resources
 registered in Mozilla. Once they're registered, the user is able to
 select and activate these resources as current ones, application wide.
 This means select your language in the Preferences <font size="-1">
 (Edit | Preferences | Appearance | Language/Contents)</font>, and restart
 the application.<p>
<p>Registering your language resources means having them listed in the
 Mozilla registry. Mozilla registry keeps track of a number of packages
 installed. Each Mozilla component (application) is usually modularized
 in three different packages:
<ul type="square"><li><i>content</i>: one mix of XML and JavaScript files
 containing the user interface logic for a particular application (like
 e.g. Mail, Navigator, Composer, the Bookmarks Manager, and so on). The
 XML files describing each app window use a particular set of tags
 called <abbr title="XML UserInterface Language">XUL</abbr>. They're
 manipulable at runtime though <abbr title="Document Object Model">DOM</abbr>
 properties, using JavaScript.</li>
<li><i>skin</i>: a collection of
 <abbr title="eXtensible Stylesheet Language">XLS</abbr>,
 <abbr title="Cascading Style Sheet">CSS</abbr>,
 and web graphic files, which defines the ultimate appearance for the
 parts of the user interface, described in the content of the
 application.</li>
<li><i>locale</i>: the localizable resources the content will use to
 communicate to the user.</li>
</ul></p>
<p>This modularization allows, for one application content, more than
 one possible appearance (skin, aka themes) or language (locale), just
 switching the files pointed by the application's XUL files.</p>
<p>This possible due the concept of currently selected locale and skin.
 We'll of course focus on the former, but the very same concepts applies
 to the latter.</p>
<p>Every locale package can be mainly identified by two properties: the
 content (application) component it's a part of, and the locale
 (<a href="mlp_howto.html#registration">language-NATION code</a>) it's
 owned by.</p>
<p>Once the user select one UI language for Mozilla, all the locale packages
 with the corresponding locale code are mapped through the
 <tt>chrome://</tt> protocol, as the default locale resources. The
 application files, actually, have no direct pointers to resources
 in the user storage devices. They're instead accessed through the
 <i>locale/</i> section of the <tt>chrome://</tt> space of the current
 application. And the currently selected default locale, makes Mozilla
 map the corresponding locale resources in the <i>locale/</i> "folder"
 of the application.</p>
<p><i>Let's clarify the concept with an example.</i><br>
 The application whose component name is "<tt>navigator</tt>" create a
 new window described in the <tt>navigator.xul</tt> XML file. It needs
 a string to show in the web search button.</p>
<p>The application pass the <tt>navigator.xul</tt> document to the
 Mozilla engine to have the window created. "<tt>navigator</tt>" is
 a registered application, with its corresponding content, skin and
 locale packages registered. We may have more than one different locale
 packages registered for the <tt>navigator</tt> component, each one
 with a copy of the same resources in a different language, recognizable
 by its locale code. We must have anyway, just one locale package
 selected at a given time.</p>
<p>The application doesn't need to know which locale is currently selected.
 Since all the resources will be accessed through the <tt>chrome</tt>
 protocol, and only the selected locale resources will be mapped under
 the <i>locale/</i> chrome address of the <tt>navigator</tt> component,
 the currently selected resources will be <i>the</i> application
 resources (the only ones accessible) accessed by <tt>navigator</tt>.</p>
<p>The application will pass the following URI for file describing the
 new window:<br>
<dl><dd><tt>chrome://navigator/content/navigator.xul</tt></dd></dl>
 Likewise, <tt>navigator.xul</tt> will reference a string inside<br>
<dl><dd><tt>chrome://navigator/locale/navigator.dtd</tt></dd></dl>
 to retrieve the text to be displayed in button. The application then
 will display whatever language with no modification. It's the
 underlying chrome handling which will take care for passing the
 relevant file from the selected locale resources to the application.</p>


<table border=0 cellspacing=0 cellpadding=0 cols=1 width="100%" bgcolor="#FFFFCC" >
<tr><td><h3><a name="registering"></a>How to register the localizable
   resources</h3></td></tr>
</table>
<p>The user interface part of the Mozilla localizable resources needs
 to be registered, in order to be selected and used.</p>
<p>Registering resources in Mozilla require one of the following actions:
<ul>
 <li>Let a JavaScript installer script inside an
  <abbr title="Cross Platform Installer">XPI</abbr> package register
  the contents distributed along its resource bundle. The script
  should be smart enough to handle the following situations:
  <ul>
   <li>Conditional registration of platform dependent material</li>
   <li>Application wide, or single user profile installation on
     multiuser environments</li>
   <li>Error conditions handling</li>
  </ul>
 </li>
 <li>List the new package in the <tt>chrome/installed-chrome.txt</tt>
  file the new packege(s), so that it can be registered the next
  time the root user restarts Mozilla.
 </li>
</ul></p>

<h4><a name="reg_struct"></a>Structure of one registrable package</h4>
<p>The smallest unit can be registered in Mozilla is one package.</p>
<p>You can think about a package as a group of files owned by a Mozilla
 application, registered under its component name. As discussed
 <a href="#chrome">above</a>, packages can exist of three main kinds:
 content, skin, locale. We're interested in creating locale packages.</p>
<p>If one component is structured in a way it can be localized, its
 localizable resources are externalized into a locale package with
 the same component name. We'll be able to register as many locale
 packages with the same component name as we wish, each one distinguished
 by its locale code.</p>
<p>The basic components of a package are:
<ul>
 <li>The files contained by the package itself, grouped inside one folder
     or inside one folder of a .jar archive (you can think about jars in
     all the respects as conventional zip archives).</li>
 <li>The <tt>contents.rdf</tt> XML file. This file will describe where's
     the package insertion point once registered, plus some more
     information about the package itself, like the author, the Mozilla
     version for which is targeted, and so on.</li>
</ul></p>

<h4><a name="reg_pack"></a>Creating a new locale package</h4>
<p>Let's suppose we want to create a Simplified Chinese (whose 
 <a href="mlp_howto.html#registration">locale code</a> is "zh-CN")
 package for the "<tt>editor</tt>" component. Let's suppose we're
 targeting Mozilla <a href="javascript:MozVersion()">version</a> 1.2.
 We should follow the steps below:</p>
<ul type="square">
 <li>Extract the English resources from the <i>locale/en-US/editor/</i>
     folder of <b>en-US.jar</b> file, using a conventional zip
     decompression utility.</li>
 <li><a href="mlp_howto.html#what2loc">Localize</a> the original English
     files to Chinese, <a href="mlp_tools.html#texteditors">editing</a>
     <b>.dtd</b>, <b>.properties</b> and other files.</li>
 <li>Compile the <b>contents.rdf</b> file accordingly the information
     of the package, and place it inside the same folder of the localized
     resource files.</li>
 <li>The package could be then optionally archived inside a compressed
     jar file.</li>
</ul></p>
<p>Let's see what our <tt>contents.rdf</tt> should looks like:</p>
<table border="0" cellspacing="5">
<caption><tt><b>contents.rdf</b></tt> for the zh-CN locale package
 of the <tt>editor</tt> component.</caption>
<tr><td bgcolor="#CCCCCC">
<pre>
&lt;?xml version="1.0"?&gt;
&lt;RDF:RDF xmlns:RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:chrome="http://www.mozilla.org/rdf/chrome#" &gt;

<font color="maroon">&lt;!-- We first create a "zh-CN" category in the "locale" root   --&gt;</font>
  &lt;RDF:Seq about="urn:mozilla:locale:root" &gt;
    &lt;RDF:li resource="urn:mozilla:locale:<font color="red">zh-CN</font>" /&gt;
  &lt;/RDF:Seq&gt;

<font color="maroon">&lt;!-- Then we fill/update more info about the Simplified Chinese
     locale group, assigning the a global version for its contents --&gt;</font>
  &lt;RDF:Description about="urn:mozilla:locale:<font color="red">zh-CN</font>"
       chrome:displayName="<font color="green">Chinese Simplified (zh-CN)</font>"
       chrome:author="<font color="green">MLP Staff</font>"
       chrome:name="<font color="green">zh-CN</font>"
       chrome:previewURL="<font color="green">http://www.mozilla.org/previewimages/China.png</font>"
       chrome:localeVersion="<font color="red">1.2</font>" &gt;

<font color="maroon">&lt;!-- Inside the zh-CN locale, we add our "editor" package
     marking it with its version information              --&gt;</font>
       &lt;chrome:packages&gt;
         &lt;RDF:Seq about="urn:mozilla:locale:<font color="red">zh-CN</font>:packages"&gt;
           &lt;RDF:li resource="urn:mozilla:locale:<font color="red">zh-CN</font>:<font color="red"><b>editor</b></font>"
                   chrome:localeVersion="<font color="red">1.2</font>" /&gt;
         &lt;/RDF:Seq&gt;
       &lt;/chrome:packages&gt;

  &lt;/RDF:Description&gt;

&lt;/RDF:RDF&gt;
</pre>
</td></tr></table>

<h4><a name="reg_reg"></a>Having the package registered</h4>
<p>Once the package has been completed, you can either create an XPI
 package as described in the <a href="#XPI">following section</a>, able
 to copy your work in the Mozilla folders and register the packages
 you've put in it; or add one line in the <tt><b>installed-chrome.txt</b></tt>
 file placed inside the <i>chrome/</i> folder.</p>
<p>Placing the localized files for the Chinese <tt>editor</tt> package
 seen above, in a folder called <tt><b>editorpackagetest</b></tt>
 inside the Mozilla <i>chrome/</i> directory, the line could
 look like:<br>
 <tt>locale,install,url,resource:/chrome/editorpackagetest/</tt></p>
<p>Once restarted Mozilla, you can see if the registration has succeeded
 both looking in the <tt>install.log</tt> file  (only for XPI installations)
 and in the <tt>chrome.rdf</tt>, searching for the information you put
 in the registered package.</p>
<p>If you've just added a new locale node in the Mozilla registry
 (e.g. if we didn't had any Simplified Chinese packages installed yet),
 you should also be able to see the <i>displayName</i> property added
 in the Preferences <font size="-1">(Edit | Preferences | Appearance |
 Language/Contents)</font>.</p>
<p>Also remember to set the correct
 <a href="javascript:MozVersion()">version</a> information in your
 <tt>contents.rdf</tt> file, or Mozilla will refuse to let the user
 select the added resources.</p>


<table border=0 cellspacing=0 cellpadding=0 cols=1 width="100%" bgcolor="#FFFFCC" >
<tr><td><h3><a name="XPI"></a>Creating a simple XPI language pack</h3></td></tr>
</table>
<p>This chapter will show how you can distribute all your work into
 one self installable language pack, in the form of an
 <abbr title="Cross Platform Installer">XPI</abbr> archive.</p>
<p>Our self installer XPI archive will copy the localized resources
 grouped in jar compressed files into the host machine, and then will
 register them. We'll see how prepare jar files, the XPI file itself
 and its installation script.</p>

<h4><a name="XPI_jars"></a>Packing the resources in JAR files</h4>
<p>Creating a <i>jar</i> archive from the localized resource files of
 Mozilla, is as easy as compressing a bunch of files grouped into
 folders with a <a href="mlp_tools.html#others">zip compatible utility</a>,
 and then rename the extension of the compressed file from <i>.zip</i>
 to <i>.jar</i>.
 Keep in mind anyway the directory structure will have to match the
 information then used in the installation script.</p>
<p>Here's the directory structure we will use for an our hypothetical
 Italian resource jar, called <tt><b>it-IT.jar</b></tt>:
<table border="0" cellspacing="10" align="center">
<caption><tt><b>it-IT.jar</b></tt> contents.</caption>
<tr><td bgcolor="#CCCCCC">
<pre><font size="-2">/locale/it-IT/<font color="lime">communicator</font>/contentAreaCommands.dtd
                           contentAreaCommands.properties
                           <font color="red">contents.rdf</font>
                           ...
                           /bookmarks/addBookmark.dtd
                                     /bm-props.dtd
                                     /...
                           /directory/...
                           /dom/...
                           /downloadmanager/...
                           /history/...
                           ...
/locale/it-IT/<font color="lime">cookie</font>/<font color="red">contents.rdf</font>
                    /cookie.properties
                    /cookieAcceptDialog.dtd
                    ...
/locale/it-IT/<font color="lime">editor</font>/<font color="red">contents.rdf</font>
                    /EdAdvancedEdit.dtd
                    /EdColorPicker.dtd
                    ...
/locale/it-IT/<font color="lime">...</font></font></pre>
</td></tr></table></p>
<p>We can prepare in a similar way <tt><b>it-mac.jar</b></tt>,
 <tt><b>it-unix.jar</b></tt>, <tt><b>it-win.jar</b></tt> and
 <tt><b>IT.jar</b></tt> localizing the contents of their English
 counterparts.</p>
<p>Remember the regional contents enclosed in the <tt>IT.jar</tt>
 archive, will require a different locale code from the language
 resources. This new locale needs to be properly marked as <i>regional
 locale</i> in the <tt>contets.rdf</tt> files used in these packages.
 In short this means adding the <tt>localeType</tt> property
<dl><dd><tt>chrome:localeType="region"</tt></dd></dl>
 in the regional locale node, along <tt>name</tt>, <tt>author</tt>,
 and the such.</p>
<table border="0">
<tr><td bgcolor="#CCCCCC">
<p><a name="regionlocalecode"></a><b>Note:</b> How to choose the regional
 locale code?<br>
 The main goal is maintain this letter code <i>unique</i>. If the regional
 material you're bundling refers to a nation with a single, official
 language, the only
 <a href="http://www.din.de/gremien/nas/nabd/iso3166ma/codlstp1/en_listp1.html">ISO national code</a>
 can be enough (e.g. "<tt><b>IT</b></tt>" for Italy). If this material
 refers instead to a national region where more than one language is
 commonly spoken, or you're developing for a minority language, a better
 choice can be a <tt><b>reg-ll-NN</b></tt> code, where <tt>ll</tt> and
 <tt>NN</tt> are your language and national
 <a href="mlp_howto.html#registration">ISO codes</a> (e.g.
 <tt>reg-en-CA</tt> and <tt>reg-fr-CA</tt> could be the possible locale
 codes for the English and French regional resources for Canada,
 respectively).
</td></tr></table>
<p></p>

<h4><a name="XPI_script"></a>Preparing the installation script</h4>
<p>This is actually a complex (which doesn't equals to difficult) subject.
 We'll, anyway just provide an already made recipe, and quickly explore
 how things works.</p>
<p>The installation script is a conventional JavaScript text file named
 <tt><b>install.js</b></tt>, put in the root of our XPI package.
 We want this script take the following actions:</p>
<ol>
<li><a name="1"></a>Initialize the installation process.</li>
<li><a name="2"></a>Obtain the application binaries destination folder.</li>
<li><a name="3"></a>Verify the space available in the destination folder
    (different folders can reside on different storage units).</li>
<li><a name="4"></a>If the space available is sufficient, decompress the
    contents of the XPI archive <tt><b>bin/</b></tt> folder in the
    destination folder.</li>
<li><a name="5"></a>Check for possible error conditions, like trying
    to copy into a folder we have not write access to. If the file copy
    has not succeeded, we can try again, obtaining the user profile
    folder, where we hopefully should be able to place our files.</li>
<li><a name="6"></a>When our files are in place, we register every
      single package, from each resource folder or each folder of the
      jar archives copied.
<li><a name="7"></a>We take care of installing only packages relevant
      the user's host platform.</li>
</ol>
<p>Let's see the script code:</p>
<table border="0" cellspacing="5">
<caption><tt><b>install.js</b></tt> XPI installation script.</caption>
<td bgcolor="#CCCCCC"><pre>

  <font color="maroon">// We use this function later to obtain the disk space available</font>
<font color="#444444" size="-1">    function verifyDiskSpace(dirPath, spaceRequired)
    {
      var spaceAvailable;
      // Get the available disk space on the given path
      spaceAvailable = fileGetDiskSpaceAvailable(dirPath);
      // Convert the available disk space into kilobytes
      spaceAvailable = parseInt(spaceAvailable / 1024);
      // do the verification
      if(spaceAvailable < spaceRequired)
      {
        logComment("Insufficient disk space: " + dirPath);
        logComment("  required : " + spaceRequired + " kB");
        logComment("  available: " + spaceAvailable + " kB");
        return(false);
      }
      return(true);
    }</font>

  <font color="maroon">// We use this function later to obtain the user's host platform</font>
<font color="#444444" size="-1">    function getPlatform()
    {
      var platformStr, platformNode;

      if('platform' in Install)
      {
        platformStr = new String(Install.platform);

        if (!platformStr.search(/^Macintosh/))
          platformNode = 'mac';
        else if (!platformStr.search(/^Win/))
          platformNode = 'win';
        else if (!platformStr.search(/^OS\/2/))
          platformNode = 'win';
        else
          platformNode = 'unix';
      }
      else
      {
        var fOSMac  = getFolder("Mac System");
        var fOSWin  = getFolder("Win System");
        logComment("fOSMac: "  + fOSMac);
        logComment("fOSWin: "  + fOSWin);
        if(fOSMac != null)
          platformNode = 'mac';
        else if(fOSWin != null)
          platformNode = 'win';
        else
          platformNode = 'unix';
      }
      return platformNode;
    }</font>


  <font color="maroon" size="+1"><b>// *********** Main ***********</b></font>
  var srDest, err, fProgram;
  
  <font color="maroon">// ----LOCALIZATION NOTE: translate only these ------</font>
  var prettyName       = "<font color="green">Simplified Chinese Language Pack</font>";
  var regName          = "locales/mozilla/<font color="green">zh-CN</font>";
  var localeName       = "<font color="green">zh-CN</font>";
  var regionLocaleName = "<font color="green">CN</font>";
  var PlatforNeutral   = "<font color="green">zh-CN.jar</font>";
  var Regional         = "<font color="green">CN.jar</font>";
  var macJar           = "<font color="green">zhCN-mac.jar</font>";
  var unixJar          = "<font color="green">zhCN-nix.jar</font>";
  var winJar           = "<font color="green">zhCN-win.jar</font>";
  srDest               = <font color="green">123</font>; <font color="maroon">// Required space in kB</font>
  XPIserial            = "<font color="green">5.0.18.2003010521</font>";
  <font color="maroon">// --- END CHANGABLE STUFF ---</font>

<a href="#1"><font color="white">1</font></a> err = initInstall(prettyName, regName, XPIserial); 
  logComment("initInstall: " + err);

<a href="#2"><font color="white">2</font></a> fProgram = getFolder("Program");
  logComment("fProgram: " + fProgram);
  var chromeType = LOCALE|DELAYED_CHROME;

<a href="#3"><font color="white">3</font></a> if(verifyDiskSpace(fProgram, srDest))
  {
    setPackageFolder(fProgram);
<a href="#4"><font color="white">4</font></a>   err = addDirectory("",
                       XPIserial, <font color="maroon">// Installation version string</font>
                       "bin",     <font color="maroon">// dir name in XPI to extract</font>
                       fProgram,  <font color="maroon">// destination folder</font>
                       "",        <font color="maroon">// subdir to create relative to fProgram</font>
                       true);     <font color="maroon">// Force Flag</font>
    logComment("addDirectory() returned: " + err);

<a href="#5"><font color="white">5</font></a>   if (err!=SUCCESS)
    { <font color="maroon">// Can't install globally, try installing to the profile</font>
      resetError();
      fProgram = getFolder("Profile");
      logComment("fProgram: " + fProgram);
      chromeType = LOCALE|PROFILE_CHROME;
      if(verifyDiskSpace(fProgram, srDest))
      {
        setPackageFolder(fProgram);
        err = addDirectory("", XPIserial, "bin", fProgram, "", true);
        logComment("addDirectory() returned: " + err);
      }
      else err = INSUFFICIENT_DISK_SPACE;
    }

    if (err==SUCCESS)   <font color="maroon">// Everything's gone fine, go on</font>
    {
<a href="#6"><font color="white">6</font></a>     <font color="maroon">// Registration of the extracted packages</font>

                           <font color="maroon"><b>// zh-CN.jar</b></font>
      lpath   = "locale/"+localeName+"/";
      jarPath = getFolder (fProgram, "chrome/"+PlatforNeutral);
      registerChrome(chromeType, jarPath, lpath+"<font color="lime">autoconfig/</font>" );
      registerChrome(chromeType, jarPath, lpath+"<font color="lime">communicator/</font>" );
      registerChrome(chromeType, jarPath, lpath+"<font color="lime">contents-pack/</font>" );
      registerChrome(chromeType, jarPath, lpath+"<font color="lime">cookie/</font>" );
      registerChrome(chromeType, jarPath, lpath+"<font color="lime">editor/</font>" );
          <font color="lime">...</font>

<a href="#7"><font color="white">7</font></a>     switch (getPlatform()) {
       case "mac":         <font color="maroon"><b>// zhCN-mac.jar</b></font>
        logComment("Registering Mac packages");
        lpath   = "locale/"+localeName+"/";
        jarPath = getFolder (fProgram, "chrome/"+macJar);
        registerChrome(chromeType, jarPath, lpath+"<font color="lime">communicator-platform/</font>" );
        registerChrome(chromeType, jarPath, lpath+"<font color="lime">global-platform/</font>" );
        registerChrome(chromeType, jarPath, lpath+"<font color="lime">navigator-platform/</font>" );
          <font color="lime">...</font>
        break;

       case "unix":         <font color="maroon"><b>// zhCN-nix.jar</b></font>
        logComment("Registering Unix packages");
        lpath   = "locale/"+localeName+"/";
        jarPath = getFolder (fProgram, "chrome/"+unixJar);
        registerChrome(chromeType, jarPath, lpath+"<font color="lime">communicator-platform/</font>" );
        registerChrome(chromeType, jarPath, lpath+"<font color="lime">global-platform/</font>" );
        registerChrome(chromeType, jarPath, lpath+"<font color="lime">navigator-platform/</font>" );
          <font color="lime">...</font>
        break;

       case "win":         <font color="maroon"><b>// zhCN-win.jar</b></font>
        logComment("Registering Windows packages");
        lpath   = "locale/"+localeName+"/";
        jarPath = getFolder (fProgram, "chrome/"+winJar);
        registerChrome(chromeType, jarPath, lpath+"<font color="lime">communicator-platform/</font>" );
        registerChrome(chromeType, jarPath, lpath+"<font color="lime">global-platform/</font>" );
        registerChrome(chromeType, jarPath, lpath+"<font color="lime">messenger-mapi/</font>" );
        registerChrome(chromeType, jarPath, lpath+"<font color="lime">navigator-platform/</font>" );
          <font color="lime">...</font>
      }

                           <font color="maroon"><b>// CN.jar</b></font>
      lpath   = "locale/"+regionLocaleName+"/";
      jarPath = getFolder (fProgram, "chrome/"+Regional);
      registerChrome(chromeType, jarPath, lpath+"<font color="lime">communicator-region/</font>" );
      registerChrome(chromeType, jarPath, lpath+"<font color="lime">editor-region/</font>" );
      registerChrome(chromeType, jarPath, lpath+"<font color="lime">messenger-region/</font>" );
          <font color="lime">...</font>

      err = performInstall(); 
      logComment("performInstall() returned: " + err);
    }
    else cancelInstall(err);
  }
  else cancelInstall(INSUFFICIENT_DISK_SPACE);
  
  <font color="maroon">// ******** End Main **********</font>

</pre>
</td></tr></table>

<p>Note how the <i>logComment()</i> calls write useful information in
 the <tt>install.log</tt> file, about the progress of the installation.</p>
<p>Being conventional JavaScript code, this installer script can be
 manipulated and modified in almost any thinkable way. The essential
 installation calls you can access are described in deeper details in
 the <a href="http://www.mozilla.org/projects/xpinstall/">XPInstall
 project pages</a>.</p>

<h4><a name="XPI_pack"></a>Putting everything in the XPI package</h4>
<p>Once you have all the needed pieces, you can pack everything in
 a single file, ready to be distributed.</p>
<p>In the out example we'll place our contents inside an empty folder
 with the directory structure shown below. Note that we have registrable
 material in the <tt>chrome/</tt> folder, while the files the
 <tt>defaults/</tt> folder don't require a registration</p>
<p>Then we'll <a href="mlp_tools.html#others">compress</a> everything
 inside our final zip archive. To have this file correctly recognized
 by Mozilla once locally opened in Navigator (to have Navigator prompt
 the user for the installation), we need to change the file extension
 from <tt><b>.zip</b></tt> to <tt><b>.xpi</b></tt>.
<table border="0" cellspacing="10">
<caption>Directory structure for the <tt><b>ChineseLanguagePack.xpi</b></tt> archive.</caption>
<tr><td bgcolor="#CCCCCC">
<pre>/<b>install.js</b>
/bin/chrome/<b>zh-CN.jar</b>
           /<b>zhCN-mac.jar</b>
           /<b>zhCN-nix.jar</b>
           /<b>zhCN-win.jar</b>
           /<b>CN.jar</b>
    /defaults/profile/CN/<b>bookmarks.html</b>
                        /<b>localstore.rdf</b>
                        /<b>mimeTypes.rdf</b>
                        /<b>panels.rdf</b>
                        /<b>search.rdf</b>
                        /chrome/<b>userChrome-example.css</b>
                               /<b>userContent-example.css</b>
</pre>
</td></tr></table></p>
<p>As a final note, let me add XPI packages are extremely convenient
 for on-line installations. One html document with some JavaScript code
 can query the user for the needed components to install, and then start
 the download and the installation phase of multiple xpi package with
 a single call.</p>
<p>All the JavaScript code needed is:</p>
<pre>  xpi = {'Chinese Language Pack': 'http://www.invented.cn/ChineseLanguagePack.xpi',
         'Beautiful skin installation': 'http://foo.bar.com/beautifulSkin.xpi',
         <b>...</b>    };
  InstallTrigger.install(xpi);</pre>
<p>The MIME type for servers offering XPI files is:</p>
<dl><dd><tt><b>application/x-xpinstall</b></tt></dd></dl>



<hr class="hide">
</div>
</div>
<div id="footer">
<ul>
<li><a href="../../sitemap.html">Site Map</a></li>
<li><a href="../../security/">Security Updates</a></li>
<li><a href="../../contact/">Contact Us</a></li>
<li><a href="../../foundation/donate.html">Donate</a></li>
</ul>
<p class="copyright">
Portions of this content are &copy; 1998&#8211;2009 by individual mozilla.org
contributors; content available under a Creative Commons license | <a
href="http://www.mozilla.org/foundation/licensing/website-content.html">Details</a>.</p>
<p>
<span>Last modified August  2,  2006</span>
<span><a href="http://bonsai-www.mozilla.org/cvslog.cgi?file=mozilla-org/html/projects/l10n/mlp_chrome.html&amp;rev=&amp;root=/www/">Document History</a></span>
</p>
</div>
</div>
</body>
</html>
