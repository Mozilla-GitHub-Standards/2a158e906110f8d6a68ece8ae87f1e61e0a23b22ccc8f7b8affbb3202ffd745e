<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="top" title="Home" href="http://www.mozilla.org/">
<link rel="stylesheet" type="text/css" href="../../css/print.css"  media="print">
<link rel="stylesheet" type="text/css" href="../../css/base/content.css"  media="all">
<link rel="stylesheet" type="text/css" href="../../css/cavendish/content.css" title="Cavendish" media="screen">
<link rel="stylesheet" type="text/css" href="../../css/base/template.css"  media="screen">
<link rel="stylesheet" type="text/css" href="../../css/cavendish/template.css" title="Cavendish" media="screen">
<link rel="icon" href="../../images/mozilla-16.png" type="image/png">

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Supporting Indic Scripts in Mozilla</title>
<script src="../../__utm.js" type="text/javascript"></script>
</head>
<body id="www-mozilla-org" class="deepLevel">
<div id="container">
<p class="important">You are currently viewing a snapshot of www.mozilla.org taken on April 21, 2008. Most of this content is
highly out of date (some pages haven't been updated since the project began in 1998) and exists for historical purposes only.  If
there are any pages on this archive site that you think should be added back to www.mozilla.org, please <a
href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=www.mozilla.org">file a bug</a>.</p>
<p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>
<div id="header">
<h1><a href="/" title="Return to home page" accesskey="1">Mozilla</a></h1>
<ul>
<li id="menu_aboutus"><a href="../../about/" title="Getting the most out of your online experience">About</a></li>
<li id="menu_developers"><a href="../../developer/" title="Using Mozilla's products for your own applications">Developers</a></li>
<li id="menu_store"><a href="http://store.mozilla.org/?r=mozorg1" title="Shop for Mozilla products on CD and other merchandise">Store</a></li>
<li id="menu_support"><a href="../../support/" title="Installation, trouble-shooting, and the knowledge base">Support</a></li>
<li id="menu_products"><a href="../../products/" title="All software Mozilla currently offers">Products</a></li>
</ul>
<form id="searchbox_002443141534113389537:ysdmevkkknw" action="http://www.google.com/cse" title="mozilla.org Search">
<div>
<label for="q" title="Search mozilla.org's sites">search mozilla:</label>
<input type="hidden" name="cx" value="002443141534113389537:ysdmevkkknw">
<input type="hidden" name="cof" value="FORID:0">
<input type="text" id="q" name="q" accesskey="s" size="30">
<input type="submit" id="submit" value="Go">
</div>
</form>
</div>
<hr class="hide">
<div id="mBody">
<div id="side">

<ul id="nav">
<li><a title="Roadmap" href="../../roadmap.html"><strong> Roadmap</strong></a></li>
<li><a title="Projects" href="../../projects/"><strong> Projects</strong></a></li>
<li><a title="For developers" href="../../developer/"><strong> Coding</strong></a>
<ul>
<li><a title="Module Owners" href="../../owners.html"> Module Owners</a></li>
<li><a title="Hacking" href="../../hacking/"> Hacking</a></li>
<li><a title="Get the Source" href="http://developer.mozilla.org/en/docs/Download_Mozilla_Source_Code"> Get the Source</a></li>
<li><a title="Building Mozilla" href="http://developer.mozilla.org/en/docs/Build_Documentation"> Build It</a></li>
</ul>
</li>
<li><a title="Testing" href="../../quality/"><strong> Testing</strong></a>
<ul>
<li><a title="Downloads of mozilla.org software releases" href="../../download.html"> Releases</a></li>
<li><a title="Latest mozilla builds for testers" href="../../developer/#builds"> Nightly Builds</a></li>
<li><a title="For testers to report bugs" href="https://bugzilla.mozilla.org/"> Report A Problem</a></li>
</ul>
</li>
<li><a title="Tools for mozilla developers" href="../../tools.html"><strong> Tools</strong></a>
<ul>
<li><a title="Bug tracking system for mozilla testers." href="https://bugzilla.mozilla.org/"> Bugzilla</a></li>
<li><a title="Latest status of mozilla builds" href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=Firefox"> Tinderbox</a></li>
<li><a title="Latest checkins" href="http://bonsai.mozilla.org/cvsqueryform.cgi"> Bonsai</a></li>
<li><a title="Source cross reference" href="http://lxr.mozilla.org/seamonkey/"> LXR</a></li>
</ul>
</li>
<li><a title="Frequently Asked Questions." href="../../faq.html"><strong> FAQs</strong></a></li>
</ul>

</div>
<hr class="hide">
<div id="mainContent">




<p style="text-align: justify;">Revision 1.0, 07/22/2003<br>
Questions &amp; Comments : Please mail <a
 href="mailto:prabhat.hegde@sun.com">Prabhat Hegde</a><br>
</p>
<div> </div>
<h1 style="text-align: center;">Supporting Indic Scripts in Mozilla </h1>
<div style="text-align: justify;"> </div>
<hr width="100%" style="margin-left: 0px; margin-right: 0px;">
<div> </div>
<ul style="text-align: justify;">
  <li><a href="#intro"><strong>Introduction</strong></a>
    <ul>
      <li><a href="#ctl">Complex Text  Script Support (CTL)</a> </li>
      <li><a href="#indicgen">Indic Script Support Issues inMozilla</a></li>
      <li><a href="#designgoals">Design Goals</a><br>
      </li>
      <li><a href="#designapproach">Design Approach</a></li>
      <li><a href="#implementapproach">Implementation Approach<br>
        </a></li>
      <li><a href="#implementdetails">Implementation Details</a></li>
      <li><a href="#ctlstatus">Current Status</a><br>
      </li>
      <li><a href="#ctlbugs">Bugzilla Bugs</a><br>
      </li>
      <li><a href="#ctlopenissues">Open Issues</a></li>
      <li><a href="#ctlrefer">References</a><br>
      </li>
      <li><a href="#ctldownloads">Downloads</a><br>
      </li>
      <ul>
        <li>Solaris9, Solaris 10</li>
        <li>Linux (RedHat 8.x)</li>
        <li>Indic Fonts that cover 8 scripts (sun.unicode.india-0
encoded)<br>
        </li>
      </ul>
      <li><a href="ctlcontacts">Contacts</a><br>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li><span style="font-weight: bold;"></span><br>
    <strong></strong></li>
</ul>
<ul style="text-align: justify;">
</ul>
<div style="text-align: justify;"> </div>
<div> </div>
<hr width="100%" style="margin-left: 0px; margin-right: 0px;">
<div style="text-align: justify;"> <a name="intro"></a> </div>
<h2 style="text-align: justify;">Introduction</h2>
<div style="text-align: justify;"> </div>
<p style="text-align: justify;">This is a two part document which
outlines Indic support in Mozilla. This document pertains to all issues
dealing with non-BiDi CTL support in Mozilla for Unix platforms. Though
the design and implementation is Cross-Platform,  non Unix platforms
have not been considered for implementation.</p>
<div style="text-align: justify;"> </div>
<p style="text-align: justify;"> <a name="ctl"></a> </p>
<h2>Complex Text Script Support (CTL)<br>
</h2>
<div style="text-align: justify;">The presentation of Indian Language
scripts requires contextual processing for display and editing. This
output technology is called Complex Text Layout (CTL).  CTL features
enables the providers (such as OS/X-Windows/CDE-Motif, Gnome/Gtk/Pango
based applications, or Cross-platform applications such as Mozilla or
Star/OpenOffice) to support writing systems that require a complex set
of transformations between logical (as in stored-text) and
physical/Visual (as in display or printed) text-data representations.
Additionally, CTL support  also defines the behaviour of character
combinations and shaping,  Text edit operations and if needed,
Component orientation.<br>
<br>
Mozilla's non-Bidi CTL support currently provides for:<br>
</div>
<ol style="text-align: justify;">
  <li>Context Sensitive Shaping and Rendering on Unix platforms using 
non-intelligent (non-OT) fonts encoded in "sun.unicode.india-0"
encoding. A set of free fonts in this encoding is available for
download at:<br>
    <a href="http://developer.sun.com/techtopics/global/index.html">http://developer.sun.com/techtopics/global/index.html</a><br>
  </li>
  <li>Support for edit operations including Cursor positioning and
Selection.</li>
  <li>Printing through Xprint.</li>
  <li>Features 1-3 above are available for Core-X and XFT2 backends.</li>
  <li>Currently  Hindi and Tamil (TISCII) support is available but its
fairly easy to extend support for other Indic scripts using the same
architecture.<br>
  </li>
</ol>
<div style="text-align: justify;">Future enhancements will be to
provide the same featureset but by using OpenType fonts which is the
future roadmap for fonts for Indic scripts.<br>
<br>
Mozilla also supports BiDi CTL more information for which is available
at: <a href="http://www.langbox.com/bidimozilla">http://www.langbox.com/bidimozilla</a><br>
</div>
<div style="text-align: justify;"> </div>
<div style="text-align: justify;"> </div>
<p style="text-align: justify;"> <a name="indicgen"></a> </p>
<h2>Indic Script Support Issues in the Browser (*nix only)</h2>
<div style="text-align: justify;"> </div>
<p style="text-align: justify;">Input  Method support in Mozilla is
handled by the underlying platform. This leaves the following issues:<br>
</p>
<ol>
  <li>Output/Rendering support which includes:<br>
    <ol>
      <li>Font Handling</li>
      <li>Printing<br>
      </li>
      <li>CTL Issues that cover:</li>
    </ol>
    <ul style="margin-left: 40px;">
      <li>Character-Clustering</li>
      <li>Context-Sensitive Shaping</li>
      <li>Joining</li>
      <li>Split Glyphs</li>
      <li>Character-Reordering<br>
      </li>
      <li>Edit Operations</li>
    </ul>
  </li>
  <li>Data Exchange including handling ISCII-91 data and Mail</li>
</ol>
<p style="text-align: justify;">Font Handling is an issue for Indic
scripts due to lack of font  (repotoire, layout and encoding)
standardization as well as a uniform typographic framework across
Windows, Unix and Unix variants. Similarly '2' above is an issue since
ISCII-91 or its variants are not registered MIME-Charsets under IANA.
However, lack of Localized applications and legacy data that comes with
it means that this is less of an issue.<br>
</p>
<p style="text-align: justify;"> <a name="designgoals"></a> </p>
<h2 style="text-align: justify;">Design goals for Indic Support in
Mozilla (*nix Only)</h2>
<div style="text-align: justify;"> The original design &amp;
implementation goals were : <br>
</div>
<ol style="text-align: justify;">
  <li>Provide non-Bidi CTL script support for languages such as Thai
and HIndi for Core-X11 fonts. on *nix platforms.</li>
  <li>Do not regress existing builds.</li>
  <li>Leverage existing code</li>
  <li>Provide pluggable interfaces to support additional scripts.</li>
  <li>Localize code-changes as much as possible.</li>
</ol>
<p style="text-align: justify;"> </p>
<p style="text-align: justify;"> <a name="designapproach"></a> </p>
<div style="text-align: justify;"> </div>
<h2 style="text-align: justify;">Design approach </h2>
The design approach to solving Indic-CTL script issues are fairly
localized since it has less effects on layout compared to Bidi-CTL
scripts. The approach followed involves:<br>
<ol style="text-align: justify;">
  <li>In <span style="font-weight: bold;">I18n</span><span
 style="font-weight: bold;">(Encoder)</span> layer<br>
    <ul>
      <li>Identify groups of input character that form a logic
chararacter.</li>
      <li>Convert ISCII&lt;-&gt;Unicode UCS-2 for ISCII support.</li>
    </ul>
  </li>
  <li>In <span style="font-weight: bold;">Layout</span> layer<br>
    <ul>
      <li>Identify Cluster-Boundaries, ie. groups of Unicode chars that
form a logical unit of display. </li>
      <li>During painting/measuring/sizing text do not split chars
without losing Cluster-Boundary information.</li>
      <li>While performing edit-operations such as cursor positioning,
do not lose Cluster-Boundary information, ie. do not split by chars.<br>
      </li>
    </ul>
  </li>
  <li>In <span style="font-weight: bold;">Graphic(gfx) </span>layer<br>
    <ul>
      <li>Identify Cluster-Boundaries, ie. groups of Unicode chars that
form a logical unit of display.</li>
      <li>Always perform a glyph-generation/context-sensitive shaping
operation before performing a measuring/drawing operation.</li>
      <li>Perform glyph generation.<br>
      </li>
    </ul>
  </li>
</ol>
<div style="text-align: justify;"><a name="implementapproach"></a> </div>
<h2 style="text-align: justify;">Implementation approach</h2>
The design goals described above mapped to the following implementation
approach. <br>
<ol style="text-align: justify;">
  <li>Provide a compile time switch to enable Indic builds which would
not need to be turned on by default.</li>
  <li>Leverage Core-X11 shaper(s) API from pango (www.pango.org) since
it is simple and cross-platform in nature. </li>
  <li>Leverage nsIUnicodeEncoder  &amp; gfx.<br>
  </li>
  <li>Create a light-weight CTL API to handle Clustering used for Edit
operations. </li>
  <li>Use of pango.modules to additional scripts.</li>
  <li>Support not more than 2 non-OT fonts<br>
  </li>
</ol>
<div style="text-align: justify;">In addition <a
 href="mailto:Jungshik@mailmaps.org">Jungshik Shin</a> re-used the
shapers to extend CTL functionality to XFT backend.<br>
<br>
The implementation approaches in the font layer will vary depending on
whether the support needs to be extended to OpenType fonts. My
recommendation for supporting OpenType fonts is to re-use the
light-weight API's created for the original implementation while using
a combination of  ICU + Mozilla XFT2 for the same. The effort involved
in doing so is fairly trivial since ICU already supports Indic scripts
and ICU layout cab be built separately of the parent ICU. Specifically,
it would involve the following (Minimum set of tasks) in Mozilla:<br>
</div>
<ol style="text-align: justify;">
  <li>Create an ICU-layout XPCOM component.<br>
  </li>
  <li>Access OpenType Tables using (or adding to) Mozilla XFT API.</li>
  <li>Obtain Cluster-Boundary information from OpenType fonts using
ICU+(adding/extending)Mozilla XFT.</li>
  <li>Create additional shapers that use ICU layout for
Glyph-Generation.</li>
  <li>Modify gfx to call the shapers.</li>
</ol>
<div style="text-align: justify;">Code to  accesses the tables in the
font (TrueType/OpenType/...) and rasterize the outlines is already
present in Mozilla-XFT.  Code also exists in Mozilla to move the raster
to the X server.<br>
</div>
<p style="text-align: justify;"> <a name="implementdetails"></a> </p>
<div style="text-align: justify;"> </div>
<h2 style="text-align: justify;">Implementation Details</h2>
Implementation details for Mozilla CTL code that covers Thai and Indic
is as below:<br>
<ol>
  <li>Building:<br>
Use <span style="font-style: italic;">--enable-CTL </span>switch.<br>
    <br>
Safe with Core-X11 and with --enable-default-toolkit=gtk2<br>
    <br>
  </li>
  <li>Complete set of newly created sources<br>
    <a href="http://lxr.mozilla.org/seamonkey/search?string=SUNCTL">Search
LXR using SUNCTL Macro</a><br>
    <br>
  </li>
  <li>External Interfaces<br>
    <span style="font-style: italic;">components/libctl.so</span><br
 style="font-style: italic;">
    <span style="font-style: italic;">pango.modules</span><br
 style="font-style: italic;">
    <span style="font-style: italic;">libmozpango.so</span><br
 style="font-style: italic;">
    <span style="font-style: italic;">libmozpango-thaix.so</span><br
 style="font-style: italic;">
    <span style="font-style: italic;">libmozpango-dvngx.so<br>
.. .. ..<br>
.. .. ..<br>
    </span><br style="font-style: italic;">
  </li>
  <li>Lighweight CTL API<br>
There are additional API that need to be checked in as a part of
bugzilla ID<br>
    <br>
    <a
 href="http://lxr.mozilla.org/seamonkey/source/intl/ctl/src/nsULE.h">http://lxr.mozilla.org/seamonkey/source/intl/ctl/src/nsULE.h<br>
    </a><br>
  </li>
  <li>Adding fonts - Reference the following:<br>
    <a
 href="http://lxr.mozilla.org/seamonkey/source/intl/uconv/src/charsetData.properties#161">http://lxr.mozilla.org/seamonkey/source/intl/uconv/src/charsetData.properties#161</a><br>
    <a
 href="http://lxr.mozilla.org/seamonkey/source/intl/uconv/src/charsetTitles.properties#112">http://lxr.mozilla.org/seamonkey/source/intl/uconv/src/charsetTitles.properties#112</a><br>
    <br>
  </li>
  <li>Creating and adding CTLized Encoders - Reference<br>
    <a
 href="http://lxr.mozilla.org/seamonkey/source/intl/ctl/src/nsUnicodeToSunIndic.cpp">http://lxr.mozilla.org/seamonkey/source/intl/ctl/src/nsUnicodeToSunIndic.cpp</a><br>
    <a
 href="http://lxr.mozilla.org/seamonkey/source/intl/ctl/src/nsUnicodeToThaiTTF.cpp">http://lxr.mozilla.org/seamonkey/source/intl/ctl/src/nsUnicodeToThaiTTF.cpp</a><br>
    <a
 href="http://lxr.mozilla.org/seamonkey/source/intl/ctl/src/nsCtlLEModule.cpp">http://lxr.mozilla.org/seamonkey/source/intl/ctl/src/nsCtlLEModule.cpp</a><br>
    <br>
  </li>
  <li>Creating and addiing CTLized Shapers<br>
    <a
 href="http://lxr.mozilla.org/seamonkey/source/intl/ctl/src/pangoLite/pango.modules">http://lxr.mozilla.org/seamonkey/source/intl/ctl/src/pangoLite/pango.modules</a><br>
    <a
 href="http://lxr.mozilla.org/seamonkey/source/intl/ctl/src/thaiShaper/">http://lxr.mozilla.org/seamonkey/source/intl/ctl/src/thaiShaper/</a><br>
    <a
 href="http://lxr.mozilla.org/seamonkey/source/intl/ctl/src/hindiShaper/">http://lxr.mozilla.org/seamonkey/source/intl/ctl/src/hindiShaper/<br>
    </a><br>
  </li>
  <li>Encoder Changes<br>
None at the moment since encoders in nsCTLLEModule register themselves.<br>
    <br>
  </li>
  <li>Layout Changes<br>
    <div style="text-align: justify;">Interfaces PeekOffset,
GetFocusOffset, GetPointFromOffset, .. etc will be amoung those
affected in order to handle Edit Operations.  All interfaces that deal
with obtaining text buffer offsets from a screen position are expected
to be affected. Currently the changes are localized to <a
 href="http://lxr.mozilla.org/seamonkey/source/layout/html/base/src/nsTextFrame.cpp#102">nsTextFrame.cpp,</a>
-- #ifdef SUNCTL portions but this is expected to spread to more
interfaces inthe following:<br>
    </div>
    <ul>
      <li><a
 href="http://lxr.mozilla.org/seamonkey/source/layout/base/src/nsCaret.cpp">nsCaret.cpp</a></li>
      <li><a
 href="http://lxr.mozilla.org/seamonkey/source/editor/libeditor/html/nsHTMLEditRules.cpp">nsHtmlEditRules.cpp</a></li>
      <li><a
 href="http://lxr.mozilla.org/seamonkey/source/editor/libeditor/text/nsTextEditRules.cpp">nsTextEditRules.cpp</a></li>
      <li><a
 href="http://lxr.mozilla.org/seamonkey/source/content/base/src/nsRange.cpp">nsRange.cpp</a></li>
    </ul>
    <br>
    <br>
  </li>
  <li>Graphics Changes<br>
All entry to drawing and measurement API are expected to be affected.<br>
    <a
 href="http://lxr.mozilla.org/seamonkey/source/gfx/src/gtk/nsFontMetricsGTK.cpp">nsFontMetricsGTK.cpp,</a><br>
    <a
 href="http://lxr.mozilla.org/seamonkey/source/gfx/src/gtk/fontEncoding.properties">fontEncoding.properties</a>
-- XFT Support <br>
    <a
 href="http://lxr.mozilla.org/seamonkey/source/gfx/src/xlib/nsFontMetricsXlib.cpp">nsFontMetricsXlib.cpp</a>
 -- Core X &amp; Xprint<br>
    <br>
  </li>
</ol>
<p style="text-align: justify;"> <a name="ctlstatus"></a> </p>
<h2>Current Status</h2>
<p style="text-align: justify;"> <a name="ctlbugs"></a> </p>
<h2>Bugs</h2>
<p style="text-align: justify;"> <a name="ctlopenissues"></a> </p>
<h2>Open Issues<br>
</h2>
<p style="text-align: justify;"> <a name="ctlrefer"></a> </p>
<h2>References</h2>
<p style="text-align: justify;"> <a name="ctldownloads"></a> </p>
<h2>Downloads</h2>
<p style="text-align: justify;"> <a name="ctlcontacts"></a> </p>
<h2>Contacts<br>
</h2>
<table cellpadding="2" cellspacing="2" border="1"
 style="text-align: left; width: 100%;">
  <tbody>
    <tr>
      <td style="vertical-align: top; font-weight: bold;">Name<br>
      </td>
      <td style="vertical-align: top; font-weight: bold;">Role</td>
      <td style="vertical-align: top; font-weight: bold;">Contact<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Jungshik Shin<br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><a
 href="mailto:jshin@mailaps.org">jshin@mailaps.org</a><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Roland Mainz<br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><a
 href="mailto:roland.mainz@informatik.med.uni-giessen.de">roland.mainz@informatik.med.uni-giessen.de</a><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Prabhat Hegde</td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><a
 href="mailto:samskrita@yahoo.com">samskrita@yahoo.com</a><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">G. Karunakar<br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><a
 href="mailto:karunakar@freedomink.org">karunakar@freedomink.org</a><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<hr width="100%" style="margin-left: 0px; margin-right: 0px;"> <em></em>



<hr class="hide">
</div>
</div>
<div id="footer">
<ul>
<li><a href="../../sitemap.html">Site Map</a></li>
<li><a href="../../security/">Security Updates</a></li>
<li><a href="../../contact/">Contact Us</a></li>
<li><a href="../../foundation/donate.html">Donate</a></li>
</ul>
<p class="copyright">
Portions of this content are &copy; 1998&#8211;2009 by individual mozilla.org
contributors; content available under a Creative Commons license | <a
href="http://www.mozilla.org/foundation/licensing/website-content.html">Details</a>.</p>
<p>
<span>Last modified December 10,  2003</span>
<span><a href="http://bonsai-www.mozilla.org/cvslog.cgi?file=mozilla-org/html/projects/ctl/index.html&amp;rev=&amp;root=/www/">Document History</a></span>
</p>
</div>
</div>
</body>
</html>
