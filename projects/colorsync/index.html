<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<link rel="top" title="Home" href="http://www.mozilla.org/">
<link rel="stylesheet" type="text/css" href="../../css/print.css"  media="print">
<link rel="stylesheet" type="text/css" href="../../css/base/content.css"  media="all">
<link rel="stylesheet" type="text/css" href="../../css/cavendish/content.css" title="Cavendish" media="screen">
<link rel="stylesheet" type="text/css" href="../../css/base/template.css"  media="screen">
<link rel="stylesheet" type="text/css" href="../../css/cavendish/template.css" title="Cavendish" media="screen">
<link rel="icon" href="../../images/mozilla-16.png" type="image/png">

<meta name="generator" content="HTML Tidy, see www.w3.org">
<title>ColorSync in Mozilla</title>
<script src="../../__utm.js" type="text/javascript"></script>
</head>
<body id="www-mozilla-org" class="deepLevel">
<div id="container">
<p class="important">You are currently viewing a snapshot of www.mozilla.org taken on April 21, 2008. Most of this content is
highly out of date (some pages haven't been updated since the project began in 1998) and exists for historical purposes only.  If
there are any pages on this archive site that you think should be added back to www.mozilla.org, please <a
href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=www.mozilla.org">file a bug</a>.</p>
<p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>
<div id="header">
<h1><a href="/" title="Return to home page" accesskey="1">Mozilla</a></h1>
<ul>
<li id="menu_aboutus"><a href="../../about/" title="Getting the most out of your online experience">About</a></li>
<li id="menu_developers"><a href="../../developer/" title="Using Mozilla's products for your own applications">Developers</a></li>
<li id="menu_store"><a href="http://store.mozilla.org/?r=mozorg1" title="Shop for Mozilla products on CD and other merchandise">Store</a></li>
<li id="menu_support"><a href="../../support/" title="Installation, trouble-shooting, and the knowledge base">Support</a></li>
<li id="menu_products"><a href="../../products/" title="All software Mozilla currently offers">Products</a></li>
</ul>
<form id="searchbox_002443141534113389537:ysdmevkkknw" action="http://www.google.com/cse" title="mozilla.org Search">
<div>
<label for="q" title="Search mozilla.org's sites">search mozilla:</label>
<input type="hidden" name="cx" value="002443141534113389537:ysdmevkkknw">
<input type="hidden" name="cof" value="FORID:0">
<input type="text" id="q" name="q" accesskey="s" size="30">
<input type="submit" id="submit" value="Go">
</div>
</form>
</div>
<hr class="hide">
<div id="mBody">
<div id="side">

<ul id="nav">
<li><a title="Roadmap" href="../../roadmap.html"><strong> Roadmap</strong></a></li>
<li><a title="Projects" href="../../projects/"><strong> Projects</strong></a></li>
<li><a title="For developers" href="../../developer/"><strong> Coding</strong></a>
<ul>
<li><a title="Module Owners" href="../../owners.html"> Module Owners</a></li>
<li><a title="Hacking" href="../../hacking/"> Hacking</a></li>
<li><a title="Get the Source" href="http://developer.mozilla.org/en/docs/Download_Mozilla_Source_Code"> Get the Source</a></li>
<li><a title="Building Mozilla" href="http://developer.mozilla.org/en/docs/Build_Documentation"> Build It</a></li>
</ul>
</li>
<li><a title="Testing" href="../../quality/"><strong> Testing</strong></a>
<ul>
<li><a title="Downloads of mozilla.org software releases" href="../../download.html"> Releases</a></li>
<li><a title="Latest mozilla builds for testers" href="../../developer/#builds"> Nightly Builds</a></li>
<li><a title="For testers to report bugs" href="https://bugzilla.mozilla.org/"> Report A Problem</a></li>
</ul>
</li>
<li><a title="Tools for mozilla developers" href="../../tools.html"><strong> Tools</strong></a>
<ul>
<li><a title="Bug tracking system for mozilla testers." href="https://bugzilla.mozilla.org/"> Bugzilla</a></li>
<li><a title="Latest status of mozilla builds" href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=Firefox"> Tinderbox</a></li>
<li><a title="Latest checkins" href="http://bonsai.mozilla.org/cvsqueryform.cgi"> Bonsai</a></li>
<li><a title="Source cross reference" href="http://lxr.mozilla.org/seamonkey/"> LXR</a></li>
</ul>
</li>
<li><a title="Frequently Asked Questions." href="../../faq.html"><strong> FAQs</strong></a></li>
</ul>

</div>
<hr class="hide">
<div id="mainContent">




<h1>ColorSync in Mozilla<br>
<small>A Project to build Cross-Platform Color Management into the
Mozilla Browser</small></h1>

<p><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=16769">Bugzilla Bug 16769</a></p>

<p>As web publishing and commerce continue to rise in importance,
a way of managing colors from the source to the destination
becomes an essential feature of a browser. Specifically, the
source image that is kept on a web server will look different on
various displays that access it as part of the html stream,
unless something is done to compensate for the various viewing
conditions. ColorSync is an Apple Computer technology that is
widely adopted in the print and graphic arts industries, and it
is designed to perform the necessary tasks of compensation for
different devices. The combination of a browser and ColorSync
means that not only can people visit sites such as art archives
and see what the artist intended, they can order products from
online catalogues and not be surprised with the color when it
arrives in the mail.</p>

<h2>ColorSync Building Blocks &mdash; <acronym title="International Color Consortium">ICC</acronym>
Profiles</h2>

<p>ColorSync relies on device <q>profiles</q> to be able to account
for different device characteristics&mdash;these are files which have
a format specified by the International Color Consortium&mdash;they
contain data for a given device or class of devices.</p>

<p>The following file formats support embedded ICC profiles:</p>

<ul>
<li><acronym title="Tagged Image File Format">TIFF</acronym></li>

<li><acronym title="Joint Photographic Experts Group">JPEG</acronym></li>

<li><acronym title="Graphics Interchange Format">GIF</acronym></li>

<li><span class="initialism" title="Portable Network Graphics">PNG</span></li>

<li>PICT, and possibly more</li>
</ul>

<p>Thus, a browser accepting files in these formats can detect
embedded profiles and use them to match from the source device
colors to the display. Support for this type of matching already
exists in Microsoft Internet Explorer 4.0.1.</p>

<p>In addition, with extensions to the <span class="initialism" title="Hypertext Markup Language">HTML</span> &lt;img&gt; and
&lt;body&gt; tags, profiles can be <em>associated</em> with images
instead of having to be embedded within. Details of the
additional HTML tags and a sample site testing browser use of
images with profiles can be found at <a href=
"http://colorsync.apple.com/">Apple&rsquo;s ColorSync Web site</a>.</p>

<p>The benefits of profile association vs. embedding is that the
profile can be downloaded once and used for multiple images on a
page, or in a session. It also gives web site developers some
flexibility, they don&rsquo;t need to rewrite all their images to embed
profiles, they can make some simple additions to their HTML
instead. GoLive&rsquo;s CyberStudio 3 allows for content developers to
use either profile association or embedding to enable color
management.</p>



<h2>What has been added to
Mozilla</h2>

<p>The new code that has been added implements color management
for images that contain or reference ICC profiles, using
ColorSync. It is <em>not</em> a public release of ColorSync code,
rather it is code that calls ColorSync. ColorSync has been a
component of Mac OS for some time now&mdash;in the future it will run
on other OSes as well. The new code checks for the existence of
ColorSync on the OS, and if so will use its services as the
browser encounters images with ICC profiles. As noted, images can
either contain or reference ICC profiles. Therefore we first had
to add smarts to the image decoders (e.g. JPEG) to look for
embedded profiles. Secondly, we had to add new code to make
requests over the net for ICC profiles referenced by URLs (or
local files). This code keeps track of whether a profile has been
received already and skips the download if so. Finally, code and
user interface elements have been added to turn on/off these new
features via preferences.</p>

<h2>Current status of the
project</h2>

<p>Apple and Mozilla/Netscape engineers discussed many of the
issues involved in adding this functionality, with a rough spec
drafted and revised. The timing was such that if the additions
were to have any chance of being picked up into timely future
versions of the browser, it had to be done quickly&mdash;so as the
opportunities for outside help faded Apple bit the bullet and
started writing code, after further consultations with various
module owners.</p>

<p>Since ColorSync now runs (alpha stage) on more than just the
Mac platform, we decided to place as much of the functionality in
the cross-platform image library as possible, with calls to the
front end being used only as a hedge against our being able to
deploy ColorSync everywhere Mozilla deploys. As the code
currently stands, both the Mac and Win FEs have the same set of
new <span class="initialism" title="definition_TBD">IMGCB</span> entry points, and the code therein is also identical.
The <span class="initialism" title="cross-platform front end">XPFE</span> has stubs for these IMGCB entry points.</p>

<p>Here&rsquo;s what has been done so far:</p>

<ul>
<li>Embedded profile support for JPEG, GIF</li>

<li>&lt;img&hellip; iccprofile=&hellip;&gt; support</li>

<li>&lt;body&hellip; iccprofile=&hellip;&gt; support</li>

<li>Preferences support: {no matching, match if profile, match
to default}</li>

<li>Printing works because the images are matched during decode
time.</li>
</ul>

<p>What&rsquo;s not there yet (for the future?)</p>

<ul>
<li>Color World caching (code there, not tested so turned
off)</li>

<li>Embedded profiles in PNG</li>

<li>Other color management features, like preview</li>
</ul>

<p>Changes were made mostly to the image lib, expanded structs
and new calls to a set of routines in a new file: icc_profile.c.
I also had to change some code in layout, to parse the new &lt;img&gt;
and &lt;body&gt; tags. Finally, in addition to the front end code and
additional IMGCB entry points, we added new &lsquo;ppob&rsquo; resources to
the Mac resource file. This enables the new preferences, code was
added to the image lib to read them.</p>

<h2>What can you do?</h2>

<p>The list above mentions color world caching and profiles in
PNG. The PNG spec for embedded ICC profiles has just been adopted
by the PNG working group. It is available for download at the
following sites:</p>

<ul>
<li><a href=
"http://www.cs.berkeley.edu/~amc/png/">http://www.cs.berkeley.edu/~amc/png/</a></li>

<li><a href=
"http://www.cdrom.com/pub/png">http://www.cdrom.com/pub/png</a></li>
</ul>

<p>For this project, code was added to the JPEG and GIF reader
routines in the imagelib&mdash;similar code would have to be added to
the PNG reader. As far as "color world" caching goes, this is a
similar optimization to image caching (in memory), and it means
keeping around table information built from a set of ICC profiles
with the idea of being able to use the information again. This is
a good idea if the source (input) and destination (output)
profiles are expected to be the same for multiple images&mdash;a
valid assumption in some cases. There is code in the new file
that is designed to implement this, but it is not turned on
yet.</p>

<p>Finally, here is a brief, undetailed list of some other things
that could possibly be done:</p>

<ul>
<li>Profile embedding/association in composer</li>

<li>Figure out how to get AVID (Mac) for MWContext</li>

<li>Print preview with ColorSync</li>

<li>Gamut-check mode</li>

<li>Display list of profiles embedded or assiocated on the
current page (I&rsquo;ll probably have to implement this at some point
just for debugging)</li>
</ul>

<p>If you&rsquo;re interested in helping further ColorSync support in
Mozilla, by all means contact me or others in Mozilla.org.
Thanks.</p>

<p>Eric Broadbent<br>
<a href="mailto:ebb3@apple.com">ebb3@apple.com</a><br>
August 31, 1998</p>


<hr class="hide">
</div>
</div>
<div id="footer">
<ul>
<li><a href="../../sitemap.html">Site Map</a></li>
<li><a href="../../security/">Security Updates</a></li>
<li><a href="../../contact/">Contact Us</a></li>
<li><a href="../../foundation/donate.html">Donate</a></li>
</ul>
<p class="copyright">
Portions of this content are &copy; 1998&#8211;2009 by individual mozilla.org
contributors; content available under a Creative Commons license | <a
href="http://www.mozilla.org/foundation/licensing/website-content.html">Details</a>.</p>
<p>
<span>Last modified May 20,  2005</span>
<span><a href="http://bonsai-www.mozilla.org/cvslog.cgi?file=mozilla-org/html/projects/colorsync/index.html&amp;rev=&amp;root=/www/">Document History</a></span>
</p>
</div>
</div>
</body>
</html>
