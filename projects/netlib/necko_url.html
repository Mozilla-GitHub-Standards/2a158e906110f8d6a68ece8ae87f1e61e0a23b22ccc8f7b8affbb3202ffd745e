<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="top" title="Home" href="http://www.mozilla.org/">
<link rel="stylesheet" type="text/css" href="../../css/print.css"  media="print">
<link rel="stylesheet" type="text/css" href="../../css/base/content.css"  media="all">
<link rel="stylesheet" type="text/css" href="../../css/cavendish/content.css" title="Cavendish" media="screen">
<link rel="stylesheet" type="text/css" href="../../css/base/template.css"  media="screen">
<link rel="stylesheet" type="text/css" href="../../css/cavendish/template.css" title="Cavendish" media="screen">
<link rel="icon" href="../../images/mozilla-16.png" type="image/png">

<title>URIs and URLs</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="necko.css">
<script src="../../__utm.js" type="text/javascript"></script>
</head>
<body id="www-mozilla-org" class="deepLevel">
<div id="container">
<p class="important">You are currently viewing a snapshot of www.mozilla.org taken on April 21, 2008. Most of this content is
highly out of date (some pages haven't been updated since the project began in 1998) and exists for historical purposes only.  If
there are any pages on this archive site that you think should be added back to www.mozilla.org, please <a
href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=www.mozilla.org">file a bug</a>.</p>
<p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>
<div id="header">
<h1><a href="/" title="Return to home page" accesskey="1">Mozilla</a></h1>
<ul>
<li id="menu_aboutus"><a href="../../about/" title="Getting the most out of your online experience">About</a></li>
<li id="menu_developers"><a href="../../developer/" title="Using Mozilla's products for your own applications">Developers</a></li>
<li id="menu_store"><a href="http://store.mozilla.org/?r=mozorg1" title="Shop for Mozilla products on CD and other merchandise">Store</a></li>
<li id="menu_support"><a href="../../support/" title="Installation, trouble-shooting, and the knowledge base">Support</a></li>
<li id="menu_products"><a href="../../products/" title="All software Mozilla currently offers">Products</a></li>
</ul>
<form id="searchbox_002443141534113389537:ysdmevkkknw" action="http://www.google.com/cse" title="mozilla.org Search">
<div>
<label for="q" title="Search mozilla.org's sites">search mozilla:</label>
<input type="hidden" name="cx" value="002443141534113389537:ysdmevkkknw">
<input type="hidden" name="cof" value="FORID:0">
<input type="text" id="q" name="q" accesskey="s" size="30">
<input type="submit" id="submit" value="Go">
</div>
</form>
</div>
<hr class="hide">
<div id="mBody">
<div id="side">

<ul id="nav">
<li><a title="Roadmap" href="../../roadmap.html"><strong> Roadmap</strong></a></li>
<li><a title="Projects" href="../../projects/"><strong> Projects</strong></a></li>
<li><a title="For developers" href="../../developer/"><strong> Coding</strong></a>
<ul>
<li><a title="Module Owners" href="../../owners.html"> Module Owners</a></li>
<li><a title="Hacking" href="../../hacking/"> Hacking</a></li>
<li><a title="Get the Source" href="http://developer.mozilla.org/en/docs/Download_Mozilla_Source_Code"> Get the Source</a></li>
<li><a title="Building Mozilla" href="http://developer.mozilla.org/en/docs/Build_Documentation"> Build It</a></li>
</ul>
</li>
<li><a title="Testing" href="../../quality/"><strong> Testing</strong></a>
<ul>
<li><a title="Downloads of mozilla.org software releases" href="../../download.html"> Releases</a></li>
<li><a title="Latest mozilla builds for testers" href="../../developer/#builds"> Nightly Builds</a></li>
<li><a title="For testers to report bugs" href="https://bugzilla.mozilla.org/"> Report A Problem</a></li>
</ul>
</li>
<li><a title="Tools for mozilla developers" href="../../tools.html"><strong> Tools</strong></a>
<ul>
<li><a title="Bug tracking system for mozilla testers." href="https://bugzilla.mozilla.org/"> Bugzilla</a></li>
<li><a title="Latest status of mozilla builds" href="http://tinderbox.mozilla.org/showbuilds.cgi?tree=Firefox"> Tinderbox</a></li>
<li><a title="Latest checkins" href="http://bonsai.mozilla.org/cvsqueryform.cgi"> Bonsai</a></li>
<li><a title="Source cross reference" href="http://lxr.mozilla.org/seamonkey/"> LXR</a></li>
</ul>
</li>
<li><a title="Frequently Asked Questions." href="../../faq.html"><strong> FAQs</strong></a></li>
</ul>

</div>
<hr class="hide">
<div id="mainContent">







<div align="center"><font size="+2"><b>URIs and URLs</b></font><br>
<i>Andreas Otte &lt;andreas.otte@debitel.net&gt;<br>January 1, 2002<br></i>
</div>

<h3>Overview</h3>

<blockquote>
Handling network and locally retrievable resources is a central part of
Necko. Resources are identified by URI "Uniform Resource Identifier"
[Taken from <a
href="http://sunsite.cnlab-switch.ch/ftp/doc/standard/rfc/23xx/2396">RFC
2396</a>]:

<blockquote>
<dl>
<dt>Uniform<dd>
<p>Uniformity provides several benefits: it allows different types
of resource identifiers to be used in the same context, even
when the mechanisms used to access those resources may differ;
it allows uniform semantic interpretation of common syntactic
conventions across different types of resource identifiers; it
allows introduction of new types of resource identifiers
without interfering with the way that existing identifiers are
used; and, it allows the identifiers to be reused in many
different contexts, thus permitting new applications or
protocols to leverage a pre-existing, large, and widely-used
set of resource identifiers.</p>
<dt>Resource<dd>
<p>A resource can be anything that has identity.  Familiar
examples include an electronic document, an image, a service
(e.g., "today's weather report for Los Angeles"), and a
collection of other resources.  Not all resources are network
"retrievable"; e.g., human beings, corporations, and bound
books in a library can also be considered resources.
The resource is the conceptual mapping to an entity or set of
entities, not necessarily the entity which corresponds to that
mapping at any particular instance in time.  Thus, a resource
can remain constant even when its content---the entities to
which it currently corresponds---changes over time, provided
that the conceptual mapping is not changed in the process.</p>
<dt>Identifier<dd>
<p>An identifier is an object that can act as a reference to
something that has identity.  In the case of URI, the object is
a sequence of characters with a restricted syntax.</p>
</dl>
<p>A URI can be further classified as a locator, a name, or both.  The
term "Uniform Resource Locator" (URL) refers to the subset of URI
that identify resources via a representation of their primary access
mechanism (e.g., their network "location"), rather than identifying
the resource by name or by some other attribute(s) of that
resource.</p>

<p>...</p>

<p>The URI scheme defines the namespace of the URI, and
thus may further restrict the syntax and semantics of identifiers
using that scheme. Although many URL schemes are named after
protocols, this does not imply that the only way to access the URL's
resource is via the named protocol.  Gateways, proxies, caches, and
name resolution services might be used to access some resources,
independent of the protocol of their origin, and the resolution of
some URL may require the use of more than one protocol (e.g., both DNS
and HTTP are typically used to access an "http" URL's resource when it
can't be found in a local cache).</p>
</blockquote>

<p>In Necko every URI scheme is represented by a protocol
handler. Sometimes a protocol handler represents more than one 
scheme. The protocol handler provides scheme specific information and
methods to create new URIs of the schemes it supports. One of the main
Necko goals is to provide a "plug able" protocol support. This means
that it should be possible to add new protocols to Necko just by
implementing <a
href="http://lxr.mozilla.org/seamonkey/source/netwerk/base/public/nsIProtocolHandler.idl">nsIProtocolHandler</a>
and <a
href="http://lxr.mozilla.org/seamonkey/source/netwerk/base/public/nsIChannel.idl">nsIChannel</a>.
It also might be necessary to implement a new urlparser for a new
protocol but that might not be necessary because Necko already
provides URI implementations that can deal with a number of schemes, 
by implementing the generic urlparser defined in RFC 2396.</p>
</blockquote>

<h3>nsIURI and nsIURL</h3>

<blockquote>
<p>In a strict sense Necko does only know URLs, URIs by the above
definition are much to generic to be properly represented inside a library.</p>

<p>There are however two interfaces which loosely relate to the distinction
between URI and URL as per the above definition: <a
href="http://lxr.mozilla.org/seamonkey/source/netwerk/base/public/nsIURI.idl">nsIURI</a>
and <a
href="http://lxr.mozilla.org/seamonkey/source/netwerk/base/public/nsIURL.idl">nsIURL</a>.</p>

<p>nsIURI represents access to a very simple, very generic form of an
URL. Simply speaking it's scheme and non-scheme, separated by a
colon, like "about". nsIURL inherits from nsIURI and represents access
to typical URLs with schemes like "http", "ftp", ...
</blockquote>

<h4>nsSimpleURI</h4>

<blockquote>
<p>One implementation of nsIURI is <a
href="http://lxr.mozilla.org/seamonkey/source/netwerk/base/src/nsSimpleURI.h">nsSimpleURI</a>
which is the basis for protocols like "about". nsSimpleURI contains
setters and getters for the URI and the components of an URI: scheme
and path (non-scheme). There are no pre written urlparsers for simple
URIs, because of it's simple structure.</p>
</blockquote>

<h4>nsStandardURL</h4>

<blockquote>
<p>The most important implementation of nsIURL is <a
href="http://lxr.mozilla.org/seamonkey/source/netwerk/base/src/nsStandardURL.h">nsStandardURL</a> which is the basis for protocols like http, ftp, ...</p>

<p>These schemes support a hierarchical naming system, where the
hierarchy of the name is denoted by a "/" delimiter separating the
components in the path. nsStandardURL also contains the facilities to
parse these typ of urls, to break the specification of the URL "spec" 
down into the most basic segments.</p>  
 
<p>The spec consists of prepath and path. The prepath consists of
scheme and authority. The authority consists of prehost, host and
port. The prehost consists of username and password. The path consists
of directory, filename, param, query and ref. The filename consists of
filebasename and fileextension.<p> 

<p>If the spec is completly broken down, it consists of: scheme,
username, password, host, port, directory, filebasename,
fileextension, param, query and ref. Together these segments form
the URL spec with the following syntax:</p>

<p><font size="-1">scheme://username:password@host:port/directory/filebasename.fileextension;param?query#ref</font></p> 

<p>For performance reasons the complete spec is stored in <a
href="#esc">escaped</a> form in the nsStandardURL object with pointers
(position and length) to each basic segment and for the more global
segments like path and prehost for example.</p> 

<p>Necko provides pre written urlparsers for schemes based on
hierachical naming systems.</p> 
</blockquote>

<h3><a name="esc">Escaping</a></h3>

<blockquote>
<p>To be able to parse an URL safely it is sometimes necessary to
"escape" certain characters, to hide them from the parser. An escaped 
character is encoded as a character triplet, consisting of the
percent character "%" followed by the two hexadecimal digits
representing the octet code. For example, "%20" is the escaped
encoding for the US-ASCII space character.</p>

<p>Another quote from RFC 2396:</p>

<blockquote>
A URI is always in an "escaped" form, since escaping or unescaping a
completed URI might change its semantics.  Normally, the only time
escape encodings can safely be made is when the URI is being created
from its component parts; each component may have its own set of
characters that are reserved, so only the mechanism responsible for
generating or interpreting that component can determine whether or
not escaping a character will change its semantics. Likewise, a URI
must be separated into its components before the escaped characters
within those components can be safely decoded.
</blockquote>

<p>This implies that the segments of urls are escaped differently. This
is done by <a href="http://lxr.mozilla.org/seamonkey/source/xpcom/io/nsEscape.cpp#368">NS_EscapeURL</a> which is now part of xpcom, but started as part
of Necko. The information how to escape each segment is stored in a
matrix.</p>

<p>Also a string should not be escaped more than once. Necko will
not escape an already escaped character unless forced by a special
mask that can be used if it is known that a string is not escaped.</p>
</blockquote>

<h3>Parsing URLs</h3>

<blockquote>
<p>RFC 2396 defines an URL parser that can deal with the syntax that is
common to most URL schemes that are currently in existence.</p>

<p>Sometimes scheme specific parsing is required. Also to be somewhat
tolerant to syntax errors the parser has to know more about
the specific syntax of the URLs for that scheme. To stay almost
generic Necko contains three parsers for the main classes of standard
URLs. Which one has to be used is defined by the implementation of 
nsIProtocolhandler for the scheme in question.</p>

<p>The three main classes are:</p>
<dl>
<dt>Authority<dd><p>The URLs have an authority segment, like "http".</p>
<dt>NoAuthority<dd><p>These URLs have no or a degenerated authority
segment, like the "file" scheme. Also this parser can identify drives
if possible depending on the platform.</p>
<dt>Standard<dd><p>It is not known if an authority segment exists
or not, less syntax correction can be applied in this case.</p>
</dl>

</blockquote>

<h4>Noteable Differences</h4>

<blockquote>
<ol><li>Necko does not support certain deprecated forms of relative
URLs,  based on the following part of RFC 2396:
 
<blockquote>
<p>If the scheme component is defined, indicating that the reference
starts with a scheme name, then the reference is interpreted as an
absolute URI and we are done.  Otherwise, the reference URI's
scheme is inherited from the base URI's scheme component.</p>

<p>Due to a loophole in prior specifications [RFC1630], some parsers
allow the scheme name to be present in a relative URI if it is the
same as the base URI scheme.  Unfortunately, this can conflict
with the correct parsing of non-hierarchical URI.  For backwards
compatibility, an implementation may work around such references
by removing the scheme if it matches that of the base URI and the
scheme is known to always use the "hier_part" syntax.  The parser
can then continue with the steps below for the remainder of the
reference components.  Validating parsers should mark such a
misformed relative reference as an error.</p>
</blockquote>

<p>The decision was made against backwards compatibility. This means that
URLs like "http:page.html" or "http:/directory/page.html" are
interpreted as absolute urls and "corrected" by the parser.<p>

<li>Also the handling of query segments is different from the
examples given in RFC 2396:

<blockquote>

<p>Within an object with a well-defined base URI of</p>

<p>http://a/b/c/d;p?q</p>

<p>the relative URI would be resolved as follows:</p>

<p>...</p>
<p>?y = http://a/b/c/?y</p>
<p>...</p>

</blockquote>

<p>Instead</p>

<p>?y = http://a/b/c/d;p?y</p>

<p>was implemented as suggested by the older <a href="http://sunsite.cnlab-switch.ch/ftp/doc/standard/rfc/18xx/1808">RFC 1808</a>. This decision is based on
an email by Roy T. Fielding, one of the authors of RFC 2396, stating that the
given example is wrong. Details can be found at <a
href="http://bugzilla.mozilla.org/show_bug.cgi?id=90439">bug
90439</a>.  

<li>Registry-based authoritys
<p>Currently Necko's url-objects only support host based authoritys or
urls with no authoritys. Registry-based authoritys as defined in RFC 2396</p> 

<blockquote>
<p>Many URI schemes include a top hierarchical element for a naming
authority, such that the namespace defined by the remainder of the
URI is governed by that authority. This authority component is
typically defined by an Internet-based server or a scheme-specific
registry of naming authorities.</p>

<p>...</p>

<p>The structure of a registry-based naming authority is specific to the
URI scheme, but constrained to the allowed characters for an
authority component.</p>
</blockquote>

<p>are not supported.</p>

</ol>

</blockquote>

<h3>References</h3>
<blockquote>
Main reference for URIs, URLs and URL-parsing is <a
href="http://sunsite.cnlab-switch.ch/ftp/doc/standard/rfc/23xx/2396">RFC
2396</a>.
</blockquote>





<hr class="hide">
</div>
</div>
<div id="footer">
<ul>
<li><a href="../../sitemap.html">Site Map</a></li>
<li><a href="../../security/">Security Updates</a></li>
<li><a href="../../contact/">Contact Us</a></li>
<li><a href="../../foundation/donate.html">Donate</a></li>
</ul>
<p class="copyright">
Portions of this content are &copy; 1998&#8211;2009 by individual mozilla.org
contributors; content available under a Creative Commons license | <a
href="http://www.mozilla.org/foundation/licensing/website-content.html">Details</a>.</p>
<p>
<span>Last modified January  2,  2002</span>
<span><a href="http://bonsai-www.mozilla.org/cvslog.cgi?file=mozilla-org/html/projects/netlib/necko_url.html&amp;rev=&amp;root=/www/">Document History</a></span>
</p>
</div>
</div>
</body>
</html>
