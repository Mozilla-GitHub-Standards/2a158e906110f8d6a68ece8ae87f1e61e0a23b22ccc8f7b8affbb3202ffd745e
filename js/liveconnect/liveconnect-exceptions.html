<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
    <title>LiveConnect Exceptions</title>
  </head>

  <body bgcolor="#FFFFFF" 
    text="#000000" 
    link="#0000EE" 
    vlink="#551A8B" 
    alink="#FF0000">    

    <p align="LEFT"><b><font size="+3">LiveConnect Exceptions</font><br>
	by Chris Cooper 
	&lt<A HREF="mailto:ccooper@neon.polkaroo.net">ccooper@neon.polkaroo.net</A>&gt;</b><br>
      Last modified: Wed Dec  9  15:00:16 EST 1998      
</p>

    <p>LiveConnect enables communication between JavaScript and Java applets 
      in a page and between JavaScript and plug-ins loaded on a page. However,
      until now, Java and JavaScript were unable to catch exceptions 
      generated by the other language. The implementation of LiveConnect 
      exception handling now makes graceful error recovery between the two 
      languages possible.</p>

    <p><b>Get there quick:</b>
    <ul>
      <li><a href="#jsexception">Catching JavaScript exceptions</a></li>
      <li><a href="#jexception">Catching Java exceptions in JavaScript</a></li>
      <li><a href="#jsjexception">Catching JavaScript exceptions thrown through Java in JavaScript</a></li>
      <li><a href="#examples">Examples</a><ul>
	  <li><a href="#troubleshooting">Troubleshooting</a></li>
	</ul>
      </li>
    </ul>
  </p>

    <hr size="5" width="90%">

    <p><b><font size="+1"><a name="jsexception">Catching JavaScript exceptions</a></font></b></p>
    <p><dl>
      <dd>Let's start with the most basic example. JavaScript exceptions can be thrown using the <code>throw</code> keyword, 
	and caught using a <code>try / catch</code> block.</p>
      <p><dd>eg. the following example JavaScript code...</p>
	<p><code><pre>try {
	throw 'Thrown JS exception';
} catch (e) {
        print("Exception caught: " + e.toString());
}
        </pre></code></p>
	<p><dd>...would catch something like this:</p>
	<p><dd><code>Exception caught: Thrown JS exception</code></p>
	<p><dd>Any JS type (string, number, boolean, Object, undefined, null) can be thrown as an exception. 
	<a href="#examples">More examples</a> of this are listed below</p>
    </dl>

    <hr size="5" width="90%">

    <p><b><font size="+1"><a name="jexception">Catching Java exceptions in JavaScript</a></font></b></p>
    <p><dl>
      <dd>Java exceptions are thrown back into JavaScript when a line of 
	JavaScript code tries to access a Java member variable or method
	and fails.</p>
	<p><dd>eg. the following example JavaScript code...</p>
	<p><code><pre>try {
        java.lang.Class.forName("blah");
} catch (e) {
        print("Java Exception caught: " + e);
}
        </pre></code></p>
	<p><dd>...would catch something like this:</p>
	<p><dd><code>Java Exception caught: java.lang.ClassNotFoundException: 
blah</code></p>
    </dl>

    <hr size="5" width="90%">

    <p><b><font size="+1"><a name="jsjexception">Catching JavaScript exceptions thrown through Java in JavaScript</a></font></b></p>
    <p><dl>
      <dd>Imagine this scenario: A line of JavaScript makes a call into Java. While in Java land, this code makes a call back into 
	JavaScript where it triggers an exception. LiveConnect propagates this exception back through Java to the original JavaScript 
	layer where it can be caught. 	
	<p><dd>eg. the following example JavaScript code...</p>
	<p><code><pre>try {
	Packages.Test.doit(this, "throw 'foo';");
} catch (e) {
        print("Exception caught: " + e.toString());
}
        </pre></code></p>
	<p><dd>...would first call into Java and attempt to evaluate the JavaScript code in the second argument 
	(see <a href="#Test.java">the listing for Test.java</a> below for the internals).
	If successful, it would catch something like this:</p>
	<p><dd><code>Exception caught: foo</code></p> 	
	<p>Just like the simple JavaScript exceptions above, any JS type (string, number, boolean, Object, undefined, null) can be 
	  throw across the two languages and the type information will be preserved. 
	  <a href="#examples">More examples</a> of this are listed below</p>	
    </dl></p>

    <hr size="5" width="90%">

    <p><b><font size="+1"><a name="examples">Examples</a></font></b></p>
    <p><dl>
      <dd>The following two files can be used to test the various features 
	of LiveConnect exception handling.</p>
	<p><dd><b>Download:</b> (Use RightClick-"Save Link As...")</p>
	<p><dl>
	  <dd><a href="./test.js">test.js</a>
	  <dd><a href="./Test.java">Test.java</a></p>
	</dl></p>
	<p><dd>Below is a listing of both files, followed by a listing of
	the output generated when the files are run through the LiveConnect
	engine (jsj or jsj.exe).
    </dl></p>

    <p><table width="300" 
	border="1" 
	cellpadding="5" 
	cellspacing="5" 
	rows="4" 
	cols="1">
	<tr bgcolor="#BCC0D3">
	  <td>
	    <strong><a name="test.js">test.js</a></strong>
	  </td>
	</tr>
	<tr>
	  <td>
	    <code><pre>
print("Throwing JS Exception");
try {
	throw 'Thrown JS exception';
	print("\tNo exception caught\n");	
} catch (e) {
        print("\tException caught: " + e.toString());
	print("\tJS Type of exception: " + typeof e + "\n");
}

print("Triggering Java ClassNotFoundException");
try {
        str = java.lang.Class.forName("blah");
	print("\tNo exception caught: " + str + "\n");
} catch (e) {
        print("\tException caught: " + e.toString());
	print("\tJS Type of exception: " + typeof e + "\n");
}

print("Throwing string: Packages.Test.doit(this, throw 'foo';)");
try {
	str = Packages.Test.doit(this, "throw 'foo';");
	print("\tNo exception caught: " + str + "\n");
} catch ( e ) {
	print("\tException caught: " + e.toString());
	print("\tJS Type of exception: " + typeof e + "\n");
}

print("Throwing number: Packages.Test.doit(this, throw 42;)");
try {
	str = Packages.Test.doit(this, "throw 42;");
	print("\tNo exception caught: " + str + "\n");
} catch ( e ) {
	print("\tException caught: " + e.toString());
	print("\tJS Type of exception: " + typeof e + "\n");
}

print("Throwing number: Packages.Test.doit(this, throw 4.2;)");
try {
	str = Packages.Test.doit(this, "throw 4.2;");
	print("\tNo exception caught: " + str + "\n");
} catch ( e ) {
	print("\tException caught: " + e.toString());
	print("\tJS Type of exception: " + typeof e + "\n");
}

print("Throwing boolean: Packages.Test.doit(this, throw false;)");
try {
	str = Packages.Test.doit(this, "throw false;");
	print("\tNo exception caught: " + str + "\n");
} catch ( e ) {
	print("\tException caught: " + e.toString());
	print("\tJS Type of exception: " + typeof e + "\n");
}

print("Throwing Object (new Date): Packages.Test.doit(this, throw new Date();)");
try {
	str = Packages.Test.doit(this, "throw new Date();");
	print("\tNo exception caught: " + str + "\n");
} catch ( e ) {
	print("\tException caught: " + e.toString());
	print("\tJS Type of exception: " + typeof e + "\n");
}

print("Throwing Object (new String): Packages.Test.doit(this, throw new String();)");
try {
	str = Packages.Test.doit(this, "throw new String();");
	print("\tNo exception caught: " + str + "\n");
} catch ( e ) {
	print("\tException caught: " + e.toString());
	print("\tJS Type of exception: " + typeof e + "\n");
}

print("Throwing Object ({a:42}): Packages.Test.doit(this, throw {a:42};)");
try {
	str = Packages.Test.doit(this, "throw {a:42};");
	print("\tNo exception caught: " + str + "\n");
} catch ( e ) {
	print("\tException caught: " + e.toString());
	print("\tJS Type of exception: " + typeof e + "\n");
}

print("Throwing undefined: Packages.Test.doit(this, throw undefined)");
try {
        str = Packages.Test.doit(this, "throw undefined;");
        print("\tNo exception caught: " + str + "\n");
} catch ( e ) {
        print("\tException caught.");
        print("\tJS Type of exception: " + typeof e + "\n");
}

print("Throwing null: Packages.Test.doit(this, throw null)");
try {
        str = Packages.Test.doit(this, "throw null;");
        print("\tNo exception caught: " + str + "\n");
} catch ( e ) {
        print("\tException caught.");
        print("\tType of exception: " + typeof e);
}
	    </pre></code>
	  </td>
	</tr>
	<tr bgcolor="#BCC0D3">
	  <td>
	    <strong><a name="Test.java">Test.java</a></strong>
	  </td>
	</tr>
	<tr>
	  <td>
	    <code><pre>
import netscape.javascript.JSObject;

public class Test {

    public static Object doit(JSObject obj, String code) {
	obj.eval(code);
	return null;
    }
}
	    </pre></code>
	  </td>
	</tr>
	<tr bgcolor="#BCC0D3">
	  <td>
	    <strong><a name="Output">Output:</a></strong>
	  </td>
	</tr>
	<tr>
	  <td>
	    <code><pre>
[user@machine liveconnect]$ Linux_All_DBG.OBJ/jsj test.js
<font color="forestgreen">Throwing JS Exception
        Exception caught: Thrown JS exception
        JS Type of exception: string

Triggering Java ClassNotFoundException
        Exception caught: java.lang.ClassNotFoundException: blah
        JS Type of exception: object

Throwing string: Packages.Test.doit(this, throw 'foo';)
        Exception caught: foo
        JS Type of exception: string

Throwing number: Packages.Test.doit(this, throw 42;)
        Exception caught: 42
        JS Type of exception: number

Throwing number: Packages.Test.doit(this, throw 4.2;)
        Exception caught: 4.2
        JS Type of exception: number

Throwing boolean: Packages.Test.doit(this, throw false;)
        Exception caught: false
        JS Type of exception: boolean

Throwing Object (new Date): Packages.Test.doit(this, throw new Date();)
        Exception caught: Mon Dec 07 10:09:05 GMT-0500 (EST) 1998
        JS Type of exception: object

Throwing Object (new String): Packages.Test.doit(this, throw new String();)
        Exception caught: 
        JS Type of exception: object

Throwing Object ({a:42}): Packages.Test.doit(this, throw {a:42};)
        Exception caught: [object Object]
        JS Type of exception: object

Throwing undefined: Packages.Test.doit(this, throw undefined)
        Exception caught.
        JS Type of exception: undefined

Throwing null: Packages.Test.doit(this, throw null)
        Exception caught.
        Type of exception: object</font>
[user@machine liveconnect]$</pre></code>
	  </td>
	</tr>
      </table></p>	  
    

    <p><b><font size="+1"><a name="troubleshooting">Troubleshooting</a></font></b></p>
    <p><ul>
      <li>make sure your source tree, specifically the LiveConnect source, is up to date
      <li>make sure your netscape.javascript classes are up to date, compiled,
	and in your $CLASSPATH
      <li>make sure Test.java is compiled and in your $CLASSPATH
    </ul></p>

    <hr>
    <address><a href="mailto:ccooper@neon.polkaroo.net">Chris Cooper</a></address>
<!-- Created: Fri Oct  9 14:28:41 EDT 1998 -->
<!-- hhmts start -->
Last modified: Wed Dec  9 15:00:16 EST 1998
<!-- hhmts end -->
  </body>
</html>
